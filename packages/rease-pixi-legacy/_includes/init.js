/* eslint-disable */
const t=require("./pixi.js");var e,r,i=Object.create(null),a=Object.create(null);function s(t,e){var r=a[t];return void 0===r&&(void 0===i[e]&&(i[e]=1),a[t]=r=i[e]++),r}function n(){if(!r){r="mediump";var i=function(){if(!e||e?.isContextLost()){var r=t.DOMAdapter.get().createCanvas();e=r.getContext("webgl",{})}return e}();if(i&&i.getShaderPrecisionFormat){var a=i.getShaderPrecisionFormat(i.FRAGMENT_SHADER,i.HIGH_FLOAT);r=a.precision?"highp":"mediump"}}return r}var o={},h={};var l={stripVersion:function(t,e){return e?t.replace("#version 300 es",""):t},ensurePrecision:function(t,e,r){var i=r?e.maxSupportedFragmentPrecision:e.maxSupportedVertexPrecision;if("precision"!==t.substring(0,9)){var a=r?e.requestedFragmentPrecision:e.requestedVertexPrecision;return"highp"===a&&"highp"!==i&&(a="mediump"),`precision ${a} float;\n${t}`}return"highp"!==i&&"precision highp"===t.substring(0,15)?t.replace("precision highp","precision mediump"):t},addProgramDefines:function(t,e,r){return e?t:r?`\n        \n        #ifdef GL_ES // This checks if it is WebGL1\n        #define in varying\n        #define finalColor gl_FragColor\n        #define texture texture2D\n        #endif\n        ${t=t.replace("out vec4 finalColor;","")}\n        `:`\n        \n        #ifdef GL_ES // This checks if it is WebGL1\n        #define in attribute\n        #define out varying\n        #endif\n        ${t}\n        `},setProgramName:function(t,{name:e="pixi-program"},r=!0){e=e.replace(/\s+/g,"-");var i=r?o:h;return i[e+=r?"-fragment":"-vertex"]?(i[e]++,e+=`-${i[e]}`):i[e]=1,-1!==t.indexOf("#define SHADER_NAME")?t:`${`#define SHADER_NAME ${e}`}\n${t}`},insertVersion:function(t,e){return e?`#version 300 es\n${t}`:t}},u=Object.create(null),d=class t{constructor(e){var r=-1!==(e={...t.defaultOptions,...e}).fragment.indexOf("#version 300 es"),i={stripVersion:r,ensurePrecision:{requestedFragmentPrecision:e.preferredFragmentPrecision,requestedVertexPrecision:e.preferredVertexPrecision,maxSupportedVertexPrecision:"highp",maxSupportedFragmentPrecision:n()},setProgramName:{name:e.name},addProgramDefines:r,insertVersion:r},a=e.fragment,o=e.vertex;Object.keys(l).forEach((t=>{var e=i[t];a=l[t](a,e,!0),o=l[t](o,e,!1)})),this.fragment=a,this.vertex=o,this._key=s(`${this.vertex}:${this.fragment}`,"gl-program")}destroy(){this.fragment=null,this.vertex=null,this._attributeData=null,this._uniformData=null,this._uniformBlockData=null,this.transformFeedbackVaryings=null}static from(e){var r=`${e.vertex}:${e.fragment}`;return u[r]||(u[r]=new t(e)),u[r]}};d.defaultOptions={preferredVertexPrecision:"highp",preferredFragmentPrecision:"mediump"};var c=d,p={uint8x2:{size:2,stride:2,normalised:!1},uint8x4:{size:4,stride:4,normalised:!1},sint8x2:{size:2,stride:2,normalised:!1},sint8x4:{size:4,stride:4,normalised:!1},unorm8x2:{size:2,stride:2,normalised:!0},unorm8x4:{size:4,stride:4,normalised:!0},snorm8x2:{size:2,stride:2,normalised:!0},snorm8x4:{size:4,stride:4,normalised:!0},uint16x2:{size:2,stride:4,normalised:!1},uint16x4:{size:4,stride:8,normalised:!1},sint16x2:{size:2,stride:4,normalised:!1},sint16x4:{size:4,stride:8,normalised:!1},unorm16x2:{size:2,stride:4,normalised:!0},unorm16x4:{size:4,stride:8,normalised:!0},snorm16x2:{size:2,stride:4,normalised:!0},snorm16x4:{size:4,stride:8,normalised:!0},float16x2:{size:2,stride:4,normalised:!1},float16x4:{size:4,stride:8,normalised:!1},float32:{size:1,stride:4,normalised:!1},float32x2:{size:2,stride:8,normalised:!1},float32x3:{size:3,stride:12,normalised:!1},float32x4:{size:4,stride:16,normalised:!1},uint32:{size:1,stride:4,normalised:!1},uint32x2:{size:2,stride:8,normalised:!1},uint32x3:{size:3,stride:12,normalised:!1},uint32x4:{size:4,stride:16,normalised:!1},sint32:{size:1,stride:4,normalised:!1},sint32x2:{size:2,stride:8,normalised:!1},sint32x3:{size:3,stride:12,normalised:!1},sint32x4:{size:4,stride:16,normalised:!1}};function f(t){return p[t]??p.float32}var g={f32:"float32","vec2<f32>":"float32x2","vec3<f32>":"float32x3","vec4<f32>":"float32x4",vec2f:"float32x2",vec3f:"float32x3",vec4f:"float32x4",i32:"sint32","vec2<i32>":"sint32x2","vec3<i32>":"sint32x3","vec4<i32>":"sint32x4",u32:"uint32","vec2<u32>":"uint32x2","vec3<u32>":"uint32x3","vec4<u32>":"uint32x4",bool:"uint32","vec2<bool>":"uint32x2","vec3<bool>":"uint32x3","vec4<bool>":"uint32x4"};function x(e){var r=/@group\((\d+)\)/,i=/@binding\((\d+)\)/,a=/var(<[^>]+>)? (\w+)/,s=/:\s*(\w+)/,n=/(\w+)\s*:\s*([\w\<\>]+)/g,o=/struct\s+(\w+)/,h=e.match(/(^|[^/])@(group|binding)\(\d+\)[^;]+;/g)?.map((t=>({group:parseInt(t.match(r)[1],10),binding:parseInt(t.match(i)[1],10),name:t.match(a)[2],isUniform:"<uniform>"===t.match(a)[1],type:t.match(s)[1]})));if(!h)return{groups:[],structs:[]};var l=e.match(/struct\s+(\w+)\s*{([^}]+)}/g)?.map((e=>{var r=e.match(o)[1],i=e.match(n).reduce(((e,r)=>{var i=r.split(":"),a=t._slicedToArray(i,2),s=a[0],n=a[1];return e[s.trim()]=n.trim(),e}),{});return i?{name:r,members:i}:null})).filter((({name:t})=>h.some((e=>e.type===t))))??[];return{groups:h,structs:l}}var v=(t=>(t[t.VERTEX=1]="VERTEX",t[t.FRAGMENT=2]="FRAGMENT",t[t.COMPUTE=4]="COMPUTE",t))(v||{});var m=Object.create(null);class GpuProgram{constructor(t){this._layoutKey=0;var e=t.fragment,r=t.vertex,i=t.layout,a=t.gpuLayout,s=t.name;if(this.name=s,this.fragment=e,this.vertex=r,e.source===r.source){var n=x(e.source);this.structsAndGroups=n}else{var o=x(r.source),h=x(e.source);this.structsAndGroups=function(t,e){var r=new Set,i=new Set;return{structs:[...t.structs,...e.structs].filter((t=>!r.has(t.name)&&(r.add(t.name),!0))),groups:[...t.groups,...e.groups].filter((t=>{var e=`${t.name}-${t.binding}`;return!i.has(e)&&(i.add(e),!0)}))}}(o,h)}this.layout=i??function({groups:t}){for(var e=[],r=0;r<t.length;r++){var i=t[r];e[i.group]||(e[i.group]={}),e[i.group][i.name]=i.binding}return e}(this.structsAndGroups),this.gpuLayout=a??function({groups:t}){for(var e=[],r=0;r<t.length;r++){var i=t[r];e[i.group]||(e[i.group]=[]),i.isUniform?e[i.group].push({binding:i.binding,visibility:v.VERTEX|v.FRAGMENT,buffer:{type:"uniform"}}):"sampler"===i.type?e[i.group].push({binding:i.binding,visibility:v.FRAGMENT,sampler:{type:"filtering"}}):"texture_2d"===i.type&&e[i.group].push({binding:i.binding,visibility:v.FRAGMENT,texture:{sampleType:"float",viewDimension:"2d",multisampled:!1}})}return e}(this.structsAndGroups),this.autoAssignGlobalUniforms=!(void 0===this.layout[0]?.globalUniforms),this.autoAssignLocalUniforms=!(void 0===this.layout[1]?.localUniforms),this._generateProgramKey()}_generateProgramKey(){var t=this.vertex,e=this.fragment,r=t.source+e.source+t.entryPoint+e.entryPoint;this._layoutKey=s(r,"program")}get attributeData(){return this._attributeData??(this._attributeData=function({source:t,entryPoint:e}){var r={},i=t.indexOf(`fn ${e}`);if(-1!==i){var a=t.indexOf("->",i);if(-1!==a)for(var s,n=t.substring(i,a),o=/@location\((\d+)\)\s+([a-zA-Z0-9_]+)\s*:\s*([a-zA-Z0-9_<>]+)(?:,|\s|$)/g;null!==(s=o.exec(n));){var h=g[s[3]]??"float32";r[s[2]]={location:parseInt(s[1],10),format:h,stride:f(h).stride,offset:0,instance:!1,start:0}}}return r}(this.vertex)),this._attributeData}destroy(){this.gpuLayout=null,this.layout=null,this.structsAndGroups=null,this.fragment=null,this.vertex=null}static from(t){var e=`${t.vertex.source}:${t.fragment.source}:${t.fragment.entryPoint}:${t.vertex.entryPoint}`;return m[e]||(m[e]=new GpuProgram(t)),m[e]}}function _(t,e){switch(t){case"f32":return 0;case"vec2<f32>":return new Float32Array(2*e);case"vec3<f32>":return new Float32Array(3*e);case"vec4<f32>":return new Float32Array(4*e);case"mat2x2<f32>":return new Float32Array([1,0,0,1]);case"mat3x3<f32>":return new Float32Array([1,0,0,0,1,0,0,0,1]);case"mat4x4<f32>":return new Float32Array([1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1])}return null}var y=class e{constructor(r,i){this._touched=0,this.uid=t.uid("uniform"),this._resourceType="uniformGroup",this._resourceId=t.uid("resource"),this.isUniformGroup=!0,this._dirtyId=0,this.destroyed=!1,i={...e.defaultOptions,...i},this.uniformStructures=r;var a={};for(var n in r){var o=r[n];o.name=n,o.size=o.size??1,o.value??(o.value=_(o.type,o.size)),a[n]=o.value}this.uniforms=a,this._dirtyId=1,this.ubo=i.ubo,this.isStatic=i.isStatic,this._signature=s(Object.keys(a).map((t=>`${t}-${r[t].type}`)).join("-"),"uniform-group")}update(){this._dirtyId++}};y.defaultOptions={ubo:!1,isStatic:!1};var b=y;class BindGroup{constructor(t){this.resources=Object.create(null),this._dirty=!0;var e=0;for(var r in t){var i=t[r];this.setResource(i,e++)}this._updateKey()}_updateKey(){if(this._dirty){this._dirty=!1;var t=[],e=0;for(var r in this.resources)t[e++]=this.resources[r]._resourceId;this._key=t.join("|")}}setResource(t,e){var r=this.resources[e];t!==r&&(r&&t.off?.("change",this.onResourceChange,this),t.on?.("change",this.onResourceChange,this),this.resources[e]=t,this._dirty=!0)}getResource(t){return this.resources[t]}_touch(t){var e=this.resources;for(var r in e)e[r]._touched=t}destroy(){var t=this.resources;for(var e in t){var r=t[e];r.off?.("change",this.onResourceChange,this)}this.resources=null}onResourceChange(t){if(this._dirty=!0,t.destroyed){var e=this.resources;for(var r in e)e[r]===t&&(e[r]=null)}else this._updateKey()}}var S=(t=>(t[t.WEBGL=1]="WEBGL",t[t.WEBGPU=2]="WEBGPU",t[t.BOTH=3]="BOTH",t))(S||{});class Shader extends t.EventEmitter{constructor(t){super(),this._uniformBindMap=Object.create(null),this._ownedBindGroups=[];let{gpuProgram:e,glProgram:r,groups:i,resources:a,compatibleRenderers:s,groupMap:n}=t;this.gpuProgram=e,this.glProgram=r,void 0===s&&(s=0,e&&(s|=S.WEBGPU),r&&(s|=S.WEBGL)),this.compatibleRenderers=s;const o={};if(a||i||(a={}),a&&i)throw new Error("[Shader] Cannot have both resources and groups");if(!e&&i&&!n)throw new Error("[Shader] No group map or WebGPU shader provided - consider using resources instead.");if(!e&&i&&n)for(const h in n)for(const t in n[h]){const e=n[h][t];o[e]={group:h,binding:t,name:e}}else if(e&&i&&!n){const t=e.structsAndGroups.groups;n={},t.forEach((t=>{n[t.group]=n[t.group]||{},n[t.group][t.binding]=t.name,o[t.name]=t}))}else if(a){if(e){const t=e.structsAndGroups.groups;n={},t.forEach((t=>{n[t.group]=n[t.group]||{},n[t.group][t.binding]=t.name,o[t.name]=t}))}else{n={},i={99:new BindGroup},this._ownedBindGroups.push(i[99]);let t=0;for(const e in a)o[e]={group:99,binding:t,name:e},n[99]=n[99]||{},n[99][t]=e,t++}i={};for(const t in a){const e=t;let r=a[t];r.source||r._resourceType||(r=new b(r));const s=o[e];s&&(i[s.group]||(i[s.group]=new BindGroup,this._ownedBindGroups.push(i[s.group])),i[s.group].setResource(r,s.binding))}}this.groups=i,this._uniformBindMap=n,this.resources=this._buildResourceAccessor(i,o)}addResource(t,e,r){var i,a;(i=this._uniformBindMap)[e]||(i[e]={}),(a=this._uniformBindMap[e])[r]||(a[r]=t),this.groups[e]||(this.groups[e]=new BindGroup,this._ownedBindGroups.push(this.groups[e]))}_buildResourceAccessor(t,e){const r={};for(const i in e){const a=e[i];Object.defineProperty(r,a.name,{get:()=>t[a.group].getResource(a.binding),set(e){t[a.group].setResource(e,a.binding)}})}return r}destroy(t=!1){this.emit("destroy",this),t&&(this.gpuProgram?.destroy(),this.glProgram?.destroy()),this.gpuProgram=null,this.glProgram=null,this.removeAllListeners(),this._uniformBindMap=null,this._ownedBindGroups.forEach((t=>{t.destroy()})),this._ownedBindGroups=null,this.resources=null,this.groups=null}static from(t){const{gpu:e,gl:r,...i}=t;let a,s;return e&&(a=GpuProgram.from(e)),r&&(s=c.from(r)),new Shader({gpuProgram:a,glProgram:s,...i})}}var T={normal:0,add:1,multiply:2,screen:3,overlay:4,erase:5,"normal-npm":6,"add-npm":7,"screen-npm":8},w=class t{constructor(){this.data=0,this.blendMode="normal",this.polygonOffset=0,this.blend=!0,this.depthMask=!0}get blend(){return!!(1&this.data)}set blend(t){!!(1&this.data)!==t&&(this.data^=1)}get offsets(){return!!(2&this.data)}set offsets(t){!!(2&this.data)!==t&&(this.data^=2)}set cullMode(t){"none"!==t?(this.culling=!0,this.clockwiseFrontFace="front"===t):this.culling=!1}get cullMode(){return this.culling?this.clockwiseFrontFace?"front":"back":"none"}get culling(){return!!(4&this.data)}set culling(t){!!(4&this.data)!==t&&(this.data^=4)}get depthTest(){return!!(8&this.data)}set depthTest(t){!!(8&this.data)!==t&&(this.data^=8)}get depthMask(){return!!(32&this.data)}set depthMask(t){!!(32&this.data)!==t&&(this.data^=32)}get clockwiseFrontFace(){return!!(16&this.data)}set clockwiseFrontFace(t){!!(16&this.data)!==t&&(this.data^=16)}get blendMode(){return this._blendMode}set blendMode(t){this.blend="none"!==t,this._blendMode=t,this._blendModeId=T[t]||0}get polygonOffset(){return this._polygonOffset}set polygonOffset(t){this.offsets=!!t,this._polygonOffset=t}toString(){return`[pixi.js/core:State blendMode=${this.blendMode} clockwiseFrontFace=${this.clockwiseFrontFace} culling=${this.culling} depthMask=${this.depthMask} polygonOffset=${this.polygonOffset}]`}static for2d(){var e=new t;return e.depthTest=!1,e.blend=!0,e}};w.default2d=w.for2d();var P=w;class ResizePlugin{static init(t){Object.defineProperty(this,"resizeTo",{set(t){globalThis.removeEventListener("resize",this.queueResize),this._resizeTo=t,t&&(globalThis.addEventListener("resize",this.queueResize),this.resize())},get(){return this._resizeTo}}),this.queueResize=()=>{this._resizeTo&&(this._cancelResize(),this._resizeId=requestAnimationFrame((()=>this.resize())))},this._cancelResize=()=>{this._resizeId&&(cancelAnimationFrame(this._resizeId),this._resizeId=null)},this.resize=()=>{if(this._resizeTo){var t,e;if(this._cancelResize(),this._resizeTo===globalThis.window)t=globalThis.innerWidth,e=globalThis.innerHeight;else{var r=this._resizeTo;t=r.clientWidth,e=r.clientHeight}this.renderer.resize(t,e),this.render()}},this._resizeId=null,this._resizeTo=null,this.resizeTo=t.resizeTo||null}static destroy(){globalThis.removeEventListener("resize",this.queueResize),this._cancelResize(),this._cancelResize=null,this.queueResize=null,this.resizeTo=null,this.resize=null}}ResizePlugin.extension=t.ExtensionType.Application;class TickerPlugin{static init(e){e=Object.assign({autoStart:!0,sharedTicker:!1},e),Object.defineProperty(this,"ticker",{set(e){this._ticker&&this._ticker.remove(this.render,this),this._ticker=e,e&&e.add(this.render,this,t.UPDATE_PRIORITY.LOW)},get(){return this._ticker}}),this.stop=()=>{this._ticker.stop()},this.start=()=>{this._ticker.start()},this._ticker=null,this.ticker=e.sharedTicker?t.Ticker.shared:new t.Ticker,e.autoStart&&this.start()}static destroy(){if(this._ticker){var t=this._ticker;this.ticker=null,t.destroy()}}}TickerPlugin.extension=t.ExtensionType.Application;var M=function(t){var e=[];return t.replace(B,(function(t,r,i){var a=r.toLowerCase();for(i=function(t){var e=t.match(k);return e?e.map(Number):[]}(i),"m"==a&&i.length>2&&(e.push([r].concat(i.splice(0,2))),a="l",r="m"==r?"l":"L");;){if(i.length==C[a])return i.unshift(r),e.push(i);if(i.length<C[a])throw new Error("malformed path data");e.push([r].concat(i.splice(0,C[a])))}})),e},C={a:7,c:6,h:1,l:2,m:2,q:4,s:4,t:2,v:1,z:0},B=/([astvzqmhlc])([^astvzqmhlc]*)/gi;var k=/-?[0-9]*\.?[0-9]+(?:e[-+]?\d+)?/gi;const A=t.getDefaultExportFromCjs(M);class Circle{constructor(t=0,e=0,r=0){this.type="circle",this.x=t,this.y=e,this.radius=r}clone(){return new Circle(this.x,this.y,this.radius)}contains(t,e){if(this.radius<=0)return!1;var r=this.radius*this.radius,i=this.x-t,a=this.y-e;return(i*=i)+(a*=a)<=r}strokeContains(t,e,r){if(0===this.radius)return!1;var i=this.x-t,a=this.y-e,s=this.radius,n=r/2,o=Math.sqrt(i*i+a*a);return o<s+n&&o>s-n}getBounds(e){return(e=e||new t.Rectangle).x=this.x-this.radius,e.y=this.y-this.radius,e.width=2*this.radius,e.height=2*this.radius,e}copyFrom(t){return this.x=t.x,this.y=t.y,this.radius=t.radius,this}copyTo(t){return t.copyFrom(this),t}toString(){return`[pixi.js/math:Circle x=${this.x} y=${this.y} radius=${this.radius}]`}}class Ellipse{constructor(t=0,e=0,r=0,i=0){this.type="ellipse",this.x=t,this.y=e,this.halfWidth=r,this.halfHeight=i}clone(){return new Ellipse(this.x,this.y,this.halfWidth,this.halfHeight)}contains(t,e){if(this.halfWidth<=0||this.halfHeight<=0)return!1;var r=(t-this.x)/this.halfWidth,i=(e-this.y)/this.halfHeight;return(r*=r)+(i*=i)<=1}strokeContains(t,e,r){var i=this.halfWidth,a=this.halfHeight;if(i<=0||a<=0)return!1;var s=r/2,n=i-s,o=a-s,h=i+s,l=a+s,u=t-this.x,d=e-this.y;return u*u/(n*n)+d*d/(o*o)>1&&u*u/(h*h)+d*d/(l*l)<=1}getBounds(){return new t.Rectangle(this.x-this.halfWidth,this.y-this.halfHeight,2*this.halfWidth,2*this.halfHeight)}copyFrom(t){return this.x=t.x,this.y=t.y,this.halfWidth=t.halfWidth,this.halfHeight=t.halfHeight,this}copyTo(t){return t.copyFrom(this),t}toString(){return`[pixi.js/math:Ellipse x=${this.x} y=${this.y} halfWidth=${this.halfWidth} halfHeight=${this.halfHeight}]`}}function R(t,e,r,i,a,s){var n,o,h=a-r,l=s-i,u=h*h+l*l,d=-1;0!==u&&(d=((t-r)*h+(e-i)*l)/u),d<0?(n=r,o=i):d>1?(n=a,o=s):(n=r+d*h,o=i+d*l);var c=t-n,p=e-o;return c*c+p*p}class Polygon{constructor(...t){this.type="polygon";var e=Array.isArray(t[0])?t[0]:t;if("number"!=typeof e[0]){for(var r=[],i=0,a=e.length;i<a;i++)r.push(e[i].x,e[i].y);e=r}this.points=e,this.closePath=!0}clone(){var t=this.points.slice(),e=new Polygon(t);return e.closePath=this.closePath,e}contains(t,e){for(var r=!1,i=this.points.length/2,a=0,s=i-1;a<i;s=a++){var n=this.points[2*a],o=this.points[2*a+1],h=this.points[2*s],l=this.points[2*s+1];o>e!=l>e&&t<(e-o)/(l-o)*(h-n)+n&&(r=!r)}return r}strokeContains(t,e,r){for(var i=r/2,a=i*i,s=this.points,n=s.length-(this.closePath?0:2),o=0;o<n;o+=2){if(R(t,e,s[o],s[o+1],s[(o+2)%s.length],s[(o+3)%s.length])<=a)return!0}return!1}getBounds(e){e=e||new t.Rectangle;for(var r=this.points,i=1/0,a=-1/0,s=1/0,n=-1/0,o=0,h=r.length;o<h;o+=2){var l=r[o],u=r[o+1];i=l<i?l:i,a=l>a?l:a,s=u<s?u:s,n=u>n?u:n}return e.x=i,e.width=a-i,e.y=s,e.height=n-s,e}copyFrom(t){return this.points=t.points.slice(),this.closePath=t.closePath,this}copyTo(t){return t.copyFrom(this),t}toString(){return`[pixi.js/math:PolygoncloseStroke=${this.closePath}points=${this.points.reduce(((t,e)=>`${t}, ${e}`),"")}]`}get lastX(){return this.points[this.points.length-2]}get lastY(){return this.points[this.points.length-1]}get x(){return this.points[this.points.length-2]}get y(){return this.points[this.points.length-1]}}var F=(t,e,r,i,a,s)=>{var n=t-r,o=e-i,h=Math.sqrt(n*n+o*o);return h>=a-s&&h<=a+s};class RoundedRectangle{constructor(t=0,e=0,r=0,i=0,a=20){this.type="roundedRectangle",this.x=t,this.y=e,this.width=r,this.height=i,this.radius=a}getBounds(e){return(e=e||new t.Rectangle).x=this.x,e.y=this.y,e.width=this.width,e.height=this.height,e}clone(){return new RoundedRectangle(this.x,this.y,this.width,this.height,this.radius)}copyFrom(t){return this.x=t.x,this.y=t.y,this.width=t.width,this.height=t.height,this}copyTo(t){return t.copyFrom(this),t}contains(t,e){if(this.width<=0||this.height<=0)return!1;if(t>=this.x&&t<=this.x+this.width&&e>=this.y&&e<=this.y+this.height){var r=Math.max(0,Math.min(this.radius,Math.min(this.width,this.height)/2));if(e>=this.y+r&&e<=this.y+this.height-r||t>=this.x+r&&t<=this.x+this.width-r)return!0;var i=t-(this.x+r),a=e-(this.y+r),s=r*r;if(i*i+a*a<=s)return!0;if((i=t-(this.x+this.width-r))*i+a*a<=s)return!0;if(i*i+(a=e-(this.y+this.height-r))*a<=s)return!0;if((i=t-(this.x+r))*i+a*a<=s)return!0}return!1}strokeContains(t,e,r){var i=this.x,a=this.y,s=this.width,n=this.height,o=this.radius,h=r/2,l=i+o,u=a+o,d=i+s,c=a+n;return(t>=i-h&&t<=i+h||t>=d-h&&t<=d+h)&&e>=u&&e<=u+(n-2*o)||((e>=a-h&&e<=a+h||e>=c-h&&e<=c+h)&&t>=l&&t<=l+(s-2*o)||(t<l&&e<u&&F(t,e,l,u,o,h)||t>d-o&&e<u&&F(t,e,d-o,u,o,h)||t>d-o&&e>c-o&&F(t,e,d-o,c-o,o,h)||t<l&&e>c-o&&F(t,e,l,c-o,o,h)))}toString(){return`[pixi.js/math:RoundedRectangle x=${this.x} y=${this.y}width=${this.width} height=${this.height} radius=${this.radius}]`}}var z=(t=>(t[t.MAP_READ=1]="MAP_READ",t[t.MAP_WRITE=2]="MAP_WRITE",t[t.COPY_SRC=4]="COPY_SRC",t[t.COPY_DST=8]="COPY_DST",t[t.INDEX=16]="INDEX",t[t.VERTEX=32]="VERTEX",t[t.UNIFORM=64]="UNIFORM",t[t.STORAGE=128]="STORAGE",t[t.INDIRECT=256]="INDIRECT",t[t.QUERY_RESOLVE=512]="QUERY_RESOLVE",t[t.STATIC=1024]="STATIC",t))(z||{});class Buffer extends t.EventEmitter{constructor(e){var r=e.data,i=e.size,a=e.usage,s=e.label,n=e.shrinkToFit;super(),this.uid=t.uid("buffer"),this._resourceType="buffer",this._resourceId=t.uid("resource"),this._touched=0,this._updateID=1,this.shrinkToFit=!0,this.destroyed=!1,r instanceof Array&&(r=new Float32Array(r)),this._data=r,i=i??r?.byteLength;var o=!!r;this.descriptor={size:i,usage:a,mappedAtCreation:o,label:s},this.shrinkToFit=n??!0}get data(){return this._data}set data(t){this.setDataWithSize(t,t.length,!0)}get static(){return!!(this.descriptor.usage&z.STATIC)}set static(t){t?this.descriptor.usage|=z.STATIC:this.descriptor.usage&=~z.STATIC}setDataWithSize(e,r,i){if(this._updateID++,this._updateSize=r*e.BYTES_PER_ELEMENT,this._data!==e){var a=this._data;this._data=e,a.length===e.length||!this.shrinkToFit&&e.byteLength<a.byteLength?i&&this.emit("update",this):(this.descriptor.size=e.byteLength,this._resourceId=t.uid("resource"),this.emit("change",this))}else i&&this.emit("update",this)}update(t){this._updateSize=t??this._updateSize,this._updateID++,this.emit("update",this)}destroy(){this.destroyed=!0,this.emit("destroy",this),this.emit("change",this),this._data=null,this.descriptor=null,this.removeAllListeners()}}function E(t,e){if(!(t instanceof Buffer)){var r=e?z.INDEX:z.VERTEX;t instanceof Array&&(e?(t=new Uint32Array(t),r=z.INDEX|z.COPY_DST):(t=new Float32Array(t),r=z.VERTEX|z.COPY_DST)),t=new Buffer({data:t,label:e?"index-mesh-buffer":"vertex-mesh-buffer",usage:r})}return t}function I(t){return(t instanceof Buffer||Array.isArray(t)||t.BYTES_PER_ELEMENT)&&(t={buffer:t}),t.buffer=E(t.buffer,!1),t}class Geometry extends t.EventEmitter{constructor(e){var r=e.attributes,i=e.indexBuffer,a=e.topology;for(var s in super(),this.uid=t.uid("geometry"),this._layoutKey=0,this.instanceCount=1,this._bounds=new t.Bounds,this._boundsDirty=!0,this.attributes=r,this.buffers=[],this.instanceCount=e.instanceCount||1,r){var n=r[s]=I(r[s]);-1===this.buffers.indexOf(n.buffer)&&(this.buffers.push(n.buffer),n.buffer.on("update",this.onBufferUpdate,this),n.buffer.on("change",this.onBufferUpdate,this))}i&&(this.indexBuffer=E(i,!0),this.buffers.push(this.indexBuffer)),this.topology=a||"triangle-list"}onBufferUpdate(){this._boundsDirty=!0,this.emit("update",this)}getAttribute(t){return this.attributes[t]}getIndex(){return this.indexBuffer}getBuffer(t){return this.getAttribute(t).buffer}getSize(){for(var t in this.attributes){var e=this.attributes[t];return e.buffer.data.length/(e.stride/4||e.size)}return 0}get bounds(){return this._boundsDirty?(this._boundsDirty=!1,function(t,e,r){var i=t.getAttribute(e);if(!i)return r.minX=0,r.minY=0,r.maxX=0,r.maxY=0,r;for(var a=i.buffer.data,s=1/0,n=1/0,o=-1/0,h=-1/0,l=a.BYTES_PER_ELEMENT,u=(i.offset||0)/l,d=(i.stride||8)/l,c=u;c<a.length;c+=d){var p=a[c],f=a[c+1];p>o&&(o=p),f>h&&(h=f),p<s&&(s=p),f<n&&(n=f)}return r.minX=s,r.minY=n,r.maxX=o,r.maxY=h,r}(this,"aPosition",this._bounds)):this._bounds}destroy(t=!1){this.emit("destroy",this),this.removeAllListeners(),t&&this.buffers.forEach((t=>t.destroy())),this.attributes=null,this.buffers=null,this.indexBuffer=null,this._bounds=null}}var U=new Float32Array(1),G=new Uint32Array(1);class BatchGeometry extends Geometry{constructor(){var t=new Buffer({data:U,label:"attribute-batch-buffer",usage:z.VERTEX|z.COPY_DST,shrinkToFit:!1});super({attributes:{aPosition:{buffer:t,format:"float32x2",stride:24,offset:0,location:1},aUV:{buffer:t,format:"float32x2",stride:24,offset:8,location:3},aColor:{buffer:t,format:"unorm8x4",stride:24,offset:16,location:0},aTextureIdAndRound:{buffer:t,format:"uint16x2",stride:24,offset:20,location:2}},indexBuffer:new Buffer({data:G,label:"index-batch-buffer",usage:z.INDEX|z.COPY_DST,shrinkToFit:!1})})}}var O=16,D={};function W(e,r){for(var i=0,a=0;a<r;a++)i=31*i+e[a].uid>>>0;return D[i]||function(e,r){for(var i={},a=0,s=0;s<O;s++){var n=s<e.length?e[s]:t.Texture.EMPTY.source;i[a++]=n.source,i[a++]=n.style}var o=new BindGroup(i);return D[r]=o,o}(e,i)}class ViewableBuffer{constructor(t){"number"==typeof t?this.rawBinaryData=new ArrayBuffer(t):t instanceof Uint8Array?this.rawBinaryData=t.buffer:this.rawBinaryData=t,this.uint32View=new Uint32Array(this.rawBinaryData),this.float32View=new Float32Array(this.rawBinaryData),this.size=this.rawBinaryData.byteLength}get int8View(){return this._int8View||(this._int8View=new Int8Array(this.rawBinaryData)),this._int8View}get uint8View(){return this._uint8View||(this._uint8View=new Uint8Array(this.rawBinaryData)),this._uint8View}get int16View(){return this._int16View||(this._int16View=new Int16Array(this.rawBinaryData)),this._int16View}get int32View(){return this._int32View||(this._int32View=new Int32Array(this.rawBinaryData)),this._int32View}get float64View(){return this._float64Array||(this._float64Array=new Float64Array(this.rawBinaryData)),this._float64Array}get bigUint64View(){return this._bigUint64Array||(this._bigUint64Array=new BigUint64Array(this.rawBinaryData)),this._bigUint64Array}view(t){return this[`${t}View`]}destroy(){this.rawBinaryData=null,this._int8View=null,this._uint8View=null,this._int16View=null,this.uint16View=null,this._int32View=null,this.uint32View=null,this.float32View=null}static sizeOf(t){switch(t){case"int8":case"uint8":return 1;case"int16":case"uint16":return 2;case"int32":case"uint32":case"float32":return 4;default:throw new Error(`${t} isn't a valid view type`)}}}function H(t,e){var r=t.byteLength/8|0,i=new Float64Array(t,0,r);new Float64Array(e,0,r).set(i);var a=t.byteLength-8*r;if(a>0){var s=new Uint8Array(t,8*r,a);new Uint8Array(e,8*r,a).set(s)}}var L={normal:"normal-npm",add:"add-npm",screen:"screen-npm"};function V(t,e){return"no-premultiply-alpha"===e.alphaMode&&L[t]||t}class BatchTextureArray{constructor(){this.ids=Object.create(null),this.textures=[],this.count=0}clear(){for(var t=0;t<this.count;t++){var e=this.textures[t];this.textures[t]=null,this.ids[e.uid]=null}this.count=0}}class Batch{constructor(){this.renderPipeId="batch",this.action="startBatch",this.start=0,this.size=0,this.blendMode="normal",this.canBundle=!0}destroy(){this.textures=null,this.gpuBindGroup=null,this.bindGroup=null,this.batcher=null}}var $=0,N=class e{constructor(r={}){this.uid=t.uid("batcher"),this.dirty=!0,this.batchIndex=0,this.batches=[],this._vertexSize=6,this._elements=[],this._batchPool=[],this._batchPoolIndex=0,this._textureBatchPool=[],this._textureBatchPoolIndex=0;var i=r={...e.defaultOptions,...r},a=i.vertexSize,s=i.indexSize;this.attributeBuffer=new ViewableBuffer(a*this._vertexSize*4),this.indexBuffer=new Uint16Array(s)}begin(){this.batchIndex=0,this.elementSize=0,this.elementStart=0,this.indexSize=0,this.attributeSize=0,this._batchPoolIndex=0,this._textureBatchPoolIndex=0,this._batchIndexStart=0,this._batchIndexSize=0,this.dirty=!0}add(t){this._elements[this.elementSize++]=t,t.indexStart=this.indexSize,t.location=this.attributeSize,t.batcher=this,this.indexSize+=t.indexSize,this.attributeSize+=t.vertexSize*this._vertexSize}checkAndUpdateTexture(t,e){var r=t.batch.textures.ids[e._source.uid];return!(!r&&0!==r)&&(t.textureId=r,t.texture=e,!0)}updateElement(t){this.dirty=!0,t.packAttributes(this.attributeBuffer.float32View,this.attributeBuffer.uint32View,t.location,t.textureId)}break(t){var e=this._elements,r=this._textureBatchPool[this._textureBatchPoolIndex++]||new BatchTextureArray;if(r.clear(),e[this.elementStart]){var i=e[this.elementStart],a=V(i.blendMode,i.texture._source);4*this.attributeSize>this.attributeBuffer.size&&this._resizeAttributeBuffer(4*this.attributeSize),this.indexSize>this.indexBuffer.length&&this._resizeIndexBuffer(this.indexSize);for(var s=this.attributeBuffer.float32View,n=this.attributeBuffer.uint32View,o=this.indexBuffer,h=this._batchIndexSize,l=this._batchIndexStart,u="startBatch",d=this._batchPool[this._batchPoolIndex++]||new Batch,c=this.elementStart;c<this.elementSize;++c){var p=e[c];e[c]=null;var f=p.texture._source,g=V(p.blendMode,f),x=a!==g;f._batchTick!==$||x?(f._batchTick=$,(r.count>=O||x)&&(this._finishBatch(d,l,h-l,r,a,t,u),u="renderBatch",l=h,a=g,(r=this._textureBatchPool[this._textureBatchPoolIndex++]||new BatchTextureArray).clear(),d=this._batchPool[this._batchPoolIndex++]||new Batch,++$),p.textureId=f._textureBindLocation=r.count,r.ids[f.uid]=r.count,r.textures[r.count++]=f,p.batch=d,h+=p.indexSize,p.packAttributes(s,n,p.location,p.textureId),p.packIndex(o,p.indexStart,p.location/this._vertexSize)):(p.textureId=f._textureBindLocation,h+=p.indexSize,p.packAttributes(s,n,p.location,p.textureId),p.packIndex(o,p.indexStart,p.location/this._vertexSize),p.batch=d)}r.count>0&&(this._finishBatch(d,l,h-l,r,a,t,u),l=h,++$),this.elementStart=this.elementSize,this._batchIndexStart=l,this._batchIndexSize=h}}_finishBatch(t,e,r,i,a,s,n){t.gpuBindGroup=null,t.action=n,t.batcher=this,t.textures=i,t.blendMode=a,t.start=e,t.size=r,++$,s.add(t)}finish(t){this.break(t)}ensureAttributeBuffer(t){4*t<=this.attributeBuffer.size||this._resizeAttributeBuffer(4*t)}ensureIndexBuffer(t){t<=this.indexBuffer.length||this._resizeIndexBuffer(t)}_resizeAttributeBuffer(t){var e=Math.max(t,2*this.attributeBuffer.size),r=new ViewableBuffer(e);H(this.attributeBuffer.rawBinaryData,r.rawBinaryData),this.attributeBuffer=r}_resizeIndexBuffer(t){var e=this.indexBuffer,r=Math.max(t,1.5*e.length),i=(r+=r%2)>65535?new Uint32Array(r):new Uint16Array(r);if(i.BYTES_PER_ELEMENT!==e.BYTES_PER_ELEMENT)for(var a=0;a<e.length;a++)i[a]=e[a];else H(e.buffer,i.buffer);this.indexBuffer=i}destroy(){for(var t=0;t<this.batches.length;t++)this.batches[t].destroy();this.batches=null;for(var e=0;e<this._elements.length;e++)this._elements[e].batch=null;this._elements=null,this.indexBuffer=null,this.attributeBuffer.destroy(),this.attributeBuffer=null}};N.defaultOptions={vertexSize:4,indexSize:6};var j=N;function Y(t,e,r,i,a){var s=e.a,n=e.b,o=e.c,h=e.d,l=e.tx,u=e.ty;r=r||0,i=i||2,a=a||t.length/i-r;for(var d=r*i,c=0;c<a;c++){var p=t[d],f=t[d+1];t[d]=s*p+o*f+l,t[d+1]=n*p+h*f+u,d+=i}}class BatchableGraphics{constructor(){this.batcher=null,this.batch=null,this.applyTransform=!0,this.roundPixels=0}get blendMode(){return this.applyTransform?this.renderable.groupBlendMode:"normal"}packIndex(t,e,r){for(var i=this.geometryData.indices,a=0;a<this.indexSize;a++)t[e++]=i[a+this.indexOffset]+r-this.vertexOffset}packAttributes(t,e,r,i){var a,s,n=this.geometryData,o=this.renderable,h=n.vertices,l=n.uvs,u=2*this.vertexOffset,d=2*(this.vertexOffset+this.vertexSize),c=this.color,p=c>>16|65280&c|(255&c)<<16;if(this.applyTransform)for(var f=(a=p,s=o.groupColor,(16777215!==a&&s?16777215!==s&&a?((a>>16&255)*(s>>16&255)/255<<16)+((a>>8&255)*(s>>8&255)/255<<8)+(255&a)*(255&s)/255:a:s)+(this.alpha*o.groupAlpha*255<<24)),g=o.groupTransform,x=i<<16|65535&this.roundPixels,v=g.a,m=g.b,_=g.c,y=g.d,b=g.tx,S=g.ty,T=u;T<d;T+=2){var w=h[T],P=h[T+1];t[r]=v*w+_*P+b,t[r+1]=m*w+y*P+S,t[r+2]=l[T],t[r+3]=l[T+1],e[r+4]=f,e[r+5]=x,r+=6}else for(var M=p+(255*this.alpha<<24),C=u;C<d;C+=2)t[r]=h[C],t[r+1]=h[C+1],t[r+2]=l[C],t[r+3]=l[C+1],e[r+4]=M,e[r+5]=i<<16,r+=6}get vertSize(){return this.vertexSize}copyTo(t){t.indexOffset=this.indexOffset,t.indexSize=this.indexSize,t.vertexOffset=this.vertexOffset,t.vertexSize=this.vertexSize,t.color=this.color,t.alpha=this.alpha,t.texture=this.texture,t.geometryData=this.geometryData}reset(){this.applyTransform=!0}}var X={build(t,e){var r,i,a,s,n,o;if("circle"===t.type){var h=t;r=h.x,i=h.y,n=o=h.radius,a=s=0}else if("ellipse"===t.type){var l=t;r=l.x,i=l.y,n=l.halfWidth,o=l.halfHeight,a=s=0}else{var u=t,d=u.width/2,c=u.height/2;r=u.x+d,i=u.y+c,a=d-(n=o=Math.max(0,Math.min(u.radius,Math.min(d,c)))),s=c-o}if(!(n>=0&&o>=0&&a>=0&&s>=0))return e;var p=Math.ceil(2.3*Math.sqrt(n+o)),f=8*p+(a?4:0)+(s?4:0);if(0===f)return e;if(0===p)return e[0]=e[6]=r+a,e[1]=e[3]=i+s,e[2]=e[4]=r-a,e[5]=e[7]=i-s,e;var g=0,x=4*p+(a?2:0)+2,v=x,m=f,_=a+n,y=s,b=r+_,S=r-_,T=i+y;if(e[g++]=b,e[g++]=T,e[--x]=T,e[--x]=S,s){var w=i-y;e[v++]=S,e[v++]=w,e[--m]=w,e[--m]=b}for(var P=1;P<p;P++){var M=Math.PI/2*(P/p),C=a+Math.cos(M)*n,B=s+Math.sin(M)*o,k=r+C,A=r-C,R=i+B,F=i-B;e[g++]=k,e[g++]=R,e[--x]=R,e[--x]=A,e[v++]=A,e[v++]=F,e[--m]=F,e[--m]=k}b=r+(_=a),S=r-_,T=i+(y=s+o);var z=i-y;return e[g++]=b,e[g++]=T,e[--m]=z,e[--m]=b,a&&(e[g++]=S,e[g++]=T,e[--m]=z,e[--m]=S),e},triangulate(t,e,r,i,a,s){if(0!==t.length){for(var n=0,o=0,h=0;h<t.length;h+=2)n+=t[h],o+=t[h+1];n/=t.length/2,o/=t.length/2;var l=i;e[l*r]=n,e[l*r+1]=o;for(var u=l++,d=0;d<t.length;d+=2)e[l*r]=t[d],e[l*r+1]=t[d+1],d>0&&(a[s++]=l,a[s++]=u,a[s++]=l-1),l++;a[s++]=u+1,a[s++]=u,a[s++]=l-1}}},q=1e-4,K=1e-4;function Q(t,e,r,i,a,s,n,o){var h,l;n?(h=i,l=-r):(h=-i,l=r);var u=t-r*a+h,d=e-i*a+l,c=t+r*s+h,p=e+i*s+l;return o.push(u,d),o.push(c,p),2}function Z(t,e,r,i,a,s,n,o){var h=r-t,l=i-e,u=Math.atan2(h,l),d=Math.atan2(a-t,s-e);o&&u<d?u+=2*Math.PI:!o&&u>d&&(d+=2*Math.PI);var c=u,p=d-u,f=Math.abs(p),g=Math.sqrt(h*h+l*l),x=1+(15*f*Math.sqrt(g)/Math.PI>>0),v=p/x;if(c+=v,o){n.push(t,e),n.push(r,i);for(var m=1,_=c;m<x;m++,_+=v)n.push(t,e),n.push(t+Math.sin(_)*g,e+Math.cos(_)*g);n.push(t,e),n.push(a,s)}else{n.push(r,i),n.push(t,e);for(var y=1,b=c;y<x;y++,b+=v)n.push(t+Math.sin(b)*g,e+Math.cos(b)*g),n.push(t,e);n.push(a,s),n.push(t,e)}return 2*x}function J(e,r,i,a,s,n,o){var h=t.earcut(e,r,2);if(h){for(var l=0;l<h.length;l+=3)n[o++]=h[l]+s,n[o++]=h[l+1]+s,n[o++]=h[l+2]+s;for(var u=s*a,d=0;d<e.length;d+=2)i[u]=e[d],i[u+1]=e[d+1],u+=a}}var tt=[],et={build(t,e){for(var r=0;r<t.points.length;r++)e[r]=t.points[r];return e},triangulate(t,e,r,i,a,s){J(t,tt,e,r,i,a,s)}},rt={build(t,e){var r=t,i=r.x,a=r.y,s=r.width,n=r.height;return s>=0&&n>=0?(e[0]=i,e[1]=a,e[2]=i+s,e[3]=a,e[4]=i+s,e[5]=a+n,e[6]=i,e[7]=a+n,e):e},triangulate(t,e,r,i,a,s){var n=0;e[(i*=r)+n]=t[0],e[i+n+1]=t[1],e[i+(n+=r)]=t[2],e[i+n+1]=t[3],e[i+(n+=r)]=t[6],e[i+n+1]=t[7],e[i+(n+=r)]=t[4],e[i+n+1]=t[5],n+=r;var o=i/r;a[s++]=o,a[s++]=o+1,a[s++]=o+2,a[s++]=o+1,a[s++]=o+3,a[s++]=o+2}},it={build:(t,e)=>(e[0]=t.x,e[1]=t.y,e[2]=t.x2,e[3]=t.y2,e[4]=t.x3,e[5]=t.y3,e),triangulate(t,e,r,i,a,s){var n=0;e[(i*=r)+n]=t[0],e[i+n+1]=t[1],e[i+(n+=r)]=t[2],e[i+n+1]=t[3],e[i+(n+=r)]=t[4],e[i+n+1]=t[5];var o=i/r;a[s++]=o,a[s++]=o+1,a[s++]=o+2}},at={rectangle:rt,polygon:et,triangle:it,circle:X,ellipse:X,roundedRectangle:X},st=new t.Rectangle;function nt(e,r,i){var a=i.vertices,s=i.uvs,n=i.indices,o=n.length,h=a.length/2,l=[],u=at.rectangle,d=st,c=e.image;d.x=e.dx,d.y=e.dy,d.width=e.dw,d.height=e.dh;var p=e.transform;u.build(d,l),p&&Y(l,p),u.triangulate(l,a,2,h,n,o);var f=c.uvs;s.push(f.x0,f.y0,f.x1,f.y1,f.x3,f.y3,f.x2,f.y2);var g=t.BigPool.get(BatchableGraphics);g.indexOffset=o,g.indexSize=n.length-o,g.vertexOffset=h,g.vertexSize=a.length/2-h,g.color=e.style,g.alpha=e.alpha,g.texture=c,g.geometryData=i,r.push(g)}function ot(e,r,i,a,s,n){var o=n.vertices,h=n.uvs,l=n.indices,u=e.shapePrimitives.length-1;e.shapePrimitives.forEach((({shape:e,transform:d},c)=>{var p=l.length,f=o.length/2,g=[],x=at[e.type];if(x.build(e,g),d&&Y(g,d),a){var v=e.closePath??!0;!function(e,r,i,a,s,n,o,h,l){var u=q;if(0!==e.length){var d=r,c=d.alignment;if(.5!==r.alignment){var p=function(t){var e=t.length;if(e<6)return 1;for(var r=0,i=0,a=t[e-2],s=t[e-1];i<e;i+=2){var n=t[i],o=t[i+1];r+=(n-a)*(o+s),a=n,s=o}return r<0?-1:1}(e);i&&(p*=-1),c=(c-.5)*p+.5}var f=new t.Point(e[0],e[1]),g=new t.Point(e[e.length-2],e[e.length-1]),x=a,v=Math.abs(f.x-g.x)<u&&Math.abs(f.y-g.y)<u;if(x){e=e.slice(),v&&(e.pop(),e.pop(),g.set(e[e.length-2],e[e.length-1]));var m=.5*(f.x+g.x),_=.5*(g.y+f.y);e.unshift(m,_),e.push(m,_)}var y=s,b=e.length/2,S=e.length,T=y.length/2,w=d.width/2,P=w*w,M=d.miterLimit*d.miterLimit,C=e[0],B=e[1],k=e[2],A=e[3],R=0,F=0,z=-(B-A),E=C-k,I=0,U=0,G=Math.sqrt(z*z+E*E);z/=G,E/=G,z*=w,E*=w;var O=2*(1-c),D=2*c;x||("round"===d.cap?S+=Z(C-z*(O-D)*.5,B-E*(O-D)*.5,C-z*O,B-E*O,C+z*D,B+E*D,y,!0)+2:"square"===d.cap&&(S+=Q(C,B,z,E,O,D,!0,y))),y.push(C-z*O,B-E*O),y.push(C+z*D,B+E*D);for(var W=1;W<b-1;++W){C=e[2*(W-1)],B=e[2*(W-1)+1],k=e[2*W],A=e[2*W+1],R=e[2*(W+1)],F=e[2*(W+1)+1],z=-(B-A),E=C-k,z/=G=Math.sqrt(z*z+E*E),E/=G,z*=w,E*=w,I=-(A-F),U=k-R,I/=G=Math.sqrt(I*I+U*U),U/=G,I*=w,U*=w;var H=k-C,L=B-A,V=k-R,$=F-A,N=H*V+L*$,j=L*V-$*H,Y=j<0;if(Math.abs(j)<.001*Math.abs(N))y.push(k-z*O,A-E*O),y.push(k+z*D,A+E*D),N>=0&&("round"===d.join?S+=Z(k,A,k-z*O,A-E*O,k-I*O,A-U*O,y,!1)+4:S+=2,y.push(k-I*D,A-U*D),y.push(k+I*O,A+U*O));else{var X=(-z+C)*(-E+A)-(-z+k)*(-E+B),J=(-I+R)*(-U+A)-(-I+k)*(-U+F),tt=(H*J-V*X)/j,et=($*X-L*J)/j,rt=(tt-k)*(tt-k)+(et-A)*(et-A),it=k+(tt-k)*O,at=A+(et-A)*O,st=k-(tt-k)*D,nt=A-(et-A)*D,ot=Y?O:D;rt<=Math.min(H*H+L*L,V*V+$*$)+ot*ot*P?"bevel"===d.join||rt/P>M?(Y?(y.push(it,at),y.push(k+z*D,A+E*D),y.push(it,at),y.push(k+I*D,A+U*D)):(y.push(k-z*O,A-E*O),y.push(st,nt),y.push(k-I*O,A-U*O),y.push(st,nt)),S+=2):"round"===d.join?Y?(y.push(it,at),y.push(k+z*D,A+E*D),S+=Z(k,A,k+z*D,A+E*D,k+I*D,A+U*D,y,!0)+4,y.push(it,at),y.push(k+I*D,A+U*D)):(y.push(k-z*O,A-E*O),y.push(st,nt),S+=Z(k,A,k-z*O,A-E*O,k-I*O,A-U*O,y,!1)+4,y.push(k-I*O,A-U*O),y.push(st,nt)):(y.push(it,at),y.push(st,nt)):(y.push(k-z*O,A-E*O),y.push(k+z*D,A+E*D),"round"===d.join?S+=Y?Z(k,A,k+z*D,A+E*D,k+I*D,A+U*D,y,!0)+2:Z(k,A,k-z*O,A-E*O,k-I*O,A-U*O,y,!1)+2:"miter"===d.join&&rt/P<=M&&(Y?(y.push(st,nt),y.push(st,nt)):(y.push(it,at),y.push(it,at)),S+=2),y.push(k-I*O,A-U*O),y.push(k+I*D,A+U*D),S+=2)}}C=e[2*(b-2)],B=e[2*(b-2)+1],k=e[2*(b-1)],z=-(B-(A=e[2*(b-1)+1])),E=C-k,z/=G=Math.sqrt(z*z+E*E),E/=G,z*=w,E*=w,y.push(k-z*O,A-E*O),y.push(k+z*D,A+E*D),x||("round"===d.cap?S+=Z(k-z*(O-D)*.5,A-E*(O-D)*.5,k-z*O,A-E*O,k+z*D,A+E*D,y,!1)+2:"square"===d.cap&&(S+=Q(k,A,z,E,O,D,!1,y)));for(var ht=K*K,lt=T;lt<S+T-2;++lt)C=y[2*lt],B=y[2*lt+1],k=y[2*(lt+1)],A=y[2*(lt+1)+1],R=y[2*(lt+2)],F=y[2*(lt+2)+1],Math.abs(C*(A-F)+k*(F-B)+R*(B-A))<ht||h.push(lt,lt+1,lt+2)}}(g,r,!1,v,o,0,0,l)}else if(i&&u===c){0!==u&&console.warn("[Pixi Graphics] only the last shape have be cut out");var m=[],_=g.slice(),y=function(t){if(!t)return[];for(var e=t.shapePrimitives,r=[],i=0;i<e.length;i++){var a=e[i].shape,s=[];at[a.type].build(a,s),r.push(s)}return r}(i.shapePath);y.forEach((t=>{m.push(_.length/2),_.push(...t)})),J(_,m,o,2,f,l,p)}else x.triangulate(g,o,2,f,l,p);var b=h.length/2,S=r.texture;if(S!==t.Texture.WHITE){var T=r.matrix;d&&T.append(d.clone().invert()),function(t,e,r,i,a,s,n,o=null){var h=0;r*=e,a*=s;for(var l=o.a,u=o.b,d=o.c,c=o.d,p=o.tx,f=o.ty;h<n;){var g=t[r],x=t[r+1];i[a]=l*g+d*x+p,i[a+1]=u*g+c*x+f,a+=s,r+=e,h++}}(o,2,f,h,b,2,o.length/2-f,T)}else!function(t,e,r,i){var a=0;for(e*=r;a<i;)t[e]=0,t[e+1]=0,e+=r,a++}(h,b,2,o.length/2-f);var w=t.BigPool.get(BatchableGraphics);w.indexOffset=p,w.indexSize=l.length-p,w.vertexOffset=f,w.vertexSize=o.length/2-f,w.color=r.color,w.alpha=r.alpha,w.texture=S,w.geometryData=n,s.push(w)}))}class GpuGraphicsContext{constructor(){this.batches=[],this.geometryData={vertices:[],uvs:[],indices:[]}}}class GraphicsContextRenderData{constructor(){this.geometry=new BatchGeometry,this.instructions=new t.InstructionSet}init(){this.instructions.reset()}}var ht=class e{constructor(){this._activeBatchers=[],this._gpuContextHash={},this._graphicsDataContextHash=Object.create(null),this._needsContextNeedsRebuild=[]}init(t){e.defaultOptions.bezierSmoothness=t?.bezierSmoothness??e.defaultOptions.bezierSmoothness}prerender(){this._returnActiveBatchers()}getContextRenderData(t){return this._graphicsDataContextHash[t.uid]||this._initContextRenderData(t)}updateGpuContext(t){var e=this._gpuContextHash[t.uid]||this._initContext(t);if(t.dirty){e?this._cleanGraphicsContextData(t):e=this._initContext(t),function(t,e){var r=e.geometryData,i=e.batches;i.length=0,r.indices.length=0,r.vertices.length=0,r.uvs.length=0;for(var a=0;a<t.instructions.length;a++){var s=t.instructions[a];if("texture"===s.action)nt(s.data,i,r);else if("fill"===s.action||"stroke"===s.action){var n="stroke"===s.action,o=s.data.path.shapePath,h=s.data.style,l=s.data.hole;n&&l&&ot(l.shapePath,h,null,!0,i,r),ot(o,h,l,n,i,r)}}}(t,e);var r=t.batchMode;t.customShader||"no-batch"===r?e.isBatchable=!1:"auto"===r&&(e.isBatchable=e.geometryData.vertices.length<400),t.dirty=!1}return e}getGpuContext(t){return this._gpuContextHash[t.uid]||this._initContext(t)}_returnActiveBatchers(){for(var e=0;e<this._activeBatchers.length;e++)t.BigPool.return(this._activeBatchers[e]);this._activeBatchers.length=0}_initContextRenderData(e){for(var r=t.BigPool.get(GraphicsContextRenderData),i=this._gpuContextHash[e.uid],a=i.batches,s=i.geometryData,n=s.vertices.length,o=s.indices.length,h=0;h<a.length;h++)a[h].applyTransform=!1;var l=t.BigPool.get(j);this._activeBatchers.push(l),l.ensureAttributeBuffer(n),l.ensureIndexBuffer(o),l.begin();for(var u=0;u<a.length;u++){var d=a[u];l.add(d)}l.finish(r.instructions);var c=r.geometry;c.indexBuffer.setDataWithSize(l.indexBuffer,l.indexSize,!0),c.buffers[0].setDataWithSize(l.attributeBuffer.float32View,l.attributeSize,!0);for(var p=l.batches,f=0;f<p.length;f++){var g=p[f];g.bindGroup=W(g.textures.textures,g.textures.count)}return this._graphicsDataContextHash[e.uid]=r,r}_initContext(t){var e=new GpuGraphicsContext;return this._gpuContextHash[t.uid]=e,t.on("update",this.onGraphicsContextUpdate,this),t.on("destroy",this.onGraphicsContextDestroy,this),this._gpuContextHash[t.uid]}onGraphicsContextUpdate(t){this._needsContextNeedsRebuild.push(t)}onGraphicsContextDestroy(t){this._cleanGraphicsContextData(t),t.off("update",this.onGraphicsContextUpdate,this),t.off("destroy",this.onGraphicsContextDestroy,this),this._gpuContextHash[t.uid]=null}_cleanGraphicsContextData(e){var r=this._gpuContextHash[e.uid];r.isBatchable||this._graphicsDataContextHash[e.uid]&&(t.BigPool.return(this.getContextRenderData(e)),this._graphicsDataContextHash[e.uid]=null),r.batches&&r.batches.forEach((e=>{t.BigPool.return(e)}))}destroy(){for(var t of this._needsContextNeedsRebuild)this._gpuContextHash[t.uid]&&this.onGraphicsContextDestroy(t);this._needsContextNeedsRebuild.length=0}};ht.extension={type:[t.ExtensionType.WebGLSystem,t.ExtensionType.WebGPUSystem,t.ExtensionType.CanvasSystem],name:"graphicsContext"},ht.defaultOptions={bezierSmoothness:.5};var lt=ht,ut=8,dt=1.1920929e-7,ct=1;function pt(t,e,r,i,a,s,n,o,h,l){var u=Math.min(.99,Math.max(0,l??lt.defaultOptions.bezierSmoothness)),d=(ct-u)/1;return function(t,e,r,i,a,s,n,o,h,l){ft(t,e,r,i,a,s,n,o,h,l,0),h.push(n,o)}(e,r,i,a,s,n,o,h,t,d*=d),t}function ft(t,e,r,i,a,s,n,o,h,l,u){if(!(u>ut)){var d=(t+r)/2,c=(e+i)/2,p=(r+a)/2,f=(i+s)/2,g=(a+n)/2,x=(s+o)/2,v=(d+p)/2,m=(c+f)/2,_=(p+g)/2,y=(f+x)/2,b=(v+_)/2,S=(m+y)/2;if(u>0){var T=n-t,w=o-e,P=Math.abs((r-n)*w-(i-o)*T),M=Math.abs((a-n)*w-(s-o)*T);if(P>dt&&M>dt){if((P+M)*(P+M)<=l*(T*T+w*w))return void h.push(b,S)}else if(P>dt){if(P*P<=l*(T*T+w*w))return void h.push(b,S)}else if(M>dt){if(M*M<=l*(T*T+w*w))return void h.push(b,S)}else if((T=b-(t+n)/2)*T+(w=S-(e+o)/2)*w<=l)return void h.push(b,S)}ft(t,e,d,c,v,m,b,S,h,l,u+1),ft(b,S,_,y,g,x,n,o,h,l,u+1)}}var gt=8,xt=1.1920929e-7;function vt(t,e,r,i,a,s,n,o){var h=(1-Math.min(.99,Math.max(0,o??lt.defaultOptions.bezierSmoothness)))/1;return function(t,e,r,i,a,s,n,o){mt(n,t,e,r,i,a,s,o,0),n.push(a,s)}(e,r,i,a,s,n,t,h*=h),t}function mt(t,e,r,i,a,s,n,o,h){if(!(h>gt)){var l=(e+i)/2,u=(r+a)/2,d=(i+s)/2,c=(a+n)/2,p=(l+d)/2,f=(u+c)/2,g=s-e,x=n-r,v=Math.abs((i-s)*x-(a-n)*g);if(v>xt){if(v*v<=o*(g*g+x*x))return void t.push(p,f)}else if((g=p-(e+s)/2)*g+(x=f-(r+n)/2)*x<=o)return void t.push(p,f);mt(t,e,r,l,u,p,f,o,h+1),mt(t,p,f,d,c,s,n,o,h+1)}}function _t(t,e,r,i,a,s,n,o){var h=Math.abs(a-s);(!n&&a>s||n&&s>a)&&(h=2*Math.PI-h),o=o||Math.max(6,Math.floor(6*Math.pow(i,1/3)*(h/Math.PI)));var l=h/(o=Math.max(o,3)),u=a;l*=n?-1:1;for(var d=0;d<o+1;d++){var c=e+Math.cos(u)*i,p=r+Math.sin(u)*i;t.push(c,p),u+=l}}var yt=2*Math.PI,bt={centerX:0,centerY:0,ang1:0,ang2:0},St=({x:t,y:e},r,i,a,s,n,o,h)=>{var l=a*(t*=r)-s*(e*=i),u=s*t+a*e;return h.x=l+n,h.y=u+o,h};function Tt(t,e){var r=-1.5707963267948966===e?-.551915024494:4/3*Math.tan(e/4),i=1.5707963267948966===e?.551915024494:r,a=Math.cos(t),s=Math.sin(t),n=Math.cos(t+e),o=Math.sin(t+e);return[{x:a-s*i,y:s+a*i},{x:n+o*i,y:o-n*i},{x:n,y:o}]}var wt=(t,e,r,i)=>{var a=t*r+e*i;return a>1&&(a=1),a<-1&&(a=-1),(t*i-e*r<0?-1:1)*Math.acos(a)};function Pt(t,e,r,i,a,s,n,o=0,h=0,l=0){if(0!==s&&0!==n){var u=Math.sin(o*yt/360),d=Math.cos(o*yt/360),c=d*(e-i)/2+u*(r-a)/2,p=-u*(e-i)/2+d*(r-a)/2;if(0!==c||0!==p){s=Math.abs(s),n=Math.abs(n);var f=Math.pow(c,2)/Math.pow(s,2)+Math.pow(p,2)/Math.pow(n,2);f>1&&(s*=Math.sqrt(f),n*=Math.sqrt(f)),((t,e,r,i,a,s,n,o,h,l,u,d,c)=>{var p=Math.pow(a,2),f=Math.pow(s,2),g=Math.pow(u,2),x=Math.pow(d,2),v=p*f-p*x-f*g;v<0&&(v=0),v/=p*x+f*g;var m=(v=Math.sqrt(v)*(n===o?-1:1))*a/s*d,_=v*-s/a*u,y=l*m-h*_+(t+r)/2,b=h*m+l*_+(e+i)/2,S=(u-m)/a,T=(d-_)/s,w=(-u-m)/a,P=(-d-_)/s,M=wt(1,0,S,T),C=wt(S,T,w,P);0===o&&C>0&&(C-=yt),1===o&&C<0&&(C+=yt),c.centerX=y,c.centerY=b,c.ang1=M,c.ang2=C})(e,r,i,a,s,n,h,l,u,d,c,p,bt);var g=bt.ang1,x=bt.ang2,v=bt.centerX,m=bt.centerY,_=Math.abs(x)/(yt/4);Math.abs(1-_)<1e-7&&(_=1);var y=Math.max(Math.ceil(_),1);x/=y;for(var b=t[t.length-2],S=t[t.length-1],T={x:0,y:0},w=0;w<y;w++){var P=Tt(g,x),M=St(P[0],s,n,d,u,v,m,T),C=M.x,B=M.y,k=St(P[1],s,n,d,u,v,m,T),A=k.x,R=k.y,F=St(P[2],s,n,d,u,v,m,T),z=F.x,E=F.y;pt(t,b,S,C,B,A,R,z,E),b=z,S=E,g+=x}}}}var Mt=new t.Rectangle;class ShapePath{constructor(e){this.shapePrimitives=[],this._currentPoly=null,this._bounds=new t.Bounds,this._graphicsPath2D=e}moveTo(t,e){return this.startPoly(t,e),this}lineTo(t,e){this._ensurePoly();var r=this._currentPoly.points,i=r[r.length-2],a=r[r.length-1];return i===t&&a===e||r.push(t,e),this}arc(t,e,r,i,a,s){return this._ensurePoly(!1),_t(this._currentPoly.points,t,e,r,i,a,s),this}arcTo(t,e,r,i,a){return this._ensurePoly(),function(t,e,r,i,a,s){var n=t[t.length-2],o=t[t.length-1]-r,h=n-e,l=a-r,u=i-e,d=Math.abs(o*u-h*l);if(d<1e-8||0===s)t[t.length-2]===e&&t[t.length-1]===r||t.push(e,r);else{var c=o*o+h*h,p=l*l+u*u,f=o*l+h*u,g=s*Math.sqrt(c)/d,x=s*Math.sqrt(p)/d,v=g*f/c,m=x*f/p,_=g*u+x*h,y=g*l+x*o,b=h*(x+v),S=o*(x+v),T=u*(g+m),w=l*(g+m);_t(t,_+e,y+r,s,Math.atan2(S-y,b-_),Math.atan2(w-y,T-_),h*l>u*o)}}(this._currentPoly.points,t,e,r,i,a),this}arcToSvg(t,e,r,i,a,s,n){return Pt(this._currentPoly.points,this._currentPoly.lastX,this._currentPoly.lastY,s,n,t,e,r,i,a),this}bezierCurveTo(t,e,r,i,a,s,n){this._ensurePoly();var o=this._currentPoly;return pt(this._currentPoly.points,o.lastX,o.lastY,t,e,r,i,a,s,n),this}quadraticCurveTo(t,e,r,i,a){this._ensurePoly();var s=this._currentPoly;return vt(this._currentPoly.points,s.lastX,s.lastY,t,e,r,i,a),this}closePath(){return this.endPoly(!0),this}addPath(t,e){this.endPoly(),e&&!e.isIdentity()&&(t=t.clone(!0)).transform(e);for(var r=0;r<t.instructions.length;r++){var i=t.instructions[r];this[i.action](...i.data)}return this}finish(t=!1){this.endPoly(t)}rect(e,r,i,a,s){return this.drawShape(new t.Rectangle(e,r,i,a),s),this}circle(t,e,r,i){return this.drawShape(new Circle(t,e,r),i),this}poly(t,e,r){var i=new Polygon(t);return i.closePath=e,this.drawShape(i,r),this}regularPoly(t,e,r,i,a=0,s){i=Math.max(0|i,3);for(var n=-1*Math.PI/2+a,o=2*Math.PI/i,h=[],l=0;l<i;l++){var u=l*o+n;h.push(t+r*Math.cos(u),e+r*Math.sin(u))}return this.poly(h,!0,s),this}roundPoly(t,e,r,i,a,s=0,n){if(i=Math.max(0|i,3),a<=0)return this.regularPoly(t,e,r,i,s);var o=r*Math.sin(Math.PI/i)-.001;a=Math.min(a,o);for(var h=-1*Math.PI/2+s,l=2*Math.PI/i,u=(i-2)*Math.PI/i/2,d=0;d<i;d++){var c=d*l+h,p=t+r*Math.cos(c),f=e+r*Math.sin(c),g=c+Math.PI+u,x=c-Math.PI-u,v=p+a*Math.cos(g),m=f+a*Math.sin(g),_=p+a*Math.cos(x),y=f+a*Math.sin(x);0===d?this.moveTo(v,m):this.lineTo(v,m),this.quadraticCurveTo(p,f,_,y,n)}return this.closePath()}roundShape(t,e,r=!1,i){return t.length<3?this:(r?function(t,e,r,i){for(var a=(t,e)=>Math.sqrt((t.x-e.x)**2+(t.y-e.y)**2),s=(t,e,r)=>({x:t.x+(e.x-t.x)*r,y:t.y+(e.y-t.y)*r}),n=e.length,o=0;o<n;o++){var h=e[(o+1)%n],l=h.radius??r;if(l<=0)0===o?t.moveTo(h.x,h.y):t.lineTo(h.x,h.y);else{var u=e[o],d=e[(o+2)%n],c=a(u,h),p=void 0;p=c<1e-4?h:s(h,u,Math.min(c/2,l)/c);var f=a(d,h),g=void 0;g=f<1e-4?h:s(h,d,Math.min(f/2,l)/f),0===o?t.moveTo(p.x,p.y):t.lineTo(p.x,p.y),t.quadraticCurveTo(h.x,h.y,g.x,g.y,i)}}}(this,t,e,i):function(t,e,r){for(var i=(t,e)=>{var r=e.x-t.x,i=e.y-t.y,a=Math.sqrt(r*r+i*i);return{len:a,nx:r/a,ny:i/a}},a=(e,r)=>{0===e?t.moveTo(r.x,r.y):t.lineTo(r.x,r.y)},s=e[e.length-1],n=0;n<e.length;n++){var o=e[n%e.length],h=o.radius??r;if(h<=0)a(n,o),s=o;else{var l=e[(n+1)%e.length],u=i(o,s),d=i(o,l);if(u.len<1e-4||d.len<1e-4)a(n,o),s=o;else{var c=Math.asin(u.nx*d.ny-u.ny*d.nx),p=1,f=!1;u.nx*d.nx-u.ny*-d.ny<0?c<0?c=Math.PI+c:(c=Math.PI-c,p=-1,f=!0):c>0&&(p=-1,f=!0);var g=c/2,x=void 0,v=Math.abs(Math.cos(g)*h/Math.sin(g));v>Math.min(u.len/2,d.len/2)?(v=Math.min(u.len/2,d.len/2),x=Math.abs(v*Math.sin(g)/Math.cos(g))):x=h;var m=o.x+d.nx*v+-d.ny*x*p,_=o.y+d.ny*v+d.nx*x*p,y=Math.atan2(u.ny,u.nx)+Math.PI/2*p,b=Math.atan2(d.ny,d.nx)-Math.PI/2*p;0===n&&t.moveTo(m+Math.cos(y)*x,_+Math.sin(y)*x),t.arc(m,_,x,y,b,f),s=o}}}}(this,t,e),this.closePath())}filletRect(t,e,r,i,a){if(0===a)return this.rect(t,e,r,i);var s=Math.min(r,i)/2,n=Math.min(s,Math.max(-s,a)),o=t+r,h=e+i,l=n<0?-n:0,u=Math.abs(n);return this.moveTo(t,e+u).arcTo(t+l,e+l,t+u,e,u).lineTo(o-u,e).arcTo(o-l,e+l,o,e+u,u).lineTo(o,h-u).arcTo(o-l,h-l,t+r-u,h,u).lineTo(t+u,h).arcTo(t+l,h-l,t,h-u,u).closePath()}chamferRect(t,e,r,i,a,s){if(a<=0)return this.rect(t,e,r,i);for(var n=Math.min(a,Math.min(r,i)/2),o=t+r,h=e+i,l=[t+n,e,o-n,e,o,e+n,o,h-n,o-n,h,t+n,h,t,h-n,t,e+n],u=l.length-1;u>=2;u-=2)l[u]===l[u-2]&&l[u-1]===l[u-3]&&l.splice(u-1,2);return this.poly(l,!0,s)}ellipse(t,e,r,i,a){return this.drawShape(new Ellipse(t,e,r,i),a),this}roundRect(t,e,r,i,a,s){return this.drawShape(new RoundedRectangle(t,e,r,i,a),s),this}drawShape(t,e){return this.endPoly(),this.shapePrimitives.push({shape:t,transform:e}),this}startPoly(t,e){var r=this._currentPoly;return r&&this.endPoly(),(r=new Polygon).points.push(t,e),this._currentPoly=r,this}endPoly(t=!1){var e=this._currentPoly;return e&&e.points.length>2&&(e.closePath=t,this.shapePrimitives.push({shape:e})),this._currentPoly=null,this}_ensurePoly(t=!0){if(!this._currentPoly&&(this._currentPoly=new Polygon,t)){var e=this.shapePrimitives[this.shapePrimitives.length-1];if(e){var r=e.shape.x,i=e.shape.y;if(!e.transform.isIdentity()){var a=e.transform,s=r;r=a.a*r+a.c*i+a.tx,i=a.b*s+a.d*i+a.ty}this._currentPoly.points.push(r,i)}else this._currentPoly.points.push(0,0)}}buildPath(){var t=this._graphicsPath2D;this.shapePrimitives.length=0,this._currentPoly=null;for(var e=0;e<t.instructions.length;e++){var r=t.instructions[e];this[r.action](...r.data)}this.finish()}get bounds(){var t=this._bounds;t.clear();for(var e=this.shapePrimitives,r=0;r<e.length;r++){var i=e[r],a=i.shape.getBounds(Mt);i.transform?t.addRect(a,i.transform):t.addRect(a)}return t}}class GraphicsPath{constructor(e){this.instructions=[],this.uid=t.uid("graphicsPath"),this._dirty=!0,"string"==typeof e?function SVGToGraphicsPath(e,r){for(var i=A(e),a=[],s=null,n=0,o=0,h=0;h<i.length;h++){var l=i[h],u=l[0],d=l;switch(u){case"M":n=d[1],o=d[2],r.moveTo(n,o);break;case"m":n+=d[1],o+=d[2],r.moveTo(n,o);break;case"H":n=d[1],r.lineTo(n,o);break;case"h":n+=d[1],r.lineTo(n,o);break;case"V":o=d[1],r.lineTo(n,o);break;case"v":o+=d[1],r.lineTo(n,o);break;case"L":n=d[1],o=d[2],r.lineTo(n,o);break;case"l":n+=d[1],o+=d[2],r.lineTo(n,o);break;case"C":n=d[5],o=d[6],r.bezierCurveTo(d[1],d[2],d[3],d[4],n,o);break;case"c":r.bezierCurveTo(n+d[1],o+d[2],n+d[3],o+d[4],n+d[5],o+d[6]),n+=d[5],o+=d[6];break;case"S":n=d[3],o=d[4],r.bezierCurveToShort(d[1],d[2],n,o);break;case"s":r.bezierCurveToShort(n+d[1],o+d[2],n+d[3],o+d[4]),n+=d[3],o+=d[4];break;case"Q":n=d[3],o=d[4],r.quadraticCurveTo(d[1],d[2],n,o);break;case"q":r.quadraticCurveTo(n+d[1],o+d[2],n+d[3],o+d[4]),n+=d[3],o+=d[4];break;case"T":n=d[1],o=d[2],r.quadraticCurveToShort(n,o);break;case"t":n+=d[1],o+=d[2],r.quadraticCurveToShort(n,o);break;case"A":n=d[6],o=d[7],r.arcToSvg(d[1],d[2],d[3],d[4],d[5],n,o);break;case"a":n+=d[6],o+=d[7],r.arcToSvg(d[1],d[2],d[3],d[4],d[5],n,o);break;case"Z":case"z":r.closePath(),a.length>0&&((s=a.pop())?(n=s.startX,o=s.startY):(n=0,o=0)),s=null;break;default:t.warn(`Unknown SVG path command: ${u}`)}"Z"!==u&&"z"!==u&&null===s&&(s={startX:n,startY:o},a.push(s))}return r}(e,this):this.instructions=e?.slice()??[]}get shapePath(){return this._shapePath||(this._shapePath=new ShapePath(this)),this._dirty&&(this._dirty=!1,this._shapePath.buildPath()),this._shapePath}addPath(t,e){return t=t.clone(),this.instructions.push({action:"addPath",data:[t,e]}),this._dirty=!0,this}arc(...t){return this.instructions.push({action:"arc",data:t}),this._dirty=!0,this}arcTo(...t){return this.instructions.push({action:"arcTo",data:t}),this._dirty=!0,this}arcToSvg(...t){return this.instructions.push({action:"arcToSvg",data:t}),this._dirty=!0,this}bezierCurveTo(...t){return this.instructions.push({action:"bezierCurveTo",data:t}),this._dirty=!0,this}bezierCurveToShort(e,r,i,a,s){var n=this.instructions[this.instructions.length-1],o=this.getLastPoint(t.Point.shared),h=0,l=0;if(n&&"bezierCurveTo"===n.action){h=n.data[2],l=n.data[3];var u=o.x,d=o.y;h=u+(u-h),l=d+(d-l)}else h=o.x,l=o.y;return this.instructions.push({action:"bezierCurveTo",data:[h,l,e,r,i,a,s]}),this._dirty=!0,this}closePath(){return this.instructions.push({action:"closePath",data:[]}),this._dirty=!0,this}ellipse(...t){return this.instructions.push({action:"ellipse",data:t}),this._dirty=!0,this}lineTo(...t){return this.instructions.push({action:"lineTo",data:t}),this._dirty=!0,this}moveTo(...t){return this.instructions.push({action:"moveTo",data:t}),this}quadraticCurveTo(...t){return this.instructions.push({action:"quadraticCurveTo",data:t}),this._dirty=!0,this}quadraticCurveToShort(e,r,i){var a=this.instructions[this.instructions.length-1],s=this.getLastPoint(t.Point.shared),n=0,o=0;if(a&&"quadraticCurveTo"===a.action){n=a.data[0],o=a.data[1];var h=s.x,l=s.y;n=h+(h-n),o=l+(l-o)}else n=s.x,o=s.y;return this.instructions.push({action:"quadraticCurveTo",data:[n,o,e,r,i]}),this._dirty=!0,this}rect(t,e,r,i,a){return this.instructions.push({action:"rect",data:[t,e,r,i,a]}),this._dirty=!0,this}circle(t,e,r,i){return this.instructions.push({action:"circle",data:[t,e,r,i]}),this._dirty=!0,this}roundRect(...t){return this.instructions.push({action:"roundRect",data:t}),this._dirty=!0,this}poly(...t){return this.instructions.push({action:"poly",data:t}),this._dirty=!0,this}regularPoly(...t){return this.instructions.push({action:"regularPoly",data:t}),this._dirty=!0,this}roundPoly(...t){return this.instructions.push({action:"roundPoly",data:t}),this._dirty=!0,this}roundShape(...t){return this.instructions.push({action:"roundShape",data:t}),this._dirty=!0,this}filletRect(...t){return this.instructions.push({action:"filletRect",data:t}),this._dirty=!0,this}chamferRect(...t){return this.instructions.push({action:"chamferRect",data:t}),this._dirty=!0,this}star(t,e,r,i,a,s,n){a=a||i/2;for(var o=-1*Math.PI/2+s,h=2*r,l=2*Math.PI/h,u=[],d=0;d<h;d++){var c=d%2?a:i,p=d*l+o;u.push(t+c*Math.cos(p),e+c*Math.sin(p))}return this.poly(u,!0,n),this}clone(t=!1){var e=new GraphicsPath;if(t)for(var r=0;r<this.instructions.length;r++){var i=this.instructions[r];e.instructions.push({action:i.action,data:i.data.slice()})}else e.instructions=this.instructions.slice();return e}clear(){return this.instructions.length=0,this._dirty=!0,this}transform(e){if(e.isIdentity())return this;for(var r=e.a,i=e.b,a=e.c,s=e.d,n=e.tx,o=e.ty,h=0,l=0,u=0,d=0,c=0,p=0,f=0,g=0,x=0;x<this.instructions.length;x++){var v=this.instructions[x],m=v.data;switch(v.action){case"moveTo":case"lineTo":h=m[0],l=m[1],m[0]=r*h+a*l+n,m[1]=i*h+s*l+o;break;case"bezierCurveTo":u=m[0],d=m[1],c=m[2],p=m[3],h=m[4],l=m[5],m[0]=r*u+a*d+n,m[1]=i*u+s*d+o,m[2]=r*c+a*p+n,m[3]=i*c+s*p+o,m[4]=r*h+a*l+n,m[5]=i*h+s*l+o;break;case"quadraticCurveTo":u=m[0],d=m[1],h=m[2],l=m[3],m[0]=r*u+a*d+n,m[1]=i*u+s*d+o,m[2]=r*h+a*l+n,m[3]=i*h+s*l+o;break;case"arcToSvg":h=m[5],l=m[6],f=m[0],g=m[1],m[0]=r*f+a*g,m[1]=i*f+s*g,m[5]=r*h+a*l+n,m[6]=i*h+s*l+o;break;case"circle":m[4]=Ct(m[3],e);break;case"rect":m[4]=Ct(m[4],e);break;case"ellipse":m[8]=Ct(m[8],e);break;case"roundRect":m[5]=Ct(m[5],e);break;case"addPath":m[0].transform(e);break;case"poly":m[2]=Ct(m[2],e);break;default:t.warn("unknown transform action",v.action)}}return this._dirty=!0,this}get bounds(){return this.shapePath.bounds}getLastPoint(t){var e=this.instructions.length-1,r=this.instructions[e];if(!r)return t.x=0,t.y=0,t;for(;"closePath"===r.action;){if(--e<0)return t.x=0,t.y=0,t;r=this.instructions[e]}switch(r.action){case"moveTo":case"lineTo":t.x=r.data[0],t.y=r.data[1];break;case"quadraticCurveTo":t.x=r.data[2],t.y=r.data[3];break;case"bezierCurveTo":t.x=r.data[4],t.y=r.data[5];break;case"arc":case"arcToSvg":t.x=r.data[5],t.y=r.data[6];break;case"addPath":r.data[0].getLastPoint(t)}return t}}function Ct(t,e){return t?t.prepend(e):e.clone()}function SVGParser(t,e){if("string"==typeof t){var r=document.createElement("div");r.innerHTML=t.trim(),t=r.querySelector("svg")}return Bt(t,{context:e,path:new GraphicsPath},null,null),e}function Bt(e,r,i,a){var s,n,o,h,l,u,d,c,p,f,g,x,v,m,_,y,b=e.children,S=function(e){var r=e.getAttribute("style"),i={},a={},s=!1,n=!1;if(r)for(var o=r.split(";"),h=0;h<o.length;h++){var l=o[h].split(":"),u=t._slicedToArray(l,2),d=u[0],c=u[1];switch(d){case"stroke":"none"!==c&&(i.color=t.Color.shared.setValue(c).toNumber(),n=!0);break;case"stroke-width":i.width=Number(c);break;case"fill":"none"!==c&&(s=!0,a.color=t.Color.shared.setValue(c).toNumber());break;case"fill-opacity":a.alpha=Number(c);break;case"stroke-opacity":i.alpha=Number(c);break;case"opacity":a.alpha=Number(c),i.alpha=Number(c)}}else{var p=e.getAttribute("stroke");p&&"none"!==p&&(n=!0,i.color=t.Color.shared.setValue(p).toNumber(),i.width=kt(e,"stroke-width",1));var f=e.getAttribute("fill");f&&"none"!==f&&(s=!0,a.color=t.Color.shared.setValue(f).toNumber())}return{strokeStyle:n?i:null,fillStyle:s?a:null}}(e),T=S.fillStyle,w=S.strokeStyle;switch(T&&i?i={...i,...T}:T&&(i=T),w&&a?a={...a,...w}:w&&(a=w),r.context.fillStyle=i,r.context.strokeStyle=a,e.nodeName.toLowerCase()){case"path":v=e.getAttribute("d"),m=new GraphicsPath(v),r.context.path(m),i&&r.context.fill(),a&&r.context.stroke();break;case"circle":d=kt(e,"cx",0),c=kt(e,"cy",0),p=kt(e,"r",0),r.context.ellipse(d,c,p,p),i&&r.context.fill(),a&&r.context.stroke();break;case"rect":s=kt(e,"x",0),n=kt(e,"y",0),_=kt(e,"width",0),y=kt(e,"height",0),f=kt(e,"rx",0),g=kt(e,"ry",0),f||g?r.context.roundRect(s,n,_,y,f||g):r.context.rect(s,n,_,y),i&&r.context.fill(),a&&r.context.stroke();break;case"ellipse":d=kt(e,"cx",0),c=kt(e,"cy",0),f=kt(e,"rx",0),g=kt(e,"ry",0),r.context.beginPath(),r.context.ellipse(d,c,f,g),i&&r.context.fill(),a&&r.context.stroke();break;case"line":o=kt(e,"x1",0),h=kt(e,"y1",0),l=kt(e,"x2",0),u=kt(e,"y2",0),r.context.beginPath(),r.context.moveTo(o,h),r.context.lineTo(l,u),a&&r.context.stroke();break;case"polygon":x=e.getAttribute("points").match(/\d+/g).map((t=>parseInt(t,10))),r.context.poly(x,!0),i&&r.context.fill(),a&&r.context.stroke();break;case"polyline":x=e.getAttribute("points").match(/\d+/g).map((t=>parseInt(t,10))),r.context.poly(x,!1),a&&r.context.stroke();break;case"g":case"svg":break;default:console.info(`[SVG parser] <${e.nodeName}> elements unsupported`)}for(var P=0;P<b.length;P++)Bt(b[P],r,i,a)}function kt(t,e,r){var i=t.getAttribute(e);return i?Number(i):r}var At=class e{constructor(e,r,i,a){this.uid=t.uid("fillGradient"),this.type="linear",this.gradientStops=[],this.x0=e,this.y0=r,this.x1=i,this.y1=a}addColorStop(e,r){return this.gradientStops.push({offset:e,color:t.Color.shared.setValue(r).toHex()}),this}buildLinearGradient(){var r=e.defaultTextureSize,i=this.gradientStops,a=t.DOMAdapter.get().createCanvas();a.width=r,a.height=r;for(var s=a.getContext("2d"),n=s.createLinearGradient(0,0,e.defaultTextureSize,1),o=0;o<i.length;o++){var h=i[o];n.addColorStop(h.offset,h.color)}s.fillStyle=n,s.fillRect(0,0,r,r),this.texture=new t.Texture({source:new t.ImageSource({resource:a,addressModeU:"clamp-to-edge",addressModeV:"repeat"})});var l=this.x0,u=this.y0,d=this.x1,c=this.y1,p=new t.Matrix,f=d-l,g=c-u,x=Math.sqrt(f*f+g*g),v=Math.atan2(g,f);p.translate(-l,-u),p.scale(1/r,1/r),p.rotate(-v),p.scale(256/x,1),this.transform=p}};At.defaultTextureSize=256;var Rt=At,Ft={repeat:{addressModeU:"repeat",addressModeV:"repeat"},"repeat-x":{addressModeU:"repeat",addressModeV:"clamp-to-edge"},"repeat-y":{addressModeU:"clamp-to-edge",addressModeV:"repeat"},"no-repeat":{addressModeU:"clamp-to-edge",addressModeV:"clamp-to-edge"}};class FillPattern{constructor(e,r){this.uid=t.uid("fillPattern"),this.transform=new t.Matrix,this.texture=e,this.transform.scale(1/e.frame.width,1/e.frame.height),r&&(e.source.style.addressModeU=Ft[r].addressModeU,e.source.style.addressModeV=Ft[r].addressModeV)}setTransform(t){var e=this.texture;this.transform.copyFrom(t),this.transform.invert(),this.transform.scale(1/e.frame.width,1/e.frame.height)}}function zt(e,r){if(null==e)return null;var i,a;if(e?.fill?(a=e.fill,i={...r,...e}):(a=e,i=r),t.Color.isColorLike(a)){var s=t.Color.shared.setValue(a??0);return{...i,color:s.toNumber(),alpha:1===s.alpha?i.alpha:s.alpha,texture:t.Texture.WHITE}}if(a instanceof FillPattern){var n=a;return{...i,color:16777215,texture:n.texture,matrix:n.transform,fill:i.fill??null}}if(a instanceof Rt){var o=a;return o.buildLinearGradient(),{...i,color:16777215,texture:o.texture,matrix:o.transform}}var h={...r,...e};if(h.texture){if(h.texture!==t.Texture.WHITE){var l=h.matrix?.invert()||new t.Matrix;l.scale(1/h.texture.frame.width,1/h.texture.frame.height),h.matrix=l}var u=h.texture.source.style;"clamp-to-edge"===u.addressMode&&(u.addressMode="repeat")}var d=t.Color.shared.setValue(h.color);return h.alpha*=d.alpha,h.color=d.toNumber(),h.matrix=h.matrix?h.matrix.clone():null,h}var Et=new t.Point,It=new t.Matrix,Ut=class e extends t.EventEmitter{constructor(){super(...arguments),this.uid=t.uid("graphicsContext"),this.dirty=!0,this.batchMode="auto",this.instructions=[],this._activePath=new GraphicsPath,this._transform=new t.Matrix,this._fillStyle={...e.defaultFillStyle},this._strokeStyle={...e.defaultStrokeStyle},this._stateStack=[],this._tick=0,this._bounds=new t.Bounds,this._boundsDirty=!0}clone(){var t=new e;return t.batchMode=this.batchMode,t.instructions=this.instructions.slice(),t._activePath=this._activePath.clone(),t._transform=this._transform.clone(),t._fillStyle={...this._fillStyle},t._strokeStyle={...this._strokeStyle},t._stateStack=this._stateStack.slice(),t._bounds=this._bounds.clone(),t._boundsDirty=!0,t}get fillStyle(){return this._fillStyle}set fillStyle(t){this._fillStyle=zt(t,e.defaultFillStyle)}get strokeStyle(){return this._strokeStyle}set strokeStyle(t){this._strokeStyle=zt(t,e.defaultStrokeStyle)}setFillStyle(t){return this._fillStyle=zt(t,e.defaultFillStyle),this}setStrokeStyle(t){return this._strokeStyle=zt(t,e.defaultStrokeStyle),this}texture(e,r,i,a,s,n){return this.instructions.push({action:"texture",data:{image:e,dx:i||0,dy:a||0,dw:s||e.frame.width,dh:n||e.frame.height,transform:this._transform.clone(),alpha:this._fillStyle.alpha,style:r?t.Color.shared.setValue(r).toNumber():16777215}}),this.onUpdate(),this}beginPath(){return this._activePath=new GraphicsPath,this}fill(r,i){var a,s=this.instructions[this.instructions.length-1];return(a=0===this._tick&&s&&"stroke"===s.action?s.data.path:this._activePath.clone())?(null!=r&&(void 0!==i&&"number"==typeof r&&(t.deprecation(t.v8_0_0,"GraphicsContext.fill(color, alpha) is deprecated, use GraphicsContext.fill({ color, alpha }) instead"),r={color:r,alpha:i}),this._fillStyle=zt(r,e.defaultFillStyle)),this.instructions.push({action:"fill",data:{style:this.fillStyle,path:a}}),this.onUpdate(),this._initNextPathLocation(),this._tick=0,this):this}_initNextPathLocation(){var e=this._activePath.getLastPoint(t.Point.shared),r=e.x,i=e.y;this._activePath.clear(),this._activePath.moveTo(r,i)}stroke(t){var r,i=this.instructions[this.instructions.length-1];return(r=0===this._tick&&i&&"fill"===i.action?i.data.path:this._activePath.clone())?(null!=t&&(this._strokeStyle=zt(t,e.defaultStrokeStyle)),this.instructions.push({action:"stroke",data:{style:this.strokeStyle,path:r}}),this.onUpdate(),this._initNextPathLocation(),this._tick=0,this):this}cut(){for(var t=0;t<2;t++){var e=this.instructions[this.instructions.length-1-t],r=this._activePath.clone();if(e&&("stroke"===e.action||"fill"===e.action)){if(!e.data.hole){e.data.hole=r;break}e.data.hole.addPath(r)}}return this._initNextPathLocation(),this}arc(t,e,r,i,a,s){this._tick++;var n=this._transform;return this._activePath.arc(n.a*t+n.c*e+n.tx,n.b*t+n.d*e+n.ty,r,i,a,s),this}arcTo(t,e,r,i,a){this._tick++;var s=this._transform;return this._activePath.arcTo(s.a*t+s.c*e+s.tx,s.b*t+s.d*e+s.ty,s.a*r+s.c*i+s.tx,s.b*r+s.d*i+s.ty,a),this}arcToSvg(t,e,r,i,a,s,n){this._tick++;var o=this._transform;return this._activePath.arcToSvg(t,e,r,i,a,o.a*s+o.c*n+o.tx,o.b*s+o.d*n+o.ty),this}bezierCurveTo(t,e,r,i,a,s,n){this._tick++;var o=this._transform;return this._activePath.bezierCurveTo(o.a*t+o.c*e+o.tx,o.b*t+o.d*e+o.ty,o.a*r+o.c*i+o.tx,o.b*r+o.d*i+o.ty,o.a*a+o.c*s+o.tx,o.b*a+o.d*s+o.ty,n),this}closePath(){return this._tick++,this._activePath?.closePath(),this}ellipse(t,e,r,i){return this._tick++,this._activePath.ellipse(t,e,r,i,this._transform.clone()),this}circle(t,e,r){return this._tick++,this._activePath.circle(t,e,r,this._transform.clone()),this}path(t){return this._tick++,this._activePath.addPath(t,this._transform.clone()),this}lineTo(t,e){this._tick++;var r=this._transform;return this._activePath.lineTo(r.a*t+r.c*e+r.tx,r.b*t+r.d*e+r.ty),this}moveTo(t,e){this._tick++;var r=this._transform,i=this._activePath.instructions,a=r.a*t+r.c*e+r.tx,s=r.b*t+r.d*e+r.ty;return 1===i.length&&"moveTo"===i[0].action?(i[0].data[0]=a,i[0].data[1]=s,this):(this._activePath.moveTo(a,s),this)}quadraticCurveTo(t,e,r,i,a){this._tick++;var s=this._transform;return this._activePath.quadraticCurveTo(s.a*t+s.c*e+s.tx,s.b*t+s.d*e+s.ty,s.a*r+s.c*i+s.tx,s.b*r+s.d*i+s.ty,a),this}rect(t,e,r,i){return this._tick++,this._activePath.rect(t,e,r,i,this._transform.clone()),this}roundRect(t,e,r,i,a){return this._tick++,this._activePath.roundRect(t,e,r,i,a,this._transform.clone()),this}poly(t,e){return this._tick++,this._activePath.poly(t,e,this._transform.clone()),this}regularPoly(t,e,r,i,a=0,s){return this._tick++,this._activePath.regularPoly(t,e,r,i,a,s),this}roundPoly(t,e,r,i,a,s){return this._tick++,this._activePath.roundPoly(t,e,r,i,a,s),this}roundShape(t,e,r,i){return this._tick++,this._activePath.roundShape(t,e,r,i),this}filletRect(t,e,r,i,a){return this._tick++,this._activePath.filletRect(t,e,r,i,a),this}chamferRect(t,e,r,i,a,s){return this._tick++,this._activePath.chamferRect(t,e,r,i,a,s),this}star(t,e,r,i,a=0,s=0){return this._tick++,this._activePath.star(t,e,r,i,a,s,this._transform.clone()),this}svg(t){return this._tick++,SVGParser(t,this),this}restore(){var t=this._stateStack.pop();return t&&(this._transform=t.transform,this._fillStyle=t.fillStyle,this._strokeStyle=t.strokeStyle),this}save(){return this._stateStack.push({transform:this._transform.clone(),fillStyle:{...this._fillStyle},strokeStyle:{...this._strokeStyle}}),this}getTransform(){return this._transform}resetTransform(){return this._transform.identity(),this}rotate(t){return this._transform.rotate(t),this}scale(t,e=t){return this._transform.scale(t,e),this}setTransform(e,r,i,a,s,n){return e instanceof t.Matrix?(this._transform.set(e.a,e.b,e.c,e.d,e.tx,e.ty),this):(this._transform.set(e,r,i,a,s,n),this)}transform(e,r,i,a,s,n){return e instanceof t.Matrix?(this._transform.append(e),this):(It.set(e,r,i,a,s,n),this._transform.append(It),this)}translate(t,e=t){return this._transform.translate(t,e),this}clear(){return this.instructions.length=0,this.resetTransform(),this.onUpdate(),this}onUpdate(){this.dirty||(this.emit("update",this,16),this.dirty=!0,this._boundsDirty=!0)}get bounds(){if(!this._boundsDirty)return this._bounds;var t=this._bounds;t.clear();for(var e=0;e<this.instructions.length;e++){var r=this.instructions[e],i=r.action;if("fill"===i){var a=r.data;t.addBounds(a.path.bounds)}else if("texture"===i){var s=r.data;t.addFrame(s.dx,s.dy,s.dx+s.dw,s.dy+s.dh,s.transform)}if("stroke"===i){var n=r.data,o=n.style.width/2,h=n.path.bounds;t.addFrame(h.minX-o,h.minY-o,h.maxX+o,h.maxY+o)}}return t}containsPoint(t){if(!this.bounds.containsPoint(t.x,t.y))return!1;for(var e=this.instructions,r=!1,i=0;i<e.length;i++){var a=e[i],s=a.data,n=s.path;if(a.action&&n)for(var o=s.style,h=n.shapePath.shapePrimitives,l=0;l<h.length;l++){var u=h[l].shape;if(o&&u){var d=h[l].transform,c=d?d.applyInverse(t,Et):t;r="fill"===a.action?u.contains(c.x,c.y):u.strokeContains(c.x,c.y,o.width);var p=s.hole;if(p){var f=p.shapePath?.shapePrimitives;if(f)for(var g=0;g<f.length;g++)f[g].shape.contains(c.x,c.y)&&(r=!1)}if(r)return!0}}}return r}destroy(t=!1){if(this._stateStack.length=0,this._transform=null,this.emit("destroy",this),this.removeAllListeners(),"boolean"==typeof t?t:t?.texture){var e="boolean"==typeof t?t:t?.textureSource;this._fillStyle.texture&&this._fillStyle.texture.destroy(e),this._strokeStyle.texture&&this._strokeStyle.texture.destroy(e)}this._fillStyle=null,this._strokeStyle=null,this.instructions=null,this._activePath=null,this._bounds=null,this._stateStack=null,this.customShader=null,this._transform=null}};Ut.defaultFillStyle={color:16777215,alpha:1,texture:t.Texture.WHITE,matrix:null,fill:null},Ut.defaultStrokeStyle={width:1,color:16777215,alpha:1,alignment:.5,miterLimit:10,cap:"butt",join:"miter",texture:t.Texture.WHITE,matrix:null,fill:null};var Gt=Ut,Ot=0;var Dt=new class TexturePoolClass{constructor(t){this._poolKeyHash=Object.create(null),this._texturePool={},this.textureOptions=t||{},this.enableFullScreen=!1}createTexture(e,r,i){var a=new t.TextureSource({...this.textureOptions,width:e,height:r,resolution:1,antialias:i,autoGarbageCollect:!0});return new t.Texture({source:a,label:"texturePool_"+Ot++})}getOptimalTexture(e,r,i=1,a){var s=Math.ceil(e*i-1e-6),n=Math.ceil(r*i-1e-6),o=((s=t.nextPow2(s))<<17)+((n=t.nextPow2(n))<<1)+(a?1:0);this._texturePool[o]||(this._texturePool[o]=[]);var h=this._texturePool[o].pop();return h||(h=this.createTexture(s,n,a)),h.source._resolution=i,h.source.width=s/i,h.source.height=n/i,h.source.pixelWidth=s,h.source.pixelHeight=n,h.frame.x=0,h.frame.y=0,h.frame.width=e,h.frame.height=r,h.updateUvs(),this._poolKeyHash[h.uid]=o,h}getSameSizeTexture(t,e=!1){var r=t.source;return this.getOptimalTexture(t.width,t.height,r._resolution,e)}returnTexture(t){var e=this._poolKeyHash[t.uid];this._texturePool[e].push(t)}clear(t){if(t=!1!==t)for(var e in this._texturePool){var r=this._texturePool[e];if(r)for(var i=0;i<r.length;i++)r[i].destroy(!0)}this._texturePool={}}};class FilterPipe{constructor(t){this._renderer=t}push(t,e,r){this._renderer.renderPipes.batch.break(r),r.add({renderPipeId:"filter",canBundle:!1,action:"pushFilter",container:e,filterEffect:t})}pop(t,e,r){this._renderer.renderPipes.batch.break(r),r.add({renderPipeId:"filter",action:"popFilter",canBundle:!1})}execute(t){"pushFilter"===t.action?this._renderer.filter.push(t):"popFilter"===t.action&&this._renderer.filter.pop()}destroy(){this._renderer=null}}FilterPipe.extension={type:[t.ExtensionType.WebGLPipes,t.ExtensionType.WebGPUPipes,t.ExtensionType.CanvasPipes],name:"filter"};var Wt=new t.Matrix;function Ht(t,e){return e.clear(),Lt(t,e),e.isValid||e.set(0,0,0,0),t.isRenderGroupRoot?e.applyMatrix(t.renderGroup.localTransform):e.applyMatrix(t.renderGroup.worldTransform),e}function Lt(e,r){if(7===e.localDisplayStatus&&e.measurable){var i=!!e.effects.length,a=r;if((e.isRenderGroupRoot||i)&&(a=t.boundsPool.get().clear()),e.boundsArea)r.addRect(e.boundsArea,e.worldTransform);else{if(e.renderPipeId){var s=e.bounds;a.addFrame(s.minX,s.minY,s.maxX,s.maxY,e.groupTransform)}for(var n=e.children,o=0;o<n.length;o++)Lt(n[o],a)}if(i){for(var h=!1,l=0;l<e.effects.length;l++)e.effects[l].addBounds&&(h||(h=!0,a.applyMatrix(e.renderGroup.worldTransform)),e.effects[l].addBounds(a,!0));h&&(a.applyMatrix(e.renderGroup.worldTransform.copyTo(Wt).invert()),r.addBounds(a,e.relativeGroupTransform)),r.addBounds(a),t.boundsPool.return(a)}else e.isRenderGroupRoot&&(r.addBounds(a,e.relativeGroupTransform),t.boundsPool.return(a))}}var Vt=new Geometry({attributes:{aPosition:{buffer:new Float32Array([0,0,1,0,1,1,0,1]),location:0,format:"float32x2",stride:8,offset:0}},indexBuffer:new Uint32Array([0,1,2,0,2,3])});class FilterSystem{constructor(t){this._filterStackIndex=0,this._filterStack=[],this._filterGlobalUniforms=new b({uInputSize:{value:new Float32Array(4),type:"vec4<f32>"},uInputPixel:{value:new Float32Array(4),type:"vec4<f32>"},uInputClamp:{value:new Float32Array(4),type:"vec4<f32>"},uOutputFrame:{value:new Float32Array(4),type:"vec4<f32>"},uGlobalFrame:{value:new Float32Array(4),type:"vec4<f32>"},uOutputTexture:{value:new Float32Array(4),type:"vec4<f32>"}}),this._globalFilterBindGroup=new BindGroup({}),this.renderer=t}get activeBackTexture(){return this._activeFilterData?.backTexture}push(e){var r=this.renderer,i=e.filterEffect.filters;this._filterStack[this._filterStackIndex]||(this._filterStack[this._filterStackIndex]=this._getFilterData());var a=this._filterStack[this._filterStackIndex];if(this._filterStackIndex++,0!==i.length){var s=a.bounds;e.renderables?function(t,e){e.clear();for(var r=e.matrix,i=0;i<t.length;i++){var a=t[i];a.globalDisplayStatus<7||(e.matrix=a.worldTransform,a.addBounds(e))}e.matrix=r}(e.renderables,s):e.filterEffect.filterArea?(s.clear(),s.addRect(e.filterEffect.filterArea),s.applyMatrix(e.container.worldTransform)):Ht(e.container,s);for(var n=r.renderTarget.rootRenderTarget.colorTexture.source,o=n._resolution,h=0,l=n.antialias,u=!1,d=!1,c=0;c<i.length;c++){var p=i[c];if(o=Math.min(o,p.resolution),h+=p.padding,"inherit"!==p.antialias&&(l="on"===p.antialias),!!!(p.compatibleRenderers&r.type)){d=!1;break}if(p.blendRequired&&!(r.backBuffer?.useBackBuffer??1)){t.warn("Blend filter requires backBuffer on WebGL renderer to be enabled. Set `useBackBuffer: true` in the renderer options."),d=!1;break}d=p.enabled||d,u=u||p.blendRequired}if(d){var f=r.renderTarget.rootViewPort;s.scale(o).fitBounds(0,f.width,0,f.height).scale(1/o).pad(h).ceil(),s.isPositive?(a.skip=!1,a.bounds=s,a.blendRequired=u,a.container=e.container,a.filterEffect=e.filterEffect,a.previousRenderSurface=r.renderTarget.renderSurface,a.inputTexture=Dt.getOptimalTexture(s.width,s.height,o,l),r.renderTarget.bind(a.inputTexture,!0),r.globalUniforms.push({offset:s})):a.skip=!0}else a.skip=!0}else a.skip=!0}pop(){var e=this.renderer;this._filterStackIndex--;var r=this._filterStack[this._filterStackIndex];if(!r.skip){this._activeFilterData=r;var i=r.inputTexture,a=r.bounds,s=t.Texture.EMPTY;if(e.renderTarget.finishRenderPass(),r.blendRequired){var n=this._filterStackIndex>0?this._filterStack[this._filterStackIndex-1].bounds:null,o=e.renderTarget.getRenderTarget(r.previousRenderSurface);s=this.getBackTexture(o,a,n)}r.backTexture=s;var h=r.filterEffect.filters;if(this._globalFilterBindGroup.setResource(i.source.style,2),this._globalFilterBindGroup.setResource(s.source,3),e.globalUniforms.pop(),1===h.length)h[0].apply(this,i,r.previousRenderSurface,!1),Dt.returnTexture(i);else{var l=r.inputTexture,u=Dt.getOptimalTexture(a.width,a.height,l.source._resolution,!1),d=0;for(d=0;d<h.length-1;++d){h[d].apply(this,l,u,!0);var c=l;l=u,u=c}h[d].apply(this,l,r.previousRenderSurface,!1),Dt.returnTexture(l),Dt.returnTexture(u)}r.blendRequired&&Dt.returnTexture(s)}}getBackTexture(t,e,r){var i=t.colorTexture.source._resolution,a=Dt.getOptimalTexture(e.width,e.height,i,!1),s=e.minX,n=e.minY;r&&(s-=r.minX,n-=r.minY),s=Math.floor(s*i),n=Math.floor(n*i);var o=Math.ceil(e.width*i),h=Math.ceil(e.height*i);return this.renderer.renderTarget.copyToTexture(t,a,{x:s,y:n},{width:o,height:h},{x:0,y:0}),a}applyFilter(e,r,i,a){for(var s=this.renderer,n=this._filterStack[this._filterStackIndex],o=n.bounds,h=t.Point.shared,l=n.previousRenderSurface===i,u=this.renderer.renderTarget.rootRenderTarget.colorTexture.source._resolution,d=this._filterStackIndex-1;d>0&&this._filterStack[d].skip;)--d;d>0&&(u=this._filterStack[d].inputTexture.source._resolution);var c=this._filterGlobalUniforms,p=c.uniforms,f=p.uOutputFrame,g=p.uInputSize,x=p.uInputPixel,v=p.uInputClamp,m=p.uGlobalFrame,_=p.uOutputTexture;if(l){for(var y=this._filterStackIndex;y>0;){y--;var b=this._filterStack[this._filterStackIndex-1];if(!b.skip){h.x=b.bounds.minX,h.y=b.bounds.minY;break}}f[0]=o.minX-h.x,f[1]=o.minY-h.y}else f[0]=0,f[1]=0;f[2]=r.frame.width,f[3]=r.frame.height,g[0]=r.source.width,g[1]=r.source.height,g[2]=1/g[0],g[3]=1/g[1],x[0]=r.source.pixelWidth,x[1]=r.source.pixelHeight,x[2]=1/x[0],x[3]=1/x[1],v[0]=.5*x[2],v[1]=.5*x[3],v[2]=r.frame.width*g[2]-.5*x[2],v[3]=r.frame.height*g[3]-.5*x[3];var T=this.renderer.renderTarget.rootRenderTarget.colorTexture;m[0]=h.x*u,m[1]=h.y*u,m[2]=T.source.width*u,m[3]=T.source.height*u;var w=this.renderer.renderTarget.getRenderTarget(i);if(s.renderTarget.bind(i,!!a),i instanceof t.Texture?(_[0]=i.frame.width,_[1]=i.frame.height):(_[0]=w.width,_[1]=w.height),_[2]=w.isRoot?-1:1,c.update(),s.renderPipes.uniformBatch){var P=s.renderPipes.uniformBatch.getUboResource(c);this._globalFilterBindGroup.setResource(P,0)}else this._globalFilterBindGroup.setResource(c,0);this._globalFilterBindGroup.setResource(r.source,1),this._globalFilterBindGroup.setResource(r.source.style,2),e.groups[0]=this._globalFilterBindGroup,s.encoder.draw({geometry:Vt,shader:e,state:e._state,topology:"triangle-list"}),s.type===S.WEBGL&&s.renderTarget.finishRenderPass()}_getFilterData(){return{skip:!1,inputTexture:null,bounds:new t.Bounds,container:null,filterEffect:null,blendRequired:!1,previousRenderSurface:null}}calculateSpriteMatrix(e,r){var i=this._activeFilterData,a=e.set(i.inputTexture._source.width,0,0,i.inputTexture._source.height,i.bounds.minX,i.bounds.minY),s=r.worldTransform.copyTo(t.Matrix.shared);return s.invert(),a.prepend(s),a.scale(1/r.texture.frame.width,1/r.texture.frame.height),a.translate(r.anchor.x,r.anchor.y),a}}FilterSystem.extension={type:[t.ExtensionType.WebGLSystem,t.ExtensionType.WebGPUSystem],name:"filter"};var $t=["context","roundPixels"];class Graphics extends t.Container{constructor(e){e instanceof Gt&&(e={context:e});var r=e||{},i=r.context,a=r.roundPixels;super({label:"Graphics",...t._objectWithoutProperties(r,$t)}),this.canBundle=!0,this.renderPipeId="graphics",this._roundPixels=0,this._context=i||(this._ownedContext=new Gt),this._context.on("update",this.onViewUpdate,this),this.allowChildren=!1,this.roundPixels=a??!1}set context(t){t!==this._context&&(this._context.off("update",this.onViewUpdate,this),this._context=t,this._context.on("update",this.onViewUpdate,this),this.onViewUpdate())}get context(){return this._context}get bounds(){return this._context.bounds}addBounds(t){t.addBounds(this._context.bounds)}containsPoint(t){return this._context.containsPoint(t)}get roundPixels(){return!!this._roundPixels}set roundPixels(t){this._roundPixels=t?1:0}onViewUpdate(){this._didChangeId+=4096,this._didGraphicsUpdate=!0,this.didViewUpdate||(this.didViewUpdate=!0,this.renderGroup&&this.renderGroup.onChildViewUpdate(this))}destroy(t){this._ownedContext&&!t?this._ownedContext.destroy(t):!0!==t&&!0!==t?.context||this._context.destroy(t),this._ownedContext=null,this._context=null,super.destroy(t)}_callContextMethod(t,e){return this.context[t](...e),this}setFillStyle(...t){return this._callContextMethod("setFillStyle",t)}setStrokeStyle(...t){return this._callContextMethod("setStrokeStyle",t)}fill(...t){return this._callContextMethod("fill",t)}stroke(...t){return this._callContextMethod("stroke",t)}texture(...t){return this._callContextMethod("texture",t)}beginPath(){return this._callContextMethod("beginPath",[])}cut(){return this._callContextMethod("cut",[])}arc(...t){return this._callContextMethod("arc",t)}arcTo(...t){return this._callContextMethod("arcTo",t)}arcToSvg(...t){return this._callContextMethod("arcToSvg",t)}bezierCurveTo(...t){return this._callContextMethod("bezierCurveTo",t)}closePath(){return this._callContextMethod("closePath",[])}ellipse(...t){return this._callContextMethod("ellipse",t)}circle(...t){return this._callContextMethod("circle",t)}path(...t){return this._callContextMethod("path",t)}lineTo(...t){return this._callContextMethod("lineTo",t)}moveTo(...t){return this._callContextMethod("moveTo",t)}quadraticCurveTo(...t){return this._callContextMethod("quadraticCurveTo",t)}rect(...t){return this._callContextMethod("rect",t)}roundRect(...t){return this._callContextMethod("roundRect",t)}poly(...t){return this._callContextMethod("poly",t)}regularPoly(...t){return this._callContextMethod("regularPoly",t)}roundPoly(...t){return this._callContextMethod("roundPoly",t)}roundShape(...t){return this._callContextMethod("roundShape",t)}filletRect(...t){return this._callContextMethod("filletRect",t)}chamferRect(...t){return this._callContextMethod("chamferRect",t)}star(...t){return this._callContextMethod("star",t)}svg(...t){return this._callContextMethod("svg",t)}restore(...t){return this._callContextMethod("restore",t)}save(){return this._callContextMethod("save",[])}getTransform(){return this.context.getTransform()}resetTransform(){return this._callContextMethod("resetTransform",[])}rotateTransform(...t){return this._callContextMethod("rotate",t)}scaleTransform(...t){return this._callContextMethod("scale",t)}setTransform(...t){return this._callContextMethod("setTransform",t)}transform(...t){return this._callContextMethod("transform",t)}translateTransform(...t){return this._callContextMethod("translate",t)}clear(){return this._callContextMethod("clear",[])}get fillStyle(){return this._context.fillStyle}set fillStyle(t){this._context.fillStyle=t}get strokeStyle(){return this._context.strokeStyle}set strokeStyle(t){this._context.strokeStyle=t}clone(t=!1){return t?new Graphics(this._context.clone()):(this._ownedContext=null,new Graphics(this._context))}lineStyle(e,r,i){t.deprecation(t.v8_0_0,"Graphics#lineStyle is no longer needed. Use Graphics#setStrokeStyle to set the stroke style.");var a={};return e&&(a.width=e),r&&(a.color=r),i&&(a.alpha=i),this.context.strokeStyle=a,this}beginFill(e,r){t.deprecation(t.v8_0_0,"Graphics#beginFill is no longer needed. Use Graphics#fill to fill the shape with the desired style.");var i={};return e&&(i.color=e),r&&(i.alpha=r),this.context.fillStyle=i,this}endFill(){t.deprecation(t.v8_0_0,"Graphics#endFill is no longer needed. Use Graphics#fill to fill the shape with the desired style."),this.context.fill();var e=this.context.strokeStyle;return e.width===Gt.defaultStrokeStyle.width&&e.color===Gt.defaultStrokeStyle.color&&e.alpha===Gt.defaultStrokeStyle.alpha||this.context.stroke(),this}drawCircle(...e){return t.deprecation(t.v8_0_0,"Graphics#drawCircle has been renamed to Graphics#circle"),this._callContextMethod("circle",e)}drawEllipse(...e){return t.deprecation(t.v8_0_0,"Graphics#drawEllipse has been renamed to Graphics#ellipse"),this._callContextMethod("ellipse",e)}drawPolygon(...e){return t.deprecation(t.v8_0_0,"Graphics#drawPolygon has been renamed to Graphics#poly"),this._callContextMethod("poly",e)}drawRect(...e){return t.deprecation(t.v8_0_0,"Graphics#drawRect has been renamed to Graphics#rect"),this._callContextMethod("rect",e)}drawRoundedRect(...e){return t.deprecation(t.v8_0_0,"Graphics#drawRoundedRect has been renamed to Graphics#roundRect"),this._callContextMethod("roundRect",e)}drawStar(...e){return t.deprecation(t.v8_0_0,"Graphics#drawStar has been renamed to Graphics#star"),this._callContextMethod("star",e)}}var Nt=class e extends Geometry{constructor(...r){var i=r[0]??{};i instanceof Float32Array&&(t.deprecation(t.v8_0_0,"use new MeshGeometry({ positions, uvs, indices }) instead"),i={positions:i,uvs:r[1],indices:r[2]});var a=(i={...e.defaultOptions,...i}).positions||new Float32Array([0,0,1,0,1,1,0,1]),s=i.uvs||new Float32Array([0,0,1,0,1,1,0,1]),n=i.indices||new Uint32Array([0,1,2,0,2,3]),o=i.shrinkBuffersToFit;super({attributes:{aPosition:{buffer:new Buffer({data:a,label:"attribute-mesh-positions",shrinkToFit:o,usage:z.VERTEX|z.COPY_DST}),format:"float32x2",stride:8,offset:0},aUV:{buffer:new Buffer({data:s,label:"attribute-mesh-uvs",shrinkToFit:o,usage:z.VERTEX|z.COPY_DST}),format:"float32x2",stride:8,offset:0}},indexBuffer:new Buffer({data:n,label:"index-mesh-buffer",shrinkToFit:o,usage:z.INDEX|z.COPY_DST}),topology:i.topology}),this.batchMode="auto"}get positions(){return this.attributes.aPosition.buffer.data}set positions(t){this.attributes.aPosition.buffer.data=t}get uvs(){return this.attributes.aUV.buffer.data}set uvs(t){this.attributes.aUV.buffer.data=t}get indices(){return this.indexBuffer.data}set indices(t){this.indexBuffer.data=t}};Nt.defaultOptions={topology:"triangle-list",shrinkBuffersToFit:!1};var jt=Nt,Yt=["serif","sans-serif","monospace","cursive","fantasy","system-ui"];function Xt(t){var e="number"==typeof t.fontSize?`${t.fontSize}px`:t.fontSize,r=t.fontFamily;Array.isArray(t.fontFamily)||(r=t.fontFamily.split(","));for(var i=r.length-1;i>=0;i--){var a=r[i].trim();/([\"\'])[^\'\"]+\1/.test(a)||Yt.includes(a)||(a=`"${a}"`),r[i]=a}return`${t.fontStyle} ${t.fontVariant} ${t.fontWeight} ${e} ${r.join(",")}`}var qt={willReadFrequently:!0},Kt=class e{static get experimentalLetterSpacingSupported(){var r=e._experimentalLetterSpacingSupported;if(void 0!==r){var i=t.DOMAdapter.get().getCanvasRenderingContext2D().prototype;r=e._experimentalLetterSpacingSupported="letterSpacing"in i||"textLetterSpacing"in i}return r}constructor(t,e,r,i,a,s,n,o,h){this.text=t,this.style=e,this.width=r,this.height=i,this.lines=a,this.lineWidths=s,this.lineHeight=n,this.maxLineWidth=o,this.fontProperties=h}static measureText(t=" ",r,i=e._canvas,a=r.wordWrap){var s=`${t}:${r.styleKey}`;if(e._measurementCache[s])return e._measurementCache[s];var n=Xt(r),o=e.measureFont(n);0===o.fontSize&&(o.fontSize=r.fontSize,o.ascent=r.fontSize);var h=e.__context;h.font=n;for(var l=(a?e._wordWrap(t,r,i):t).split(/(?:\r\n|\r|\n)/),u=new Array(l.length),d=0,c=0;c<l.length;c++){var p=e._measureText(l[c],r.letterSpacing,h);u[c]=p,d=Math.max(d,p)}var f=r._stroke?.width||0,g=d+f;r.dropShadow&&(g+=r.dropShadow.distance);var x=r.lineHeight||o.fontSize+f,v=Math.max(x,o.fontSize+2*f)+(l.length-1)*(x+r.leading);return r.dropShadow&&(v+=r.dropShadow.distance),new e(t,r,g,v,l,u,x+r.leading,d,o)}static _measureText(t,r,i){var a=!1;e.experimentalLetterSpacingSupported&&(e.experimentalLetterSpacing?(i.letterSpacing=`${r}px`,i.textLetterSpacing=`${r}px`,a=!0):(i.letterSpacing="0px",i.textLetterSpacing="0px"));var s=i.measureText(t).width;return s>0&&(a?s-=r:s+=(e.graphemeSegmenter(t).length-1)*r),s}static _wordWrap(t,r,i=e._canvas){for(var a=i.getContext("2d",qt),s=0,n="",o="",h=Object.create(null),l=r.letterSpacing,u=r.whiteSpace,d=e._collapseSpaces(u),c=e._collapseNewlines(u),p=!d,f=r.wordWrapWidth+l,g=e._tokenize(t),x=0;x<g.length;x++){var v=g[x];if(e._isNewline(v)){if(!c){o+=e._addLine(n),p=!d,n="",s=0;continue}v=" "}if(d){var m=e.isBreakingSpace(v),_=e.isBreakingSpace(n[n.length-1]);if(m&&_)continue}var y=e._getFromCache(v,l,h,a);if(y>f)if(""!==n&&(o+=e._addLine(n),n="",s=0),e.canBreakWords(v,r.breakWords))for(var b=e.wordWrapSplit(v),S=0;S<b.length;S++){for(var T=b[S],w=T,P=1;b[S+P];){var M=b[S+P];if(e.canBreakChars(w,M,v,S,r.breakWords))break;T+=M,w=M,P++}S+=P-1;var C=e._getFromCache(T,l,h,a);C+s>f&&(o+=e._addLine(n),p=!1,n="",s=0),n+=T,s+=C}else{n.length>0&&(o+=e._addLine(n),n="",s=0);var B=x===g.length-1;o+=e._addLine(v,!B),p=!1,n="",s=0}else y+s>f&&(p=!1,o+=e._addLine(n),n="",s=0),(n.length>0||!e.isBreakingSpace(v)||p)&&(n+=v,s+=y)}return o+=e._addLine(n,!1)}static _addLine(t,r=!0){return t=e._trimRight(t),t=r?`${t}\n`:t}static _getFromCache(t,r,i,a){var s=i[t];return"number"!=typeof s&&(s=e._measureText(t,r,a)+r,i[t]=s),s}static _collapseSpaces(t){return"normal"===t||"pre-line"===t}static _collapseNewlines(t){return"normal"===t}static _trimRight(t){if("string"!=typeof t)return"";for(var r=t.length-1;r>=0;r--){var i=t[r];if(!e.isBreakingSpace(i))break;t=t.slice(0,-1)}return t}static _isNewline(t){return"string"==typeof t&&e._newlines.includes(t.charCodeAt(0))}static isBreakingSpace(t,r){return"string"==typeof t&&e._breakingSpaces.includes(t.charCodeAt(0))}static _tokenize(t){var r=[],i="";if("string"!=typeof t)return r;for(var a=0;a<t.length;a++){var s=t[a],n=t[a+1];e.isBreakingSpace(s,n)||e._isNewline(s)?(""!==i&&(r.push(i),i=""),r.push(s)):i+=s}return""!==i&&r.push(i),r}static canBreakWords(t,e){return e}static canBreakChars(t,e,r,i,a){return!0}static wordWrapSplit(t){return e.graphemeSegmenter(t)}static measureFont(t){if(e._fonts[t])return e._fonts[t];var r=e._context;r.font=t;var i=r.measureText(e.METRICS_STRING+e.BASELINE_SYMBOL),a={ascent:i.actualBoundingBoxAscent,descent:i.actualBoundingBoxDescent,fontSize:i.actualBoundingBoxAscent+i.actualBoundingBoxDescent};return e._fonts[t]=a,a}static clearMetrics(t=""){t?delete e._fonts[t]:e._fonts={}}static get _canvas(){if(!e.__canvas){var r;try{var i=new OffscreenCanvas(0,0),a=i.getContext("2d",qt);if(a?.measureText)return e.__canvas=i,i;r=t.DOMAdapter.get().createCanvas()}catch(s){r=t.DOMAdapter.get().createCanvas()}r.width=r.height=10,e.__canvas=r}return e.__canvas}static get _context(){return e.__context||(e.__context=e._canvas.getContext("2d",qt)),e.__context}};Kt.METRICS_STRING="|q",Kt.BASELINE_SYMBOL="M",Kt.BASELINE_MULTIPLIER=1.4,Kt.HEIGHT_MULTIPLIER=2,Kt.graphemeSegmenter=(()=>{if("function"==typeof Intl?.Segmenter){var t=new Intl.Segmenter;return e=>[...t.segment(e)].map((t=>t.segment))}return t=>[...t]})(),Kt.experimentalLetterSpacing=!1,Kt._fonts={},Kt._newlines=[10,13],Kt._breakingSpaces=[9,32,8192,8193,8194,8195,8196,8197,8198,8200,8201,8202,8287,12288],Kt._measurementCache={};var Qt=Kt,Zt=["_fontFamily","_fontStyle","_fontSize","_fontVariant","_fontWeight","_breakWords","_align","_leading","_letterSpacing","_lineHeight","_textBaseline","_whiteSpace","_wordWrap","_wordWrapWidth","_padding","_cssOverrides","_trim"];function Jt(t){for(var e=[],r=0,i=0;i<Zt.length;i++){var a=Zt[i];e[r++]=t[a]}return r=te(t._fill,e,r),r=function(t,e,r){return t?(r=te(t,e,r),e[r++]=t.width,e[r++]=t.alignment,e[r++]=t.cap,e[r++]=t.join,e[r++]=t.miterLimit,r):r}(t._stroke,e,r),e.join("-")}function te(t,e,r){return t?(e[r++]=t.color,e[r++]=t.alpha,e[r++]=t.fill?.uid,r):r}var ee=class e extends t.EventEmitter{constructor(r={}){super(),function(e){var r=e;if("boolean"==typeof r.dropShadow&&r.dropShadow){var i=re.defaultDropShadow;e.dropShadow={alpha:r.dropShadowAlpha??i.alpha,angle:r.dropShadowAngle??i.angle,blur:r.dropShadowBlur??i.blur,color:r.dropShadowColor??i.color,distance:r.dropShadowDistance??i.distance}}if(void 0!==r.strokeThickness){t.deprecation(t.v8_0_0,"strokeThickness is now a part of stroke");var a=r.stroke;e.stroke={color:a,width:r.strokeThickness}}if(Array.isArray(r.fill)){t.deprecation(t.v8_0_0,"gradient fill is now a fill pattern: `new FillGradient(...)`");var s=new Rt(0,0,0,1.7*e.fontSize),n=r.fill.map((e=>t.Color.shared.setValue(e).toNumber()));n.forEach(((t,e)=>{var i=r.fillGradientStops[e]??e/n.length;s.addColorStop(i,t)})),e.fill={fill:s}}}(r);var i={...e.defaultTextStyle,...r};for(var a in i){this[a]=i[a]}this.update()}get align(){return this._align}set align(t){this._align=t,this.update()}get breakWords(){return this._breakWords}set breakWords(t){this._breakWords=t,this.update()}get dropShadow(){return this._dropShadow}set dropShadow(t){this._dropShadow=null!==t&&"object"==typeof t?{...e.defaultDropShadow,...t}:t?{...e.defaultDropShadow}:null,this.update()}get fontFamily(){return this._fontFamily}set fontFamily(t){this._fontFamily=t,this.update()}get fontSize(){return this._fontSize}set fontSize(t){this._fontSize="string"==typeof t?parseInt(t,10):t,this.update()}get fontStyle(){return this._fontStyle}set fontStyle(t){this._fontStyle=t,this.update()}get fontVariant(){return this._fontVariant}set fontVariant(t){this._fontVariant=t,this.update()}get fontWeight(){return this._fontWeight}set fontWeight(t){this._fontWeight=t,this.update()}get leading(){return this._leading}set leading(t){this._leading=t,this.update()}get letterSpacing(){return this._letterSpacing}set letterSpacing(t){this._letterSpacing=t,this.update()}get lineHeight(){return this._lineHeight}set lineHeight(t){this._lineHeight=t,this.update()}get padding(){return this._padding}set padding(t){this._padding=t,this.update()}get trim(){return this._trim}set trim(t){this._trim=t,this.update()}get textBaseline(){return this._textBaseline}set textBaseline(t){this._textBaseline=t,this.update()}get whiteSpace(){return this._whiteSpace}set whiteSpace(t){this._whiteSpace=t,this.update()}get wordWrap(){return this._wordWrap}set wordWrap(t){this._wordWrap=t,this.update()}get wordWrapWidth(){return this._wordWrapWidth}set wordWrapWidth(t){this._wordWrapWidth=t,this.update()}get fill(){return this._originalFill}set fill(t){t!==this._originalFill&&(this._originalFill=t,this._fill=zt(0===t?"black":t,Gt.defaultFillStyle),this.update())}get stroke(){return this._originalStroke}set stroke(t){t!==this._originalStroke&&(this._originalStroke=t,this._stroke=zt(t,Gt.defaultStrokeStyle),this.update())}_generateKey(){return this._styleKey=Jt(this),this._styleKey}update(){this._styleKey=null,this.emit("update",this)}reset(){var t=e.defaultTextStyle;for(var r in t)this[r]=t[r]}get styleKey(){return this._styleKey||this._generateKey()}clone(){return new e({align:this.align,breakWords:this.breakWords,dropShadow:this.dropShadow,fill:this._fill,fontFamily:this.fontFamily,fontSize:this.fontSize,fontStyle:this.fontStyle,fontVariant:this.fontVariant,fontWeight:this.fontWeight,leading:this.leading,letterSpacing:this.letterSpacing,lineHeight:this.lineHeight,padding:this.padding,stroke:this._stroke,textBaseline:this.textBaseline,whiteSpace:this.whiteSpace,wordWrap:this.wordWrap,wordWrapWidth:this.wordWrapWidth})}destroy(t=!1){if(this.removeAllListeners(),"boolean"==typeof t?t:t?.texture){var e="boolean"==typeof t?t:t?.textureSource;this._fill?.texture&&this._fill.texture.destroy(e),this._originalFill?.texture&&this._originalFill.texture.destroy(e),this._stroke?.texture&&this._stroke.texture.destroy(e),this._originalStroke?.texture&&this._originalStroke.texture.destroy(e)}this._fill=null,this._stroke=null,this.dropShadow=null,this._originalStroke=null,this._originalFill=null}};ee.defaultDropShadow={alpha:1,angle:Math.PI/6,blur:0,color:"black",distance:5},ee.defaultTextStyle={align:"left",breakWords:!1,dropShadow:null,fill:"black",fontFamily:"Arial",fontSize:26,fontStyle:"normal",fontVariant:"normal",fontWeight:"normal",leading:0,letterSpacing:0,lineHeight:0,padding:0,stroke:null,textBaseline:"alphabetic",trim:!1,whiteSpace:"pre",wordWrap:!1,wordWrapWidth:100};var re=ee;var ie=new class CanvasPoolClass{constructor(t){this._canvasPool=Object.create(null),this.canvasOptions=t||{},this.enableFullScreen=!1}_createCanvasAndContext(e,r){var i=t.DOMAdapter.get().createCanvas();i.width=e,i.height=r;var a=i.getContext("2d");return{canvas:i,context:a}}getOptimalCanvasAndContext(e,r,i=1){e=Math.ceil(e*i-1e-6),r=Math.ceil(r*i-1e-6);var a=((e=t.nextPow2(e))<<17)+((r=t.nextPow2(r))<<1);this._canvasPool[a]||(this._canvasPool[a]=[]);var s=this._canvasPool[a].pop();return s||(s=this._createCanvasAndContext(e,r)),s}returnCanvasAndContext(t){var e=t.canvas,r=(e.width<<17)+(e.height<<1);this._canvasPool[r].push(t)}clear(){this._canvasPool={}}};function ae(e,r){if(e.texture===t.Texture.WHITE&&!e.fill)return t.Color.shared.setValue(e.color).toHex();if(!e.fill){var i=r.createPattern(e.texture.source.resource,"repeat"),a=e.matrix.copyTo(t.Matrix.shared);return a.scale(e.texture.frame.width,e.texture.frame.height),i.setTransform(a),i}if(e.fill instanceof FillPattern){var s=e.fill,n=r.createPattern(s.texture.source.resource,"repeat"),o=s.transform.copyTo(t.Matrix.shared);return o.scale(s.texture.frame.width,s.texture.frame.height),n.setTransform(o),n}if(e.fill instanceof Rt){var h=e.fill;if("linear"===h.type){var l=r.createLinearGradient(h.x0,h.y0,h.x1,h.y1);return h.gradientStops.forEach((e=>{l.addColorStop(e.offset,t.Color.shared.setValue(e.color).toHex())})),l}}return t.warn("FillStyle not recognised",e),"red"}class AbstractBitmapFont extends t.EventEmitter{constructor(){super(...arguments),this.chars=Object.create(null),this.lineHeight=0,this.fontFamily="",this.fontMetrics={fontSize:0,ascent:0,descent:0},this.baseLineOffset=0,this.distanceField={type:"none",range:0},this.pages=[],this.baseMeasurementFontSize=100,this.baseRenderedFontSize=100}get font(){return t.deprecation(t.v8_0_0,"BitmapFont.font is deprecated, please use BitmapFont.fontFamily instead."),this.fontFamily}get pageTextures(){return t.deprecation(t.v8_0_0,"BitmapFont.pageTextures is deprecated, please use BitmapFont.pages instead."),this.pages}get size(){return t.deprecation(t.v8_0_0,"BitmapFont.size is deprecated, please use BitmapFont.fontMetrics.fontSize instead."),this.fontMetrics.fontSize}get distanceFieldRange(){return t.deprecation(t.v8_0_0,"BitmapFont.distanceFieldRange is deprecated, please use BitmapFont.distanceField.range instead."),this.distanceField.range}get distanceFieldType(){return t.deprecation(t.v8_0_0,"BitmapFont.distanceFieldType is deprecated, please use BitmapFont.distanceField.type instead."),this.distanceField.type}destroy(t=!1){for(var e in this.emit("destroy",this),this.removeAllListeners(),this.chars)this.chars[e].texture.destroy();this.chars=null,t&&(this.pages.forEach((t=>t.texture.destroy(!0))),this.pages=null)}}function se(t){if(""===t)return[];"string"==typeof t&&(t=[t]);for(var e=[],r=0,i=t.length;r<i;r++){var a=t[r];if(Array.isArray(a)){if(2!==a.length)throw new Error(`[BitmapFont]: Invalid character range length, expecting 2 got ${a.length}.`);if(0===a[0].length||0===a[1].length)throw new Error("[BitmapFont]: Invalid character delimiter.");var s=a[0].charCodeAt(0),n=a[1].charCodeAt(0);if(n<s)throw new Error("[BitmapFont]: Invalid character range.");for(var o=s,h=n;o<=h;o++)e.push(String.fromCharCode(o))}else e.push(...Array.from(a))}if(0===e.length)throw new Error("[BitmapFont]: Empty set when resolving characters.");return e}class DynamicBitmapFont extends AbstractBitmapFont{constructor(e){super(),this.resolution=1,this.pages=[],this._padding=4,this._measureCache=Object.create(null),this._currentChars=[],this._currentX=0,this._currentY=0,this._currentPageIndex=-1,this._skipKerning=!1;var r=e,i=r.style.clone();r.overrideFill&&(i._fill.color=16777215,i._fill.alpha=1,i._fill.texture=t.Texture.WHITE,i._fill.fill=null);var a=i.fontSize;i.fontSize=this.baseMeasurementFontSize;var s=Xt(i);r.overrideSize?i._stroke&&(i._stroke.width*=this.baseRenderedFontSize/a):i.fontSize=this.baseRenderedFontSize=a,this._style=i,this._skipKerning=r.skipKerning??!1,this.resolution=r.resolution??1,this._padding=r.padding??4,this.fontMetrics=Qt.measureFont(s),this.lineHeight=i.lineHeight||this.fontMetrics.fontSize||i.fontSize}ensureCharacters(e){var r=se(e).filter((t=>!this._currentChars.includes(t))).filter(((t,e,r)=>r.indexOf(t)===e));if(r.length){var i;this._currentChars=[...this._currentChars,...r];for(var a=(i=-1===this._currentPageIndex?this._nextPage():this.pages[this._currentPageIndex]).canvasAndContext,s=a.canvas,n=a.context,o=i.texture.source,h=this._style,l=this._currentX,u=this._currentY,d=this.baseRenderedFontSize/this.baseMeasurementFontSize,c=this._padding*d,p="italic"===h.fontStyle?2:1,f=0,g=!1,x=0;x<r.length;x++){var v=r[x],m=Qt.measureText(v,h,s,!1);m.lineHeight=m.height;var _=p*m.width*d,y=_+2*c,b=m.height*d+2*c;if(g=!1,"\n"!==v&&"\r"!==v&&"\t"!==v&&" "!==v&&(g=!0,f=Math.ceil(Math.max(b,f))),l+y>512&&(l=0,(u+=f)+(f=b)>512)){o.update();var S=this._nextPage();s=S.canvasAndContext.canvas,n=S.canvasAndContext.context,o=S.texture.source,u=0}var T=_/d-(h.dropShadow?.distance??0)-(h._stroke?.width??0);if(this.chars[v]={id:v.codePointAt(0),xOffset:-this._padding,yOffset:-this._padding,xAdvance:T,kerning:{}},g){this._drawGlyph(n,m,l+c,u+c,d,h);var w=o.width*d,P=o.height*d,M=new t.Rectangle(l/w*o.width,u/P*o.height,y/w*o.width,b/P*o.height);this.chars[v].texture=new t.Texture({source:o,frame:M}),l+=Math.ceil(y)}}o.update(),this._currentX=l,this._currentY=u,this._skipKerning&&this._applyKerning(r,n)}}get pageTextures(){return t.deprecation(t.v8_0_0,"BitmapFont.pageTextures is deprecated, please use BitmapFont.pages instead."),this.pages}_applyKerning(t,e){for(var r=this._measureCache,i=0;i<t.length;i++)for(var a=t[i],s=0;s<this._currentChars.length;s++){var n=this._currentChars[s],o=r[a];o||(o=r[a]=e.measureText(a).width);var h=r[n];h||(h=r[n]=e.measureText(n).width);var l=e.measureText(a+n).width,u=l-(o+h);u&&(this.chars[a].kerning[n]=u),(u=(l=e.measureText(a+n).width)-(o+h))&&(this.chars[n].kerning[a]=u)}}_nextPage(){this._currentPageIndex++;var e=this.resolution,r=ie.getOptimalCanvasAndContext(512,512,e);this._setupContext(r.context,this._style,e);var i=e*(this.baseRenderedFontSize/this.baseMeasurementFontSize),a={canvasAndContext:r,texture:new t.Texture({source:new t.ImageSource({resource:r.canvas,resolution:i,alphaMode:"premultiply-alpha-on-upload"})})};return this.pages[this._currentPageIndex]=a,a}_setupContext(e,r,i){r.fontSize=this.baseRenderedFontSize,e.scale(i,i),e.font=Xt(r),r.fontSize=this.baseMeasurementFontSize,e.textBaseline=r.textBaseline;var a=r._stroke,s=a?.width??0;if(a&&(e.lineWidth=s,e.lineJoin=a.join,e.miterLimit=a.miterLimit,e.strokeStyle=ae(a,e)),r._fill&&(e.fillStyle=ae(r._fill,e)),r.dropShadow){var n=r.dropShadow,o=t.Color.shared.setValue(n.color).toArray(),h=n.blur*i,l=n.distance*i;e.shadowColor=`rgba(${255*o[0]},${255*o[1]},${255*o[2]},${n.alpha})`,e.shadowBlur=h,e.shadowOffsetX=Math.cos(n.angle)*l,e.shadowOffsetY=Math.sin(n.angle)*l}else e.shadowColor="black",e.shadowBlur=0,e.shadowOffsetX=0,e.shadowOffsetY=0}_drawGlyph(t,e,r,i,a,s){var n=e.text,o=e.fontProperties,h=s._stroke,l=(h?.width??0)*a,u=r+l/2,d=i-l/2,c=o.descent*a,p=e.lineHeight*a;s.stroke&&l&&t.strokeText(n,u,d+p-c),s._fill&&t.fillText(n,u,d+p-c)}destroy(){super.destroy();for(var t=0;t<this.pages.length;t++){var e=this.pages[t],r=e.canvasAndContext,i=e.texture;ie.returnCanvasAndContext(r),i.destroy(!0)}this.pages=null}}function ne(t,e,r){var i={width:0,height:0,offsetY:0,scale:e.fontSize/r.baseMeasurementFontSize,lines:[{width:0,charPositions:[],spaceWidth:0,spacesIndex:[],chars:[]}]};i.offsetY=r.baseLineOffset;for(var a=i.lines[0],s=null,n=!0,o={spaceWord:!1,width:0,start:0,index:0,positions:[],chars:[]},h=t=>{for(var e=a.width,r=0;r<o.index;r++){var i=t.positions[r];a.chars.push(t.chars[r]),a.charPositions.push(i+e)}a.width+=t.width,n=!1,o.width=0,o.index=0,o.chars.length=0},l=()=>{for(var t=a.chars.length-1,e=a.chars[t];" "===e;)a.width-=r.chars[e].xAdvance,e=a.chars[--t];i.width=Math.max(i.width,a.width),a={width:0,charPositions:[],chars:[],spaceWidth:0,spacesIndex:[]},n=!0,i.lines.push(a),i.height+=r.lineHeight},u=r.baseMeasurementFontSize/e.fontSize,d=e.letterSpacing*u,c=e.wordWrapWidth*u,p=0;p<t.length+1;p++){var f=void 0,g=p===t.length;g||(f=t[p]);var x=r.chars[f]||r.chars[" "];if(/(?:\s)/.test(f)||"\r"===f||"\n"===f||g){if(!n&&e.wordWrap&&a.width+o.width-d>c?(l(),h(o),g||a.charPositions.push(0)):(o.start=a.width,h(o),g||a.charPositions.push(0)),"\r"===f||"\n"===f)0!==a.width&&l();else if(!g){var v=x.xAdvance+(x.kerning[s]||0)+d;a.width+=v,a.spaceWidth=v,a.spacesIndex.push(a.charPositions.length),a.chars.push(f)}}else{var m=x.kerning[s]||0,_=x.xAdvance+m+d;o.positions[o.index++]=o.width+m,o.chars.push(f),o.width+=_}s=f}return l(),"center"===e.align?function(t){for(var e=0;e<t.lines.length;e++)for(var r=t.lines[e],i=t.width/2-r.width/2,a=0;a<r.charPositions.length;a++)r.charPositions[a]+=i}(i):"right"===e.align?function(t){for(var e=0;e<t.lines.length;e++)for(var r=t.lines[e],i=t.width-r.width,a=0;a<r.charPositions.length;a++)r.charPositions[a]+=i}(i):"justify"===e.align&&function(t){for(var e=t.width,r=0;r<t.lines.length;r++)for(var i=t.lines[r],a=0,s=i.spacesIndex[a++],n=0,o=i.spacesIndex.length,h=(e-i.width)/o,l=0;l<i.charPositions.length;l++)l===s&&(s=i.spacesIndex[a++],n+=h),i.charPositions[l]+=n}(i),i}var oe=new class BitmapFontManagerClass{constructor(){this.ALPHA=[["a","z"],["A","Z"]," "],this.NUMERIC=[["0","9"]],this.ALPHANUMERIC=[["a","z"],["A","Z"],["0","9"]," "],this.ASCII=[[" ","~"]],this.defaultOptions={chars:this.ALPHANUMERIC,resolution:1,padding:4,skipKerning:!1}}getFont(e,r){var i=`${r.fontFamily}-bitmap`,a=!0;if(r._fill.fill&&(i+=r._fill.fill.uid,a=!1),!t.Cache.has(i)){var s=new DynamicBitmapFont({style:r,overrideFill:a,overrideSize:!0,...this.defaultOptions});s.once("destroy",(()=>t.Cache.remove(i))),t.Cache.set(i,s)}var n=t.Cache.get(i);return n.ensureCharacters?.(e),n}getLayout(t,e){var r=this.getFont(t,e);return ne(t.split(""),e,r)}measureText(t,e){return this.getLayout(t,e)}install(...e){var r=e[0];"string"==typeof r&&(r={name:r,style:e[1],chars:e[2]?.chars,resolution:e[2]?.resolution,padding:e[2]?.padding,skipKerning:e[2]?.skipKerning},t.deprecation(t.v8_0_0,"BitmapFontManager.install(name, style, options) is deprecated, use BitmapFontManager.install({name, style, ...options})"));var i=r?.name;if(!i)throw new Error("[BitmapFontManager] Property `name` is required.");var a=(r={...this.defaultOptions,...r}).style,s=a instanceof re?a:new re(a),n=null!==s._fill.fill&&void 0!==s._fill.fill,o=new DynamicBitmapFont({style:s,overrideFill:n,skipKerning:r.skipKerning,padding:r.padding,resolution:r.resolution,overrideSize:!1}),h=se(r.chars);return o.ensureCharacters(h.join("")),t.Cache.set(`${i}-bitmap`,o),o.once("destroy",(()=>t.Cache.remove(`${i}-bitmap`))),o}uninstall(e){var r=`${e}-bitmap`,i=t.Cache.get(r);i&&(t.Cache.remove(r),i.destroy())}};function he(e){var r=e._stroke,i=e._fill,a=[`div { ${[`color: ${t.Color.shared.setValue(i.color).toHex()}`,`font-size: ${e.fontSize}px`,`font-family: ${e.fontFamily}`,`font-weight: ${e.fontWeight}`,`font-style: ${e.fontStyle}`,`font-variant: ${e.fontVariant}`,`letter-spacing: ${e.letterSpacing}px`,`text-align: ${e.align}`,`padding: ${e.padding}px`,`white-space: ${"pre"===e.whiteSpace&&e.wordWrap?"pre-wrap":e.whiteSpace}`,...e.lineHeight?[`line-height: ${e.lineHeight}px`]:[],...e.wordWrap?["word-wrap: "+(e.breakWords?"break-all":"break-word"),`max-width: ${e.wordWrapWidth}px`]:[],...r?[ue(r)]:[],...e.dropShadow?[le(e.dropShadow)]:[],...e.cssOverrides].join(";")} }`];return function(t,e){for(var r in t){var i=t[r],a=[];for(var s in i)ce[s]?a.push(ce[s](i[s])):de[s]&&a.push(de[s].replace("{{VALUE}}",i[s]));e.push(`${r} { ${a.join(";")} }`)}}(e.tagStyles,a),a.join(" ")}function le(e){var r=t.Color.shared.setValue(e.color).setAlpha(e.alpha).toHexa(),i=`${Math.round(Math.cos(e.angle)*e.distance)}px ${Math.round(Math.sin(e.angle)*e.distance)}px`;return e.blur>0?`text-shadow: ${i} ${e.blur}px ${r}`:`text-shadow: ${i} ${r}`}function ue(e){return[`-webkit-text-stroke-width: ${e.width}px`,`-webkit-text-stroke-color: ${t.Color.shared.setValue(e.color).toHex()}`,`text-stroke-width: ${e.width}px`,`text-stroke-color: ${t.Color.shared.setValue(e.color).toHex()}`,"paint-order: stroke"].join(";")}var de={fontSize:"font-size: {{VALUE}}px",fontFamily:"font-family: {{VALUE}}",fontWeight:"font-weight: {{VALUE}}",fontStyle:"font-style: {{VALUE}}",fontVariant:"font-variant: {{VALUE}}",letterSpacing:"letter-spacing: {{VALUE}}px",align:"text-align: {{VALUE}}",padding:"padding: {{VALUE}}px",whiteSpace:"white-space: {{VALUE}}",lineHeight:"line-height: {{VALUE}}px",wordWrapWidth:"max-width: {{VALUE}}px"},ce={fill:e=>`color: ${t.Color.shared.setValue(e).toHex()}`,breakWords:t=>"word-wrap: "+(t?"break-all":"break-word"),stroke:ue,dropShadow:le};class HTMLTextStyle extends re{constructor(t={}){super(t),this._cssOverrides=[],this.cssOverrides??(this.cssOverrides=t.cssOverrides),this.tagStyles=t.tagStyles??{}}set cssOverrides(t){this._cssOverrides=t instanceof Array?t:[t],this.update()}get cssOverrides(){return this._cssOverrides}_generateKey(){return this._styleKey=Jt(this)+this._cssOverrides.join("-"),this._styleKey}update(){this._cssStyle=null,super.update()}clone(){return new HTMLTextStyle({align:this.align,breakWords:this.breakWords,dropShadow:this.dropShadow,fill:this._fill,fontFamily:this.fontFamily,fontSize:this.fontSize,fontStyle:this.fontStyle,fontVariant:this.fontVariant,fontWeight:this.fontWeight,letterSpacing:this.letterSpacing,lineHeight:this.lineHeight,padding:this.padding,stroke:this._stroke,whiteSpace:this.whiteSpace,wordWrap:this.wordWrap,wordWrapWidth:this.wordWrapWidth,cssOverrides:this.cssOverrides})}get cssStyle(){return this._cssStyle||(this._cssStyle=he(this)),this._cssStyle}addOverride(...t){var e=t.filter((t=>!this.cssOverrides.includes(t)));e.length>0&&(this.cssOverrides.push(...e),this.update())}removeOverride(...t){var e=t.filter((t=>this.cssOverrides.includes(t)));e.length>0&&(this.cssOverrides=this.cssOverrides.filter((t=>!e.includes(t))),this.update())}set fill(e){"string"!=typeof e&&"number"!=typeof e&&t.warn("[HTMLTextStyle] only color fill is not supported by HTMLText"),super.fill=e}set stroke(e){e&&"string"!=typeof e&&"number"!=typeof e&&t.warn("[HTMLTextStyle] only color stroke is not supported by HTMLText"),super.stroke=e}}var pe,fe="http://www.w3.org/2000/svg",ge="http://www.w3.org/1999/xhtml";class HTMLTextRenderData{constructor(){this.svgRoot=document.createElementNS(fe,"svg"),this.foreignObject=document.createElementNS(fe,"foreignObject"),this.domElement=document.createElementNS(ge,"div"),this.styleElement=document.createElementNS(ge,"style"),this.image=new Image;var t=this.foreignObject,e=this.svgRoot,r=this.styleElement,i=this.domElement;t.setAttribute("width","10000"),t.setAttribute("height","10000"),t.style.overflow="hidden",e.appendChild(t),t.appendChild(r),t.appendChild(i)}}function xe(e,r,i){if(e)for(var a in e){var s=r[a.toLocaleLowerCase()];if(s){var n=e[a];"header"===a&&(n=n.replace(/@in\s+[^;]+;\s*/g,"").replace(/@out\s+[^;]+;\s*/g,"")),i&&s.push(`//----${i}----//`),s.push(n)}else t.warn(`${a} placement hook does not exist in shader`)}}var ve=/\{\{(.*?)\}\}/g;function me(t){var e={};return(t.match(ve)?.map((t=>t.replace(/[{()}]/g,"")))??[]).forEach((t=>{e[t]=[]})),e}function _e(t,e){for(var r,i=/@in\s+([^;]+);/g;null!==(r=i.exec(t));)e.push(r[1])}function ye(t,e,r=!1){var i=[];_e(e,i),t.forEach((t=>{t.header&&_e(t.header,i)}));var a=i;r&&a.sort();var s=a.map(((t,e)=>`       @location(${e}) ${t},`)).join("\n"),n=e.replace(/@in\s+[^;]+;\s*/g,"");return n=n.replace("{{in}}",`\n${s}\n`)}function be(t,e){for(var r,i=/@out\s+([^;]+);/g;null!==(r=i.exec(t));)e.push(r[1])}function Se(t,e){var r=t;for(var i in e){var a=e[i];r=a.join("\n").length?r.replace(`{{${i}}}`,`//-----${i} START-----//\n${a.join("\n")}\n//----${i} FINISH----//`):r.replace(`{{${i}}}`,"")}return r}var Te=Object.create(null),we=new Map,Pe=0;function Me({template:t,bits:e}){var r=Be(t,e);if(Te[r])return Te[r];var i=function(t,e){var r=e.map((t=>t.vertex)).filter((t=>!!t)),i=e.map((t=>t.fragment)).filter((t=>!!t)),a=ye(r,t.vertex,!0);a=function(t,e){var r=[];be(e,r),t.forEach((t=>{t.header&&be(t.header,r)}));var i=0,a=r.sort().map((t=>t.indexOf("builtin")>-1?t:`@location(${i++}) ${t}`)).join(",\n"),s=r.sort().map((t=>{return`       var ${e=t,e.replace(/@.*?\s+/g,"")};`;var e})).join("\n"),n=`return VSOutput(\n                ${r.sort().map((t=>{return` ${e=t,r=/\b(\w+)\s*:/g.exec(e),r?r[1]:""}`;var e,r})).join(",\n")});`,o=e.replace(/@out\s+[^;]+;\s*/g,"");return(o=(o=o.replace("{{struct}}",`\n${a}\n`)).replace("{{start}}",`\n${s}\n`)).replace("{{return}}",`\n${n}\n`)}(r,a);var s=ye(i,t.fragment,!0);return{vertex:a,fragment:s}}(t,e),a=i.vertex,s=i.fragment;return Te[r]=ke(a,s,e),Te[r]}function Ce({template:t,bits:e}){var r=Be(t,e);return Te[r]||(Te[r]=ke(t.vertex,t.fragment,e)),Te[r]}function Be(t,e){return e.map((t=>(we.has(t)||we.set(t,Pe++),we.get(t)))).sort(((t,e)=>t-e)).join("-")+t.vertex+t.fragment}function ke(t,e,r){var i=me(t),a=me(e);return r.forEach((t=>{xe(t.vertex,i,t.name),xe(t.fragment,a,t.name)})),{vertex:Se(t,i),fragment:Se(e,a)}}var Ae={name:"global-uniforms-bit",vertex:{header:"\n        struct GlobalUniforms {\n            uProjectionMatrix:mat3x3<f32>,\n            uWorldTransformMatrix:mat3x3<f32>,\n            uWorldColorAlpha: vec4<f32>,\n            uResolution: vec2<f32>,\n        }\n\n        @group(0) @binding(0) var<uniform> globalUniforms : GlobalUniforms;\n        "}},Re={name:"global-uniforms-bit",vertex:{header:"\n          uniform mat3 uProjectionMatrix;\n          uniform mat3 uWorldTransformMatrix;\n          uniform vec4 uWorldColorAlpha;\n          uniform vec2 uResolution;\n        "}};function Fe({bits:t,name:e}){var r=Me({template:{fragment:"\n    @in vUV : vec2<f32>;\n    @in vColor : vec4<f32>;\n   \n    {{header}}\n\n    @fragment\n    fn main(\n        {{in}}\n      ) -> @location(0) vec4<f32> {\n        \n        {{start}}\n\n        var outColor:vec4<f32>;\n      \n        {{main}}\n        \n        return outColor * vColor;\n      };\n",vertex:"\n    @in aPosition: vec2<f32>;\n    @in aUV: vec2<f32>;\n\n    @out @builtin(position) vPosition: vec4<f32>;\n    @out vUV : vec2<f32>;\n    @out vColor : vec4<f32>;\n\n    {{header}}\n\n    struct VSOutput {\n        {{struct}}\n    };\n\n    @vertex\n    fn main( {{in}} ) -> VSOutput {\n\n        var worldTransformMatrix = globalUniforms.uWorldTransformMatrix;\n        var modelMatrix = mat3x3<f32>(\n            1.0, 0.0, 0.0,\n            0.0, 1.0, 0.0,\n            0.0, 0.0, 1.0\n          );\n        var position = aPosition;\n        var uv = aUV;\n\n        {{start}}\n        \n        vColor = vec4<f32>(1., 1., 1., 1.);\n\n        {{main}}\n\n        vUV = uv;\n\n        var modelViewProjectionMatrix = globalUniforms.uProjectionMatrix * worldTransformMatrix * modelMatrix;\n\n        vPosition =  vec4<f32>((modelViewProjectionMatrix *  vec3<f32>(position, 1.0)).xy, 0.0, 1.0);\n       \n        vColor *= globalUniforms.uWorldColorAlpha;\n\n        {{end}}\n\n        {{return}}\n    };\n"},bits:[Ae,...t]});return GpuProgram.from({name:e,vertex:{source:r.vertex,entryPoint:"main"},fragment:{source:r.fragment,entryPoint:"main"}})}function ze({bits:t,name:e}){return new c({name:e,...Ce({template:{vertex:"\n    in vec2 aPosition;\n    in vec2 aUV;\n\n    out vec4 vColor;\n    out vec2 vUV;\n\n    {{header}}\n\n    void main(void){\n\n        mat3 worldTransformMatrix = uWorldTransformMatrix;\n        mat3 modelMatrix = mat3(\n            1.0, 0.0, 0.0,\n            0.0, 1.0, 0.0,\n            0.0, 0.0, 1.0\n          );\n        vec2 position = aPosition;\n        vec2 uv = aUV;\n        \n        {{start}}\n        \n        vColor = vec4(1.);\n        \n        {{main}}\n        \n        vUV = uv;\n        \n        mat3 modelViewProjectionMatrix = uProjectionMatrix * worldTransformMatrix * modelMatrix;\n\n        gl_Position = vec4((modelViewProjectionMatrix * vec3(position, 1.0)).xy, 0.0, 1.0);\n\n        vColor *= uWorldColorAlpha;\n\n        {{end}}\n    }\n",fragment:"\n   \n    in vec4 vColor;\n    in vec2 vUV;\n\n    out vec4 finalColor;\n\n    {{header}}\n\n    void main(void) {\n        \n        {{start}}\n\n        vec4 outColor;\n      \n        {{main}}\n        \n        finalColor = outColor * vColor;\n    }\n"},bits:[Re,...t]})})}var Ee={name:"color-bit",vertex:{header:"\n            @in aColor: vec4<f32>;\n        ",main:"\n            vColor *= vec4<f32>(aColor.rgb * aColor.a, aColor.a);\n        "}},Ie={name:"color-bit",vertex:{header:"\n            in vec4 aColor;\n        ",main:"\n            vColor *= vec4(aColor.rgb * aColor.a, aColor.a);\n        "}},Ue={};function Ge(t){var e=[];if(1===t)e.push("@group(1) @binding(0) var textureSource1: texture_2d<f32>;"),e.push("@group(1) @binding(1) var textureSampler1: sampler;");else for(var r=0,i=0;i<t;i++)e.push(`@group(1) @binding(${r++}) var textureSource${i+1}: texture_2d<f32>;`),e.push(`@group(1) @binding(${r++}) var textureSampler${i+1}: sampler;`);return e.join("\n")}function Oe(t){var e=[];if(1===t)e.push("outColor = textureSampleGrad(textureSource1, textureSampler1, vUV, uvDx, uvDy);");else{e.push("switch vTextureId {");for(var r=0;r<t;r++)r===t-1?e.push("  default:{"):e.push(`  case ${r}:{`),e.push(`      outColor = textureSampleGrad(textureSource${r+1}, textureSampler${r+1}, vUV, uvDx, uvDy);`),e.push("      break;}");e.push("}")}return e.join("\n")}var De={};function We(t){for(var e=[],r=0;r<t;r++)r>0&&e.push("else"),r<t-1&&e.push(`if(vTextureId < ${r}.5)`),e.push("{"),e.push(`\toutColor = texture(uTextures[${r}], vUV);`),e.push("}");return e.join("\n")}function He(t){return De[t]||(De[t]={name:"texture-batch-bit",vertex:{header:"\n                in vec2 aTextureIdAndRound;\n                out float vTextureId;\n              \n            ",main:"\n                vTextureId = aTextureIdAndRound.y;\n            ",end:"\n                if(aTextureIdAndRound.x == 1.)\n                {\n                    gl_Position.xy = roundPixels(gl_Position.xy, uResolution);\n                }\n            "},fragment:{header:`\n                in float vTextureId;\n    \n                uniform sampler2D uTextures[${t}];\n              \n            `,main:`\n    \n                ${We(16)}\n            `}}),De[t]}for(var Le={name:"round-pixels-bit",vertex:{header:"\n            fn roundPixels(position: vec2<f32>, targetSize: vec2<f32>) -> vec2<f32> \n            {\n                return (floor(((position * 0.5 + 0.5) * targetSize) + 0.5) / targetSize) * 2.0 - 1.0;\n            }\n        "}},Ve={name:"round-pixels-bit",vertex:{header:"   \n            vec2 roundPixels(vec2 position, vec2 targetSize)\n            {       \n                return (floor(((position * 0.5 + 0.5) * targetSize) + 0.5) / targetSize) * 2.0 - 1.0;\n            }\n        "}},$e=new Int32Array(O),Ne=0;Ne<O;Ne++)$e[Ne]=Ne;var je=new b({uTextures:{value:$e,type:"i32",size:O}},{isStatic:!0}),Ye={name:"local-uniform-bit",vertex:{header:"\n\n            struct LocalUniforms {\n                uTransformMatrix:mat3x3<f32>,\n                uColor:vec4<f32>,\n                uRound:f32,\n            }\n\n            @group(1) @binding(0) var<uniform> localUniforms : LocalUniforms;\n        ",main:"\n            vColor *= localUniforms.uColor;\n            modelMatrix *= localUniforms.uTransformMatrix;\n        ",end:"\n            if(localUniforms.uRound == 1)\n            {\n                vPosition = vec4(roundPixels(vPosition.xy, globalUniforms.uResolution), vPosition.zw);\n            }\n        "}};Ye.vertex,Ye.vertex.header.replace("group(1)","group(2)");var Xe={name:"local-uniform-bit",vertex:{header:"\n\n            uniform mat3 uTransformMatrix;\n            uniform vec4 uColor;\n            uniform float uRound;\n        ",main:"\n            vColor *= uColor;\n            modelMatrix = uTransformMatrix;\n        ",end:"\n            if(uRound == 1.)\n            {\n                gl_Position.xy = roundPixels(gl_Position.xy, uResolution);\n            }\n        "}};class BatchableSprite{constructor(){this.vertexSize=4,this.indexSize=6,this.location=0,this.batcher=null,this.batch=null,this.roundPixels=0}get blendMode(){return this.renderable.groupBlendMode}packAttributes(t,e,r,i){var a=this.renderable,s=this.texture,n=a.groupTransform,o=n.a,h=n.b,l=n.c,u=n.d,d=n.tx,c=n.ty,p=this.bounds,f=p.maxX,g=p.minX,x=p.maxY,v=p.minY,m=s.uvs,_=a.groupColorAlpha,y=i<<16|65535&this.roundPixels;t[r+0]=o*g+l*v+d,t[r+1]=u*v+h*g+c,t[r+2]=m.x0,t[r+3]=m.y0,e[r+4]=_,e[r+5]=y,t[r+6]=o*f+l*v+d,t[r+7]=u*v+h*f+c,t[r+8]=m.x1,t[r+9]=m.y1,e[r+10]=_,e[r+11]=y,t[r+12]=o*f+l*x+d,t[r+13]=u*x+h*f+c,t[r+14]=m.x2,t[r+15]=m.y2,e[r+16]=_,e[r+17]=y,t[r+18]=o*g+l*x+d,t[r+19]=u*x+h*g+c,t[r+20]=m.x3,t[r+21]=m.y3,e[r+22]=_,e[r+23]=y}packIndex(t,e,r){t[e]=r+0,t[e+1]=r+1,t[e+2]=r+2,t[e+3]=r+0,t[e+4]=r+2,t[e+5]=r+3}reset(){this.renderable=null,this.texture=null,this.batcher=null,this.batch=null,this.bounds=null}}function qe(t,e,r){var i=(t>>24&255)/255;e[r++]=(255&t)/255*i,e[r++]=(t>>8&255)/255*i,e[r++]=(t>>16&255)/255*i,e[r++]=i}class GraphicsPipe{constructor(t,e){this.state=P.for2d(),this._graphicsBatchesHash=Object.create(null),this.renderer=t,this._adaptor=e,this._adaptor.init()}validateRenderable(t){var e=t.context,r=!!this._graphicsBatchesHash[t.uid],i=this.renderer.graphicsContext.updateGpuContext(e);return!(!i.isBatchable&&r===i.isBatchable)}addRenderable(t,e){var r=this.renderer.graphicsContext.updateGpuContext(t.context);t._didGraphicsUpdate&&(t._didGraphicsUpdate=!1,this._rebuild(t)),r.isBatchable?this._addToBatcher(t,e):(this.renderer.renderPipes.batch.break(e),e.add(t))}updateRenderable(t){var e=this._graphicsBatchesHash[t.uid];if(e)for(var r=0;r<e.length;r++){var i=e[r];i.batcher.updateElement(i)}}destroyRenderable(t){this._graphicsBatchesHash[t.uid]&&this._removeBatchForRenderable(t.uid)}execute(t){if(t.isRenderable){var e=this.renderer,r=t.context;if(e.graphicsContext.getGpuContext(r).batches.length){var i=r.customShader||this._adaptor.shader;this.state.blendMode=t.groupBlendMode;var a=i.resources.localUniforms.uniforms;a.uTransformMatrix=t.groupTransform,a.uRound=e._roundPixels|t._roundPixels,qe(t.groupColorAlpha,a.uColor,0),this._adaptor.execute(this,t)}}}_rebuild(t){var e=!!this._graphicsBatchesHash[t.uid],r=this.renderer.graphicsContext.updateGpuContext(t.context);e&&this._removeBatchForRenderable(t.uid),r.isBatchable&&this._initBatchesForRenderable(t),t.batched=r.isBatchable}_addToBatcher(t,e){for(var r=this.renderer.renderPipes.batch,i=this._getBatchesForRenderable(t),a=0;a<i.length;a++){var s=i[a];r.addToBatch(s,e)}}_getBatchesForRenderable(t){return this._graphicsBatchesHash[t.uid]||this._initBatchesForRenderable(t)}_initBatchesForRenderable(e){var r=e.context,i=this.renderer.graphicsContext.getGpuContext(r),a=this.renderer._roundPixels|e._roundPixels,s=i.batches.map((r=>{var i=t.BigPool.get(BatchableGraphics);return r.copyTo(i),i.renderable=e,i.roundPixels=a,i}));return this._graphicsBatchesHash[e.uid]=s,e.on("destroyed",(()=>{this.destroyRenderable(e)})),s}_removeBatchForRenderable(e){this._graphicsBatchesHash[e].forEach((e=>{t.BigPool.return(e)})),this._graphicsBatchesHash[e]=null}destroy(){for(var t in this.renderer=null,this._adaptor.destroy(),this._adaptor=null,this.state=null,this._graphicsBatchesHash)this._removeBatchForRenderable(t);this._graphicsBatchesHash=null}}GraphicsPipe.extension={type:[t.ExtensionType.WebGLPipes,t.ExtensionType.WebGPUPipes,t.ExtensionType.CanvasPipes],name:"graphics"};var Ke=class e extends jt{constructor(...e){super({});var r=e[0]??{};"number"==typeof r&&(t.deprecation(t.v8_0_0,"PlaneGeometry constructor changed please use { width, height, verticesX, verticesY } instead"),r={width:r,height:e[1],verticesX:e[2],verticesY:e[3]}),this.build(r)}build(t){t={...e.defaultOptions,...t},this.verticesX=this.verticesX??t.verticesX,this.verticesY=this.verticesY??t.verticesY,this.width=this.width??t.width,this.height=this.height??t.height;for(var r=this.verticesX*this.verticesY,i=[],a=[],s=[],n=this.verticesX-1,o=this.verticesY-1,h=this.width/n,l=this.height/o,u=0;u<r;u++){var d=u%this.verticesX,c=u/this.verticesX|0;i.push(d*h,c*l),a.push(d/n,c/o)}for(var p=n*o,f=0;f<p;f++){var g=f%n,x=f/n|0,v=x*this.verticesX+g,m=x*this.verticesX+g+1,_=(x+1)*this.verticesX+g,y=(x+1)*this.verticesX+g+1;s.push(v,m,_,m,y,_)}this.buffers[0].data=new Float32Array(i),this.buffers[1].data=new Float32Array(a),this.indexBuffer.data=new Uint32Array(s),this.buffers[0].update(),this.buffers[1].update(),this.indexBuffer.update()}};Ke.defaultOptions={width:100,height:100,verticesX:10,verticesY:10};var Qe=Ke;class BatchableMesh{constructor(){this.batcher=null,this.batch=null,this.roundPixels=0,this._uvUpdateId=-1,this._textureMatrixUpdateId=-1}get blendMode(){return this.mesh.groupBlendMode}reset(){this.mesh=null,this.texture=null,this.batcher=null,this.batch=null}packIndex(t,e,r){for(var i=this.geometry.indices,a=0;a<i.length;a++)t[e++]=i[a]+r}packAttributes(t,e,r,i){var a=this.mesh,s=this.geometry,n=a.groupTransform,o=i<<16|65535&this.roundPixels,h=n.a,l=n.b,u=n.c,d=n.d,c=n.tx,p=n.ty,f=s.positions,g=s.getBuffer("aUV"),x=g.data,v=x,m=this.texture.textureMatrix;m.isSimple||(v=this._transformedUvs,this._textureMatrixUpdateId===m._updateID&&this._uvUpdateId===g._updateID||((!v||v.length<x.length)&&(v=this._transformedUvs=new Float32Array(x.length)),this._textureMatrixUpdateId=m._updateID,this._uvUpdateId=g._updateID,m.multiplyUvs(x,v)));for(var _=a.groupColorAlpha,y=0;y<f.length;y+=2){var b=f[y],S=f[y+1];t[r]=h*b+u*S+c,t[r+1]=l*b+d*S+p,t[r+2]=v[y],t[r+3]=v[y+1],e[r+4]=_,e[r+5]=o,r+=6}}get vertexSize(){return this.geometry.positions.length/2}get indexSize(){return this.geometry.indices.length}}class MeshPipe{constructor(e,r){this.localUniforms=new b({uTransformMatrix:{value:new t.Matrix,type:"mat3x3<f32>"},uColor:{value:new Float32Array([1,1,1,1]),type:"vec4<f32>"},uRound:{value:0,type:"f32"}}),this.localUniformsBindGroup=new BindGroup({0:this.localUniforms}),this._meshDataHash=Object.create(null),this._gpuBatchableMeshHash=Object.create(null),this.renderer=e,this._adaptor=r,this._adaptor.init()}validateRenderable(t){var e=this._getMeshData(t),r=e.batched,i=t.batched;if(e.batched=i,r!==i)return!0;if(i){var a=t._geometry;if(a.indices.length!==e.indexSize||a.positions.length!==e.vertexSize)return e.indexSize=a.indices.length,e.vertexSize=a.positions.length,!0;var s=this._getBatchableMesh(t),n=t.texture;if(s.texture._source!==n._source&&s.texture._source!==n._source)return!s.batcher.checkAndUpdateTexture(s,n)}return!1}addRenderable(t,e){var r=this.renderer.renderPipes.batch;if(this._getMeshData(t).batched){var i=this._getBatchableMesh(t);i.texture=t._texture,i.geometry=t._geometry,r.addToBatch(i)}else r.break(e),e.add({renderPipeId:"mesh",mesh:t})}updateRenderable(t){if(t.batched){var e=this._gpuBatchableMeshHash[t.uid];e.texture=t._texture,e.geometry=t._geometry,e.batcher.updateElement(e)}}destroyRenderable(e){this._meshDataHash[e.uid]=null;var r=this._gpuBatchableMeshHash[e.uid];r&&(t.BigPool.return(r),this._gpuBatchableMeshHash[e.uid]=null)}execute({mesh:t}){if(t.isRenderable){t.state.blendMode=t.groupBlendMode;var e=this.localUniforms;e.uniforms.uTransformMatrix=t.groupTransform,e.uniforms.uRound=this.renderer._roundPixels|t._roundPixels,e.update(),qe(t.groupColorAlpha,e.uniforms.uColor,0),this._adaptor.execute(this,t)}}_getMeshData(t){return this._meshDataHash[t.uid]||this._initMeshData(t)}_initMeshData(t){return this._meshDataHash[t.uid]={batched:t.batched,indexSize:t._geometry.indices?.length,vertexSize:t._geometry.positions?.length},t.on("destroyed",(()=>{this.destroyRenderable(t)})),this._meshDataHash[t.uid]}_getBatchableMesh(t){return this._gpuBatchableMeshHash[t.uid]||this._initBatchableMesh(t)}_initBatchableMesh(e){var r=t.BigPool.get(BatchableMesh);return r.mesh=e,r.texture=e._texture,r.roundPixels=this.renderer._roundPixels|e._roundPixels,this._gpuBatchableMeshHash[e.uid]=r,r.mesh=e,r}destroy(){for(var e in this._gpuBatchableMeshHash)this._gpuBatchableMeshHash[e]&&t.BigPool.return(this._gpuBatchableMeshHash[e]);this._gpuBatchableMeshHash=null,this._meshDataHash=null,this.localUniforms=null,this.localUniformsBindGroup=null,this._adaptor.destroy(),this._adaptor=null,this.renderer=null}}MeshPipe.extension={type:[t.ExtensionType.WebGLPipes,t.ExtensionType.WebGPUPipes,t.ExtensionType.CanvasPipes],name:"mesh"};var Ze=class t extends Qe{constructor(e={}){super({width:(e={...t.defaultOptions,...e}).width,height:e.height,verticesX:4,verticesY:4}),this.update(e)}update(t){this.width=t.width??this.width,this.height=t.height??this.height,this._originalWidth=t.originalWidth??this._originalWidth,this._originalHeight=t.originalHeight??this._originalHeight,this._leftWidth=t.leftWidth??this._leftWidth,this._rightWidth=t.rightWidth??this._rightWidth,this._topHeight=t.topHeight??this._topHeight,this._bottomHeight=t.bottomHeight??this._bottomHeight,this.updateUvs(),this.updatePositions()}updatePositions(){var t=this.positions,e=this._leftWidth+this._rightWidth,r=this.width>e?1:this.width/e,i=this._topHeight+this._bottomHeight,a=this.height>i?1:this.height/i,s=Math.min(r,a);t[9]=t[11]=t[13]=t[15]=this._topHeight*s,t[17]=t[19]=t[21]=t[23]=this.height-this._bottomHeight*s,t[25]=t[27]=t[29]=t[31]=this.height,t[2]=t[10]=t[18]=t[26]=this._leftWidth*s,t[4]=t[12]=t[20]=t[28]=this.width-this._rightWidth*s,t[6]=t[14]=t[22]=t[30]=this.width,this.getBuffer("aPosition").update()}updateUvs(){var t=this.uvs;t[0]=t[8]=t[16]=t[24]=0,t[1]=t[3]=t[5]=t[7]=0,t[6]=t[14]=t[22]=t[30]=1,t[25]=t[27]=t[29]=t[31]=1;var e=1/this._originalWidth,r=1/this._originalHeight;t[2]=t[10]=t[18]=t[26]=e*this._leftWidth,t[9]=t[11]=t[13]=t[15]=r*this._topHeight,t[4]=t[12]=t[20]=t[28]=1-e*this._rightWidth,t[17]=t[19]=t[21]=t[23]=1-r*this._bottomHeight,this.getBuffer("aUV").update()}};Ze.defaultOptions={width:100,height:100,leftWidth:10,topHeight:10,rightWidth:10,bottomHeight:10,originalWidth:100,originalHeight:100};var Je=Ze;class NineSliceSpritePipe{constructor(t){this._gpuSpriteHash=Object.create(null),this._renderer=t}addRenderable(t,e){var r=this._getGpuSprite(t);t._didSpriteUpdate&&this._updateBatchableSprite(t,r),this._renderer.renderPipes.batch.addToBatch(r)}updateRenderable(t){var e=this._gpuSpriteHash[t.uid];t._didSpriteUpdate&&this._updateBatchableSprite(t,e),e.batcher.updateElement(e)}validateRenderable(t){var e=t._texture,r=this._getGpuSprite(t);return r.texture._source!==e._source&&!r.batcher.checkAndUpdateTexture(r,e)}destroyRenderable(e){var r=this._gpuSpriteHash[e.uid];t.BigPool.return(r),this._gpuSpriteHash[e.uid]=null}_updateBatchableSprite(t,e){t._didSpriteUpdate=!1,e.geometry.update(t),e.texture=t._texture}_getGpuSprite(t){return this._gpuSpriteHash[t.uid]||this._initGPUSprite(t)}_initGPUSprite(t){var e=new BatchableMesh;return e.geometry=new Je,e.mesh=t,e.texture=t._texture,e.roundPixels=this._renderer._roundPixels|t._roundPixels,this._gpuSpriteHash[t.uid]=e,t.on("destroyed",(()=>{this.destroyRenderable(t)})),e}destroy(){for(var t in this._gpuSpriteHash){this._gpuSpriteHash[t].geometry.destroy()}this._gpuSpriteHash=null,this._renderer=null}}NineSliceSpritePipe.extension={type:[t.ExtensionType.WebGLPipes,t.ExtensionType.WebGPUPipes,t.ExtensionType.CanvasPipes],name:"nineSliceSprite"};var tr,er,rr={name:"tiling-bit",vertex:{header:"\n            struct TilingUniforms {\n                uMapCoord:mat3x3<f32>,\n                uClampFrame:vec4<f32>,\n                uClampOffset:vec2<f32>,\n                uTextureTransform:mat3x3<f32>,\n                uSizeAnchor:vec4<f32>\n            };\n\n            @group(2) @binding(0) var<uniform> tilingUniforms: TilingUniforms;\n            @group(2) @binding(1) var uTexture: texture_2d<f32>;\n            @group(2) @binding(2) var uSampler: sampler;\n        ",main:"\n            uv = (tilingUniforms.uTextureTransform * vec3(uv, 1.0)).xy;\n\n            position = (position - tilingUniforms.uSizeAnchor.zw) * tilingUniforms.uSizeAnchor.xy;\n        "},fragment:{header:"\n            struct TilingUniforms {\n                uMapCoord:mat3x3<f32>,\n                uClampFrame:vec4<f32>,\n                uClampOffset:vec2<f32>,\n                uTextureTransform:mat3x3<f32>,\n                uSizeAnchor:vec4<f32>\n            };\n\n            @group(2) @binding(0) var<uniform> tilingUniforms: TilingUniforms;\n            @group(2) @binding(1) var uTexture: texture_2d<f32>;\n            @group(2) @binding(2) var uSampler: sampler;\n        ",main:"\n\n            var coord = vUV + ceil(tilingUniforms.uClampOffset - vUV);\n            coord = (tilingUniforms.uMapCoord * vec3(coord, 1.0)).xy;\n            var unclamped = coord;\n            coord = clamp(coord, tilingUniforms.uClampFrame.xy, tilingUniforms.uClampFrame.zw);\n\n            var bias = 0.;\n\n            if(unclamped.x == coord.x && unclamped.y == coord.y)\n            {\n                bias = -32.;\n            } \n\n            outColor = textureSampleBias(uTexture, uSampler, coord, bias);\n        "}},ir={name:"tiling-bit",vertex:{header:"\n            uniform mat3 uTextureTransform;\n            uniform vec4 uSizeAnchor;\n        \n        ",main:"\n            uv = (uTextureTransform * vec3(aUV, 1.0)).xy;\n\n            position = (position - uSizeAnchor.zw) * uSizeAnchor.xy;\n        "},fragment:{header:"\n            uniform sampler2D uTexture;\n            uniform mat3 uMapCoord;\n            uniform vec4 uClampFrame;\n            uniform vec2 uClampOffset;\n        ",main:"\n\n        vec2 coord = vUV + ceil(uClampOffset - vUV);\n        coord = (uMapCoord * vec3(coord, 1.0)).xy;\n        vec2 unclamped = coord;\n        coord = clamp(coord, uClampFrame.xy, uClampFrame.zw);\n        \n        outColor = texture(uTexture, coord, unclamped == coord ? 0.0 : -32.0);// lod-bias very negative to force lod 0\n    \n        "}};class TilingSpriteShader extends Shader{constructor(){tr??(tr=Fe({name:"tiling-sprite-shader",bits:[Ye,rr,Le]})),er??(er=ze({name:"tiling-sprite-shader",bits:[Xe,ir,Ve]}));var e=new b({uMapCoord:{value:new t.Matrix,type:"mat3x3<f32>"},uClampFrame:{value:new Float32Array([0,0,1,1]),type:"vec4<f32>"},uClampOffset:{value:new Float32Array([0,0]),type:"vec2<f32>"},uTextureTransform:{value:new t.Matrix,type:"mat3x3<f32>"},uSizeAnchor:{value:new Float32Array([100,100,.5,.5]),type:"vec4<f32>"}});super({glProgram:er,gpuProgram:tr,resources:{localUniforms:new b({uTransformMatrix:{value:new t.Matrix,type:"mat3x3<f32>"},uColor:{value:new Float32Array([1,1,1,1]),type:"vec4<f32>"},uRound:{value:0,type:"f32"}}),tilingUniforms:e,uTexture:t.Texture.EMPTY.source,uSampler:t.Texture.EMPTY.source.style}})}updateUniforms(t,e,r,i,a,s){var n=this.resources.tilingUniforms,o=s.width,h=s.height,l=s.textureMatrix,u=n.uniforms.uTextureTransform;u.set(r.a*o/t,r.b*o/e,r.c*h/t,r.d*h/e,r.tx/t,r.ty/e),u.invert(),n.uniforms.uMapCoord=l.mapCoord,n.uniforms.uClampFrame=l.uClampFrame,n.uniforms.uClampOffset=l.uClampOffset,n.uniforms.uTextureTransform=u,n.uniforms.uSizeAnchor[0]=t,n.uniforms.uSizeAnchor[1]=e,n.uniforms.uSizeAnchor[2]=i,n.uniforms.uSizeAnchor[3]=a,s&&(this.resources.uTexture=s.source,this.resources.uSampler=s.source.style)}}var ar=new class QuadGeometry extends jt{constructor(){super({positions:new Float32Array([0,0,1,0,1,1,0,1]),uvs:new Float32Array([0,0,1,0,1,1,0,1]),indices:new Uint32Array([0,1,2,0,2,3])})}};class TilingSpritePipe{constructor(t){this._tilingSpriteDataHash=Object.create(null),this._renderer=t}validateRenderable(t){var e=this._getTilingSpriteData(t),r=e.canBatch;this._updateCanBatch(t);var i=e.canBatch;if(i&&i===r){var a=e.batchableMesh;if(a.texture._source!==t.texture._source)return!a.batcher.checkAndUpdateTexture(a,t.texture)}return r!==i}addRenderable(t,e){var r=this._renderer.renderPipes.batch;this._updateCanBatch(t);var i=this._getTilingSpriteData(t),a=i.geometry;if(i.canBatch){i.batchableMesh||(i.batchableMesh=new BatchableMesh);var s=i.batchableMesh;t._didTilingSpriteUpdate&&(t._didTilingSpriteUpdate=!1,this._updateBatchableMesh(t),s.geometry=a,s.mesh=t,s.texture=t._texture),s.roundPixels=this._renderer._roundPixels|t._roundPixels,r.addToBatch(s)}else r.break(e),i.shader||(i.shader=new TilingSpriteShader),this.updateRenderable(t),e.add(t)}execute(t){var e=this._tilingSpriteDataHash[t.uid].shader;e.groups[0]=this._renderer.globalUniforms.bindGroup;var r=e.resources.localUniforms.uniforms;r.uTransformMatrix=t.groupTransform,r.uRound=this._renderer._roundPixels|t._roundPixels,qe(t.groupColorAlpha,r.uColor,0),this._renderer.encoder.draw({geometry:ar,shader:e,state:P.default2d})}updateRenderable(t){var e=this._getTilingSpriteData(t);if(e.canBatch){var r=e.batchableMesh;t._didTilingSpriteUpdate&&this._updateBatchableMesh(t),r.batcher.updateElement(r)}else if(t._didTilingSpriteUpdate){e.shader.updateUniforms(t.width,t.height,t._tileTransform.matrix,t.anchor.x,t.anchor.y,t.texture)}t._didTilingSpriteUpdate=!1}destroyRenderable(t){var e=this._getTilingSpriteData(t);e.batchableMesh=null,e.shader?.destroy(),this._tilingSpriteDataHash[t.uid]=null}_getTilingSpriteData(t){return this._tilingSpriteDataHash[t.uid]||this._initTilingSpriteData(t)}_initTilingSpriteData(t){var e=new jt({indices:ar.indices,positions:ar.positions.slice(),uvs:ar.uvs.slice()});return this._tilingSpriteDataHash[t.uid]={canBatch:!0,renderable:t,geometry:e},t.on("destroyed",(()=>{this.destroyRenderable(t)})),this._tilingSpriteDataHash[t.uid]}_updateBatchableMesh(e){var r=this._getTilingSpriteData(e).geometry,i=e.texture.source.style;"repeat"!==i.addressMode&&(i.addressMode="repeat",i.update()),function(e,r){var i=e.texture,a=i.frame.width,s=i.frame.height,n=0,o=0;e._applyAnchorToTexture&&(n=e.anchor.x,o=e.anchor.y),r[0]=r[6]=-n,r[2]=r[4]=1-n,r[1]=r[3]=-o,r[5]=r[7]=1-o;var h=t.Matrix.shared;h.copyFrom(e._tileTransform.matrix),h.tx/=e.width,h.ty/=e.height,h.invert(),h.scale(e.width/a,e.height/s),function(t,e,r,i){var a=0,s=t.length/(e||2),n=i.a,o=i.b,h=i.c,l=i.d,u=i.tx,d=i.ty;for(r*=e;a<s;){var c=t[r],p=t[r+1];t[r]=n*c+h*p+u,t[r+1]=o*c+l*p+d,r+=e,a++}}(r,2,0,h)}(e,r.uvs),function(t,e){var r=t.anchor.x,i=t.anchor.y;e[0]=-r*t.width,e[1]=-i*t.height,e[2]=(1-r)*t.width,e[3]=-i*t.height,e[4]=(1-r)*t.width,e[5]=(1-i)*t.height,e[6]=-r*t.width,e[7]=(1-i)*t.height}(e,r.positions)}destroy(){for(var t in this._tilingSpriteDataHash)this.destroyRenderable(this._tilingSpriteDataHash[t].renderable);this._tilingSpriteDataHash=null,this._renderer=null}_updateCanBatch(t){var e=this._getTilingSpriteData(t),r=t.texture,i=!0;return this._renderer.type===S.WEBGL&&(i=this._renderer.context.supports.nonPowOf2wrapping),e.canBatch=r.textureMatrix.isSimple&&(i||r.source.isPowerOfTwo),e.canBatch}}TilingSpritePipe.extension={type:[t.ExtensionType.WebGLPipes,t.ExtensionType.WebGPUPipes,t.ExtensionType.CanvasPipes],name:"tilingSprite"};var sr={test:t=>"string"==typeof t&&t.startsWith("info face="),parse(e){var r=e.match(/^[a-z]+\s+.+$/gm),i={info:[],common:[],page:[],char:[],chars:[],kerning:[],kernings:[],distanceField:[]};for(var a in r){var s=r[a].match(/^[a-z]+/gm)[0],n=r[a].match(/[a-zA-Z]+=([^\s"']+|"([^"]*)")/gm),o={};for(var h in n){var l=n[h].split("="),u=l[0],d=l[1].replace(/"/gm,""),c=parseFloat(d),p=isNaN(c)?d:c;o[u]=p}i[s].push(o)}var f={chars:{},pages:[],lineHeight:0,fontSize:0,fontFamily:"",distanceField:null,baseLineOffset:0},g=t._slicedToArray(i.info,1)[0],x=t._slicedToArray(i.common,1)[0],v=i.distanceField??[],m=t._slicedToArray(v,1)[0];m&&(f.distanceField={range:parseInt(m.distanceRange,10),type:m.fieldType}),f.fontSize=parseInt(g.size,10),f.fontFamily=g.face,f.lineHeight=parseInt(x.lineHeight,10);for(var _=i.page,y=0;y<_.length;y++)f.pages.push({id:parseInt(_[y].id,10)||0,file:_[y].file});var b={};f.baseLineOffset=f.lineHeight-parseInt(x.base,10);for(var S=i.char,T=0;T<S.length;T++){var w=S[T],P=parseInt(w.id,10),M=w.letter??w.char??String.fromCharCode(P);"space"===M&&(M=" "),b[P]=M,f.chars[M]={id:P,page:parseInt(w.page,10)||0,x:parseInt(w.x,10),y:parseInt(w.y,10),width:parseInt(w.width,10),height:parseInt(w.height,10),xOffset:parseInt(w.xoffset,10),yOffset:parseInt(w.yoffset,10),xAdvance:parseInt(w.xadvance,10),kerning:{}}}for(var C=i.kerning||[],B=0;B<C.length;B++){var k=parseInt(C[B].first,10),A=parseInt(C[B].second,10),R=parseInt(C[B].amount,10);f.chars[b[A]].kerning[b[k]]=R}return f}},nr={test(t){var e=t;return"string"!=typeof e&&"getElementsByTagName"in e&&e.getElementsByTagName("page").length&&null!==e.getElementsByTagName("info")[0].getAttribute("face")},parse(t){var e={chars:{},pages:[],lineHeight:0,fontSize:0,fontFamily:"",distanceField:null,baseLineOffset:0},r=t.getElementsByTagName("info")[0],i=t.getElementsByTagName("common")[0],a=t.getElementsByTagName("distanceField")[0];a&&(e.distanceField={type:a.getAttribute("fieldType"),range:parseInt(a.getAttribute("distanceRange"),10)});var s=t.getElementsByTagName("page"),n=t.getElementsByTagName("char"),o=t.getElementsByTagName("kerning");e.fontSize=parseInt(r.getAttribute("size"),10),e.fontFamily=r.getAttribute("face"),e.lineHeight=parseInt(i.getAttribute("lineHeight"),10);for(var h=0;h<s.length;h++)e.pages.push({id:parseInt(s[h].getAttribute("id"),10)||0,file:s[h].getAttribute("file")});var l={};e.baseLineOffset=e.lineHeight-parseInt(i.getAttribute("base"),10);for(var u=0;u<n.length;u++){var d=n[u],c=parseInt(d.getAttribute("id"),10),p=d.getAttribute("letter")??d.getAttribute("char")??String.fromCharCode(c);"space"===p&&(p=" "),l[c]=p,e.chars[p]={id:c,page:parseInt(d.getAttribute("page"),10)||0,x:parseInt(d.getAttribute("x"),10),y:parseInt(d.getAttribute("y"),10),width:parseInt(d.getAttribute("width"),10),height:parseInt(d.getAttribute("height"),10),xOffset:parseInt(d.getAttribute("xoffset"),10),yOffset:parseInt(d.getAttribute("yoffset"),10),xAdvance:parseInt(d.getAttribute("xadvance"),10),kerning:{}}}for(var f=0;f<o.length;f++){var g=parseInt(o[f].getAttribute("first"),10),x=parseInt(o[f].getAttribute("second"),10),v=parseInt(o[f].getAttribute("amount"),10);e.chars[l[x]].kerning[l[g]]=v}return e}},or={test:e=>!("string"!=typeof e||!e.includes("<font>"))&&nr.test(t.DOMAdapter.get().parseXML(e)),parse:e=>nr.parse(t.DOMAdapter.get().parseXML(e))};class BitmapFont extends AbstractBitmapFont{constructor(e,r){super();var i=e.textures,a=e.data;Object.keys(a.pages).forEach((t=>{var e=a.pages[parseInt(t,10)],r=i[e.id];this.pages.push({texture:r})})),Object.keys(a.chars).forEach((e=>{var r=a.chars[e],s=i[r.page],n=s.frame,o=s.source,h=new t.Rectangle(r.x+n.x,r.y+n.y,r.width,r.height),l=new t.Texture({source:o,frame:h});this.chars[e]={id:e.codePointAt(0),xOffset:r.xOffset,yOffset:r.yOffset,xAdvance:r.xAdvance,kerning:r.kerning??{},texture:l}})),this.baseRenderedFontSize=a.fontSize,this.baseMeasurementFontSize=a.fontSize,this.fontMetrics={ascent:0,descent:0,fontSize:a.fontSize},this.baseLineOffset=a.baseLineOffset,this.lineHeight=a.lineHeight,this.fontFamily=a.fontFamily,this.distanceField=a.distanceField??{type:"none",range:0},this.url=r}destroy(){super.destroy();for(var t=0;t<this.pages.length;t++){this.pages[t].texture.destroy(!0)}this.pages=null}static install(t){oe.install(t)}static uninstall(t){oe.uninstall(t)}}var hr=[".xml",".fnt"],lr={extension:t.ExtensionType.CacheParser,test:t=>t instanceof BitmapFont,getCacheableAssets(t,e){var r={};return t.forEach((t=>{r[t]=e})),r[`${e.fontFamily}-bitmap`]=e,r}},ur={extension:{type:t.ExtensionType.LoadParser,priority:t.LoaderParserPriority.Normal},test:e=>hr.includes(t.path.extname(e).toLowerCase()),testParse:async t=>sr.test(t)||or.test(t),async parse(e,r,i){for(var a=sr.test(e)?sr.parse(e):or.parse(e),s=r.src,n=a.pages,o=[],h=0;h<n.length;++h){var l=n[h].file,u=t.path.join(t.path.dirname(s),l);u=t.copySearchParams(u,s),o.push(u)}var d=await i.load(o),c=o.map((t=>d[t]));return new BitmapFont({data:a,textures:c},s)},async load(e,r){var i=await t.DOMAdapter.get().fetch(e);return await i.text()},async unload(t,e,r){await Promise.all(t.pages.map((t=>r.unload(t.texture.source._sourceOrigin)))),t.destroy()}},dr={name:"local-uniform-msdf-bit",vertex:{header:"\n            struct LocalUniforms {\n                uColor:vec4<f32>,\n                uTransformMatrix:mat3x3<f32>,\n                uDistance: f32,\n                uRound:f32,\n            }\n\n            @group(2) @binding(0) var<uniform> localUniforms : LocalUniforms;\n        ",main:"\n            vColor *= localUniforms.uColor;\n            modelMatrix *= localUniforms.uTransformMatrix;\n        ",end:"\n            if(localUniforms.uRound == 1)\n            {\n                vPosition = vec4(roundPixels(vPosition.xy, globalUniforms.uResolution), vPosition.zw);\n            }\n        "},fragment:{header:"\n            struct LocalUniforms {\n                uColor:vec4<f32>,\n                uTransformMatrix:mat3x3<f32>,\n                uDistance: f32\n            }\n\n            @group(2) @binding(0) var<uniform> localUniforms : LocalUniforms;\n         ",main:" \n            outColor = vColor * calculateMSDFAlpha(outColor, localUniforms.uDistance);\n        "}},cr={name:"local-uniform-msdf-bit",vertex:{header:"\n            uniform mat3 uTransformMatrix;\n            uniform vec4 uColor;\n            uniform float uRound;\n        ",main:"\n            vColor *= uColor;\n            modelMatrix *= uTransformMatrix;\n        ",end:"\n            if(uRound == 1.)\n            {\n                gl_Position.xy = roundPixels(gl_Position.xy, uResolution);\n            }\n        "},fragment:{header:"\n            uniform float uDistance;\n         ",main:" \n            outColor = vColor * calculateMSDFAlpha(outColor, uDistance);\n        "}},pr={name:"msdf-bit",fragment:{header:"\n            fn calculateMSDFAlpha(msdfColor:vec4<f32>, distance:f32) -> f32 {\n                \n                // MSDF\n                var median = msdfColor.r + msdfColor.g + msdfColor.b -\n                    min(msdfColor.r, min(msdfColor.g, msdfColor.b)) -\n                    max(msdfColor.r, max(msdfColor.g, msdfColor.b));\n            \n                // SDF\n                median = min(median, msdfColor.a);\n\n                var screenPxDistance = distance * (median - 0.5);\n                var alpha = clamp(screenPxDistance + 0.5, 0.0, 1.0);\n                if (median < 0.01) {\n                    alpha = 0.0;\n                } else if (median > 0.99) {\n                    alpha = 1.0;\n                }\n\n                return alpha;\n            }\n        "}},fr={name:"msdf-bit",fragment:{header:"\n            float calculateMSDFAlpha(vec4 msdfColor, float distance) {\n                \n                // MSDF\n                float median = msdfColor.r + msdfColor.g + msdfColor.b -\n                                min(msdfColor.r, min(msdfColor.g, msdfColor.b)) -\n                                max(msdfColor.r, max(msdfColor.g, msdfColor.b));\n               \n                // SDF\n                median = min(median, msdfColor.a);\n            \n                float screenPxDistance = distance * (median - 0.5);\n                float alpha = clamp(screenPxDistance + 0.5, 0.0, 1.0);\n           \n                if (median < 0.01) {\n                    alpha = 0.0;\n                } else if (median > 0.99) {\n                    alpha = 1.0;\n                }\n\n                return alpha;\n            }\n        "}};class SdfShader extends Shader{constructor(){var e,r=new b({uColor:{value:new Float32Array([1,1,1,1]),type:"vec4<f32>"},uTransformMatrix:{value:new t.Matrix,type:"mat3x3<f32>"},uDistance:{value:4,type:"f32"},uRound:{value:0,type:"f32"}}),i=Fe({name:"sdf-shader",bits:[Ee,(e=O,Ue[e]||(Ue[e]={name:"texture-batch-bit",vertex:{header:"\n                @in aTextureIdAndRound: vec2<u32>;\n                @out @interpolate(flat) vTextureId : u32;\n            ",main:"\n                vTextureId = aTextureIdAndRound.y;\n            ",end:"\n                if(aTextureIdAndRound.x == 1)\n                {\n                    vPosition = vec4<f32>(roundPixels(vPosition.xy, globalUniforms.uResolution), vPosition.zw);\n                }\n            "},fragment:{header:`\n                @in @interpolate(flat) vTextureId: u32;\n    \n                ${Ge(16)}\n            `,main:`\n                var uvDx = dpdx(vUV);\n                var uvDy = dpdy(vUV);\n    \n                ${Oe(16)}\n            `}}),Ue[e]),dr,pr,Le]});super({glProgram:ze({name:"sdf-shader",bits:[Ie,He(O),cr,fr,Ve]}),gpuProgram:i,resources:{localUniforms:r,batchSamplers:je}})}}class BitmapTextPipe{constructor(t){this._gpuBitmapText={},this._renderer=t}validateRenderable(t){var e=this._getGpuBitmapText(t);return t._didTextUpdate&&(t._didTextUpdate=!1,this._updateContext(t,e)),this._renderer.renderPipes.graphics.validateRenderable(e)}addRenderable(t,e){var r=this._getGpuBitmapText(t);gr(t,r),t._didTextUpdate&&(t._didTextUpdate=!1,this._updateContext(t,r)),this._renderer.renderPipes.graphics.addRenderable(r,e),r.context.customShader&&this._updateDistanceField(t)}destroyRenderable(t){this._destroyRenderableByUid(t.uid)}_destroyRenderableByUid(e){t.BigPool.return(this._gpuBitmapText[e]),this._gpuBitmapText[e]=null}updateRenderable(t){var e=this._getGpuBitmapText(t);gr(t,e),this._renderer.renderPipes.graphics.updateRenderable(e),e.context.customShader&&this._updateDistanceField(t)}_updateContext(t,e){var r=e.context,i=oe.getFont(t.text,t._style);r.clear(),"none"!==i.distanceField.type&&(r.customShader||(this._sdfShader||(this._sdfShader=new SdfShader),r.customShader=this._sdfShader));var a=Array.from(t.text),s=t._style,n=(s._stroke?.width||0)/2;n+=i.baseLineOffset;var o=ne(a,s,i),h=0,l=s.padding,u=o.scale;r.translate(-t._anchor._x*o.width-l,-t._anchor._y*(o.height+o.offsetY)-l).scale(u,u);for(var d=s._fill.color,c=0;c<o.lines.length;c++){for(var p=o.lines[c],f=0;f<p.charPositions.length;f++){var g=a[h++],x=i.chars[g];x?.texture&&r.texture(x.texture,d||"black",Math.round(p.charPositions[f]+x.xOffset),Math.round(n+x.yOffset))}n+=i.lineHeight}}_getGpuBitmapText(t){return this._gpuBitmapText[t.uid]||this.initGpuText(t)}initGpuText(e){var r=t.BigPool.get(Graphics);return this._gpuBitmapText[e.uid]=r,this._updateContext(e,r),e.on("destroyed",(()=>{this.destroyRenderable(e)})),this._gpuBitmapText[e.uid]}_updateDistanceField(e){var r=this._getGpuBitmapText(e).context,i=e._style.fontFamily,a=t.Cache.get(`${i}-bitmap`),s=e.groupTransform,n=s.a,o=s.b,h=s.c,l=s.d,u=Math.sqrt(n*n+o*o),d=Math.sqrt(h*h+l*l),c=(Math.abs(u)+Math.abs(d))/2,p=a.baseRenderedFontSize/e._style.fontSize,f=e.resolution??this._renderer.resolution,g=c*a.distanceField.range*(1/p)*f;r.customShader.resources.localUniforms.uniforms.uDistance=g}destroy(){for(var t in this._gpuBitmapText)this._destroyRenderableByUid(t);this._gpuBitmapText=null,this._sdfShader?.destroy(!0),this._sdfShader=null,this._renderer=null}}function gr(t,e){e.groupTransform=t.groupTransform,e.groupColorAlpha=t.groupColorAlpha,e.groupColor=t.groupColor,e.groupBlendMode=t.groupBlendMode,e.globalDisplayStatus=t.globalDisplayStatus,e.groupTransform=t.groupTransform,e.localDisplayStatus=t.localDisplayStatus,e.groupAlpha=t.groupAlpha,e._roundPixels=t._roundPixels}BitmapTextPipe.extension={type:[t.ExtensionType.WebGLPipes,t.ExtensionType.WebGPUPipes,t.ExtensionType.CanvasPipes],name:"bitmapText"};class HTMLTextPipe{constructor(t){this._gpuText=Object.create(null),this._renderer=t}validateRenderable(t){var e=this._getGpuText(t),r=t._getKey();return e.textureNeedsUploading?(e.textureNeedsUploading=!1,!0):e.currentKey!==r}addRenderable(t){var e=this._getGpuText(t).batchableSprite;t._didTextUpdate&&this._updateText(t),this._renderer.renderPipes.batch.addToBatch(e)}updateRenderable(t){var e=this._getGpuText(t).batchableSprite;t._didTextUpdate&&this._updateText(t),e.batcher.updateElement(e)}destroyRenderable(t){this._destroyRenderableById(t.uid)}_destroyRenderableById(e){var r=this._gpuText[e];this._renderer.htmlText.decreaseReferenceCount(r.currentKey),t.BigPool.return(r.batchableSprite),this._gpuText[e]=null}_updateText(e){var r=e._getKey(),i=this._getGpuText(e),a=i.batchableSprite;i.currentKey!==r&&this._updateGpuText(e).catch((t=>{console.error(t)})),e._didTextUpdate=!1;var s=e._style.padding;t.updateQuadBounds(a.bounds,e._anchor,a.texture,s)}async _updateGpuText(e){e._didTextUpdate=!1;var r=this._getGpuText(e);if(!r.generatingTexture){var i=e._getKey();this._renderer.htmlText.decreaseReferenceCount(r.currentKey),r.generatingTexture=!0,r.currentKey=i;var a=e.resolution??this._renderer.resolution,s=await this._renderer.htmlText.getManagedTexture(e.text,a,e._style,e._getKey()),n=r.batchableSprite;n.texture=r.texture=s,r.generatingTexture=!1,r.textureNeedsUploading=!0,e.onViewUpdate();var o=e._style.padding;t.updateQuadBounds(n.bounds,e._anchor,n.texture,o)}}_getGpuText(t){return this._gpuText[t.uid]||this.initGpuText(t)}initGpuText(e){var r={texture:t.Texture.EMPTY,currentKey:"--",batchableSprite:t.BigPool.get(BatchableSprite),textureNeedsUploading:!1,generatingTexture:!1},i=r.batchableSprite;return i.renderable=e,i.texture=t.Texture.EMPTY,i.bounds={minX:0,maxX:1,minY:0,maxY:0},i.roundPixels=this._renderer._roundPixels|e._roundPixels,this._gpuText[e.uid]=r,e.on("destroyed",(()=>{this.destroyRenderable(e)})),r}destroy(){for(var t in this._gpuText)this._destroyRenderableById(t);this._gpuText=null,this._renderer=null}}HTMLTextPipe.extension={type:[t.ExtensionType.WebGLPipes,t.ExtensionType.WebGPUPipes,t.ExtensionType.CanvasPipes],name:"htmlText"};var xr=new t.Bounds;function vr(t,e,r,i){var a=xr;a.minX=0,a.minY=0,a.maxX=t.width/i|0,a.maxY=t.height/i|0;var s=Dt.getOptimalTexture(a.width,a.height,i,!1);return s.source.uploadMethodId="image",s.source.resource=t,s.source.alphaMode="premultiply-alpha-on-upload",s.frame.width=e/i,s.frame.height=r/i,s.source.emit("update",s.source),s.updateUvs(),s}async function mr(e,r){var i=await async function(e){var r=await t.DOMAdapter.get().fetch(e),i=await r.blob(),a=new FileReader;return await new Promise(((t,e)=>{a.onloadend=()=>t(a.result),a.onerror=e,a.readAsDataURL(i)}))}(r);return`@font-face {\n        font-family: "${e.fontFamily}";\n        src: url('${i}');\n        font-weight: ${e.fontWeight};\n        font-style: ${e.fontStyle};\n    }`}var _r=new Map;class HTMLTextSystem{constructor(t){this._activeTextures={},this._renderer=t,this._createCanvas=t.type===S.WEBGPU}getTexture(t){return this._buildTexturePromise(t.text,t.resolution,t.style)}getManagedTexture(t,e,r,i){if(this._activeTextures[i])return this._increaseReferenceCount(i),this._activeTextures[i].promise;var a=this._buildTexturePromise(t,e,r).then((t=>(this._activeTextures[i].texture=t,t)));return this._activeTextures[i]={texture:null,promise:a,usageCount:1},a}async _buildTexturePromise(e,r,i){var a=t.BigPool.get(HTMLTextRenderData),s=function(t,e){var r=e.fontFamily,i=[],a={},s=t.match(/font-family:([^;"\s]+)/g);function n(t){a[t]||(i.push(t),a[t]=!0)}if(Array.isArray(r))for(var o=0;o<r.length;o++)n(r[o]);else n(r);for(var h in s&&s.forEach((t=>{n(t.split(":")[1].trim())})),e.tagStyles)n(e.tagStyles[h].fontFamily);return i}(e,i),n=await async function(e,r,i){var a=e.filter((e=>t.Cache.has(`${e}-and-url`))).map(((e,a)=>{if(!_r.has(e)){var s=t.Cache.get(`${e}-and-url`).url;0===a?_r.set(e,mr(r,s)):_r.set(e,mr({fontWeight:i.fontWeight,fontStyle:i.fontStyle,fontFamily:e},s))}return _r.get(e)}));return(await Promise.all(a)).join("\n")}(s,i,HTMLTextStyle.defaultTextStyle),o=function(t,e,r,i){var a=i=i||pe||(pe=new HTMLTextRenderData),s=a.domElement,n=a.styleElement,o=a.svgRoot;s.innerHTML=`<style>${e.cssStyle}</style><div>${t}</div>`,s.setAttribute("style","transform-origin: top left; display: inline-block"),r&&(n.textContent=r),document.body.appendChild(o);var h=s.getBoundingClientRect();o.remove();var l=Qt.measureFont(e.fontStyle).descent;return{width:h.width,height:h.height+l}}(e,i,n,a),h=Math.ceil(Math.ceil(Math.max(1,o.width)+2*i.padding)*r),l=Math.ceil(Math.ceil(Math.max(1,o.height)+2*i.padding)*r),u=a.image;u.width=0|h,u.height=0|l;var d,c=function(t,e,r,i,a){var s=a.domElement,n=a.styleElement,o=a.svgRoot;s.innerHTML=`<style>${e.cssStyle}</style><div>${t}</div>`,s.setAttribute("style",`transform: scale(${r});transform-origin: top left; display: inline-block`),n.textContent=i;var h=a.image,l=h.width,u=h.height;return o.setAttribute("width",l.toString()),o.setAttribute("height",u.toString()),(new XMLSerializer).serializeToString(o)}(e,i,r,n,a);await function(t,e,r){return new Promise((async i=>{r&&await new Promise((t=>setTimeout(t,100))),t.onload=()=>{i()},t.src=`data:image/svg+xml;charset=utf8,${encodeURIComponent(e)}`,t.crossOrigin="anonymous"}))}(u,c,(d=t.DOMAdapter.get().getNavigator().userAgent,/^((?!chrome|android).)*safari/i.test(d)&&s.length>0));var p=u;this._createCanvas&&(p=function(t,e){var r=ie.getOptimalCanvasAndContext(t.width,t.height,e),i=r.context;return i.clearRect(0,0,t.width,t.height),i.drawImage(t,0,0),ie.returnCanvasAndContext(r),r.canvas}(u,r));var f=vr(p,u.width,u.height,r);return this._createCanvas&&this._renderer.texture.initSource(f.source),t.BigPool.return(a),f}_increaseReferenceCount(t){this._activeTextures[t].usageCount++}decreaseReferenceCount(e){var r=this._activeTextures[e];r&&(r.usageCount--,0===r.usageCount&&(r.texture?this._cleanUp(r):r.promise.then((t=>{r.texture=t,this._cleanUp(r)})).catch((()=>{t.warn("HTMLTextSystem: Failed to clean texture")})),this._activeTextures[e]=null))}_cleanUp(t){Dt.returnTexture(t.texture),t.texture.source.resource=null,t.texture.source.uploadMethodId="unknown"}getReferenceCount(t){return this._activeTextures[t].usageCount}destroy(){this._activeTextures=null}}HTMLTextSystem.extension={type:[t.ExtensionType.WebGLSystem,t.ExtensionType.WebGPUSystem,t.ExtensionType.CanvasSystem],name:"htmlText"},HTMLTextSystem.defaultFontOptions={fontFamily:"Arial",fontStyle:"normal",fontWeight:"normal"};class CanvasTextPipe{constructor(t){this._gpuText=Object.create(null),this._renderer=t}validateRenderable(t){var e=this._getGpuText(t),r=t._getKey();if(e.currentKey!==r){var i=t.resolution??this._renderer.resolution,a=this._renderer.canvasText.getTextureSize(t.text,i,t._style),s=a.width,n=a.height;return 1!==this._renderer.canvasText.getReferenceCount(e.currentKey)||s!==e.texture._source.width||n!==e.texture._source.height}return!1}addRenderable(t,e){var r=this._getGpuText(t).batchableSprite;t._didTextUpdate&&this._updateText(t),this._renderer.renderPipes.batch.addToBatch(r)}updateRenderable(t){var e=this._getGpuText(t).batchableSprite;t._didTextUpdate&&this._updateText(t),e.batcher.updateElement(e)}destroyRenderable(t){this._destroyRenderableById(t.uid)}_destroyRenderableById(e){var r=this._gpuText[e];this._renderer.canvasText.decreaseReferenceCount(r.currentKey),t.BigPool.return(r.batchableSprite),this._gpuText[e]=null}_updateText(e){var r=e._getKey(),i=this._getGpuText(e),a=i.batchableSprite;i.currentKey!==r&&this._updateGpuText(e),e._didTextUpdate=!1;var s=e._style.padding;t.updateQuadBounds(a.bounds,e._anchor,a.texture,s)}_updateGpuText(t){var e=this._getGpuText(t),r=e.batchableSprite;e.texture&&this._renderer.canvasText.decreaseReferenceCount(e.currentKey),e.texture=r.texture=this._renderer.canvasText.getManagedTexture(t),e.currentKey=t._getKey(),r.texture=e.texture}_getGpuText(t){return this._gpuText[t.uid]||this.initGpuText(t)}initGpuText(e){var r={texture:null,currentKey:"--",batchableSprite:t.BigPool.get(BatchableSprite)};return r.batchableSprite.renderable=e,r.batchableSprite.bounds={minX:0,maxX:1,minY:0,maxY:0},r.batchableSprite.roundPixels=this._renderer._roundPixels|e._roundPixels,this._gpuText[e.uid]=r,this._updateText(e),e.on("destroyed",(()=>{this.destroyRenderable(e)})),r}destroy(){for(var t in this._gpuText)this._destroyRenderableById(t);this._gpuText=null,this._renderer=null}}function yr(t,e,r){for(var i=0,a=4*r*e;i<e;++i,a+=4)if(0!==t[a+3])return!1;return!0}function br(t,e,r,i,a){for(var s=4*e,n=i,o=i*s+4*r;n<=a;++n,o+=s)if(0!==t[o+3])return!1;return!0}CanvasTextPipe.extension={type:[t.ExtensionType.WebGLPipes,t.ExtensionType.WebGPUPipes,t.ExtensionType.CanvasPipes],name:"text"};class CanvasTextSystem{constructor(t){this._activeTextures={},this._renderer=t}getTextureSize(e,r,i){var a=Qt.measureText(e||" ",i),s=Math.ceil(Math.ceil(Math.max(1,a.width)+2*i.padding)*r),n=Math.ceil(Math.ceil(Math.max(1,a.height)+2*i.padding)*r);return s=Math.ceil(s-1e-6),n=Math.ceil(n-1e-6),{width:s=t.nextPow2(s),height:n=t.nextPow2(n)}}getTexture(e,r,i,a){"string"==typeof e&&(t.deprecation("8.0.0","CanvasTextSystem.getTexture: Use object TextOptions instead of separate arguments"),e={text:e,style:i,resolution:r}),e.style instanceof re||(e.style=new re(e.style));var s=this.createTextureAndCanvas(e),n=s.texture,o=s.canvasAndContext;return this._renderer.texture.initSource(n._source),ie.returnCanvasAndContext(o),n}createTextureAndCanvas(e){var r=e.text,i=e.style,a=e.resolution??this._renderer.resolution,s=Qt.measureText(r||" ",i),n=Math.ceil(Math.ceil(Math.max(1,s.width)+2*i.padding)*a),o=Math.ceil(Math.ceil(Math.max(1,s.height)+2*i.padding)*a),h=ie.getOptimalCanvasAndContext(n,o),l=h.canvas;this.renderTextToCanvas(r,i,a,h);var u=vr(l,n,o,a);if(i.trim){var d=function(e,r=1){var i=e.width,a=e.height,s=e.getContext("2d",{willReadFrequently:!0});if(null===s)throw new TypeError("Failed to get canvas 2D context");for(var n=s.getImageData(0,0,i,a).data,o=0,h=0,l=i-1,u=a-1;h<a&&yr(n,i,h);)++h;if(h===a)return t.Rectangle.EMPTY;for(;yr(n,i,u);)--u;for(;br(n,i,o,h,u);)++o;for(;br(n,i,l,h,u);)--l;return++l,++u,new t.Rectangle(o/r,h/r,(l-o)/r,(u-h)/r)}(l,a);u.frame.copyFrom(d),u.updateUvs()}return{texture:u,canvasAndContext:h}}getManagedTexture(t){var e=t._getKey();if(this._activeTextures[e])return this._increaseReferenceCount(e),this._activeTextures[e].texture;var r=this.createTextureAndCanvas(t),i=r.texture,a=r.canvasAndContext;return this._activeTextures[e]={canvasAndContext:a,texture:i,usageCount:1},i}_increaseReferenceCount(t){this._activeTextures[t].usageCount++}decreaseReferenceCount(t){var e=this._activeTextures[t];if(e.usageCount--,0===e.usageCount){ie.returnCanvasAndContext(e.canvasAndContext),Dt.returnTexture(e.texture);var r=e.texture.source;r.resource=null,r.uploadMethodId="unknown",r.alphaMode="no-premultiply-alpha",this._activeTextures[t]=null}}getReferenceCount(t){return this._activeTextures[t].usageCount}renderTextToCanvas(e,r,i,a){var s=a.canvas,n=a.context,o=Xt(r),h=Qt.measureText(e||" ",r),l=h.lines,u=h.lineHeight,d=h.lineWidths,c=h.maxLineWidth,p=h.fontProperties,f=s.height;n.resetTransform(),n.scale(i,i);var g,x,v=2*r.padding;if(n.clearRect(0,0,h.width+4+v,h.height+4+v),r._stroke?.width){var m=r._stroke;n.lineWidth=m.width,n.miterLimit=m.miterLimit,n.lineJoin=m.join,n.lineCap=m.cap}n.font=o;for(var _=r.dropShadow?2:1,y=0;y<_;++y){var b=r.dropShadow&&0===y,S=b?Math.ceil(Math.max(1,f)+2*r.padding):0,T=S*i;if(b){n.fillStyle="black",n.strokeStyle="black";var w=r.dropShadow,P=w.color,M=w.alpha;n.shadowColor=t.Color.shared.setValue(P).setAlpha(M).toRgbaString();var C=w.blur*i,B=w.distance*i;n.shadowBlur=C,n.shadowOffsetX=Math.cos(w.angle)*B,n.shadowOffsetY=Math.sin(w.angle)*B+T}else n.globalAlpha=r._fill?.alpha??1,n.fillStyle=r._fill?ae(r._fill,n):null,r._stroke?.width&&(n.strokeStyle=ae(r._stroke,n)),n.shadowColor="black";var k=(u-p.fontSize)/2;u-p.fontSize<0&&(k=0);for(var A=r._stroke?.width??0,R=0;R<l.length;R++)g=A/2,x=A/2+R*u+p.ascent+k,"right"===r.align?g+=c-d[R]:"center"===r.align&&(g+=(c-d[R])/2),r._stroke?.width&&this._drawLetterSpacing(l[R],r,a,g+r.padding,x+r.padding-S,!0),void 0!==r._fill&&this._drawLetterSpacing(l[R],r,a,g+r.padding,x+r.padding-S)}}_drawLetterSpacing(t,e,r,i,a,s=!1){var n=r.context,o=e.letterSpacing,h=!1;if(Qt.experimentalLetterSpacingSupported&&(Qt.experimentalLetterSpacing?(n.letterSpacing=`${o}px`,n.textLetterSpacing=`${o}px`,h=!0):(n.letterSpacing="0px",n.textLetterSpacing="0px")),0===o||h)s?n.strokeText(t,i,a):n.fillText(t,i,a);else for(var l=i,u=Qt.graphemeSegmenter(t),d=n.measureText(t).width,c=0,p=0;p<u.length;++p){var f=u[p];s?n.strokeText(f,l,a):n.fillText(f,l,a);for(var g="",x=p+1;x<u.length;++x)g+=u[x];l+=d-(c=n.measureText(g).width)+o,d=c}}destroy(){this._activeTextures=null}}CanvasTextSystem.extension={type:[t.ExtensionType.WebGLSystem,t.ExtensionType.WebGPUSystem,t.ExtensionType.CanvasSystem],name:"canvasText"},t.extensions.add(ResizePlugin),t.extensions.add(TickerPlugin),t.extensions.add(GraphicsPipe),t.extensions.add(lt),t.extensions.add(MeshPipe),t.extensions.add(CanvasTextSystem),t.extensions.add(CanvasTextPipe),t.extensions.add(BitmapTextPipe,ur,lr),t.extensions.add(HTMLTextSystem),t.extensions.add(HTMLTextPipe),t.extensions.add(TilingSpritePipe),t.extensions.add(NineSliceSpritePipe),t.extensions.add(FilterSystem),t.extensions.add(FilterPipe);
