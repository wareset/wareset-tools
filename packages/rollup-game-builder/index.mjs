/* eslint-disable */
import*as e from"fs";import*as r from"path";import s from"jimp";import t from"adm-zip";import o from"@rollup/plugin-json";import n from"@rollup/plugin-inject";import i from"@rollup/plugin-replace";import a from"@rollup/plugin-commonjs";import l from"@rollup/plugin-node-resolve";import c from"rollup-plugin-polyfill-node";import m from"rollup-plugin-livereload";import p from"@wareset-tools/rollup-plugin-cssinjs-minify";import{optimize as u}from"svgo";import{minify as d}from"terser";import{transform as f}from"sucrase";import{transformAsync as v}from"@babel/core";import*as g from"math-safe";function j({sdkUrl:j="https://yandex.ru/games/sdk/v2",srcDir:y="src",appDir:b="app",zipDir:h="zip",staticDirName:x="static",injects:$={},plugins:w=[],globals:S={},indexHtmlFile:k=r.join(b,"_index.html"),scriptFileList:F=[]}={}){var E=JSON.stringify,_=!process.env.ROLLUP_WATCH,R=r.join(b,"_dev"),D=r.join(R,"scripts");e.mkdirSync(r.resolve(h),{recursive:!0}),e.mkdirSync(r.resolve(D),{recursive:!0});var O=e.readFileSync(r.resolve(k),"utf8").replace(/\s*<!--[^]*?-->|\s*\/\*[^]*?\*\/|\s*\/\/[^\n]*/g,"").replace(/\s*\n/g,"\n");return e.readdirSync(r.resolve(y),{withFileTypes:!0}).filter((e=>e.isFile()&&/^[^_\W][^]*\.tsx?$/.test(e.name))).map(((k,A)=>{var L,B=k.name,I=B.match(/^\w+/)[0],N=r.join(R,`${I}.js`),z=_?null:m({watch:N,port:35729+A}),C=O.replace("</title>",`: ${I}</title>`),M=r.resolve(h,`${I}.zip`);return e.existsSync(M)&&e.rmSync(M),e.writeFileSync(r.resolve(b,`${I}.html`),C.replace(/\s*<\/body>/,F.map((s=>{s=r.resolve(s);var t=r.basename(s);return/\.js/.test(t)?(e.cpSync(s,r.resolve(D,t)),e.existsSync(s+".map")&&e.cpSync(s+".map",r.resolve(D,t+".map")),`\n    <script src=${E(`_dev/scripts/${t}`)}><\/script>`):""})).join("")+`\n    <script src=${E(`_dev/${I}.js`)} defer><\/script>\n  </body>`)),_&&(C=C.replace(/\s*<\/head>/,`\n    \x3c!-- Game SDK --\x3e\n    <script src=${E(j)}><\/script>\n  </head>`).replace(/\s*<\/body>/,(F=F.map((s=>(s=r.resolve(s),/\.js/.test(s)?(!/\.min\.js/.test(s)&&e.existsSync(s.slice(0,-2)+"min.js")&&(s=s.slice(0,-2)+"min.js"),s):""))).filter(Boolean)).map((e=>`\n    <script src=${E(`${x}/scripts/${r.basename(e)}`)}><\/script>`)).join("")+`\n    <script src=${E(`${x}/build.js`)} defer><\/script>\n  </body>`)),{external:Object.keys(S),input:r.join(y,B),output:{globals:S,sourcemap:!1,format:"iife",name:I,file:N},plugins:[o(),i({preventAssignment:!0,values:{"process.env.DEV":E(!_),"process.env.NODE_ENV":E(_?"production":"dev")}}),l({browser:!0,extensions:[".mjs",".js",".jsx",".mts",".ts",".tsx",".json"]}),a(),c(),{name:"svg-custom",transform:(e,r)=>/\.svg$/.test(r)?(e=u(e).data,`export default ${E(encodeURIComponent(e))}`):null},{name:"img-custom",async transform(e,r){if(/\.(?:jpe?g|png|bmp|tiff|gif)$/.test(r)){var t=await s.read(r),o=await t.getBase64Async(t.getMIME());return`export default ${E(o)}`}return null}},{name:"sucrase-custom",transform(e,r){if(/\.[mc]?(?:jsx|tsx?)$/.test(r)){try{e=f(e,{transforms:["jsx","typescript"],production:!0,jsxRuntime:"classic",jsxImportSource:"rease"}).code}catch(s){throw console.error("sucrase-custom"),s}return{code:e}}return null}},p(),n({REASE:["rease","*"],css:["rease","css"],"React.createElement":["rease","createElement"],"React.Fragment":["rease","RFragment"]}),(L={MATH:["math-safe","*"]},Object.keys(g).forEach((e=>{L["Math."+e]=["math-safe",e]})),n(L)),Object.keys($).length?n($):null,...w,z,{name:"babel-and-terser",async transform(e){if(_)try{return{code:e=(await v(e,{presets:[["@babel/preset-env",{corejs:3,loose:!0,bugfixes:!0,modules:!1,useBuiltIns:"entry",targets:"iOS 7"}]],plugins:["@babel/plugin-transform-runtime",["@babel/plugin-transform-block-scoping",{throwIfClosureRequired:!0}]]})).code}}catch(r){throw console.error("babel-custom"),r}},async renderChunk(e,r){if(_)try{return(await d(e,{safari10:!0,mangle:!0,module:!0,toplevel:!0,compress:{drop_console:!0,keep_fnames:!1,keep_classnames:!1}})).code||(console.warn(`WARN: chunk "${r.name}" - terser return empty code`),e)}catch(s){throw console.error("terser-custom"),s}}},{name:"write-bundle",writeBundle(s){_&&s.name===I&&setTimeout((()=>{var s=new t,o=r.resolve(b,x);e.existsSync(o)&&s.addLocalFolder(o,x),F.forEach((e=>{s.addLocalFile(e,x+"/scripts")})),s.addFile("index.html",Buffer.from(C,"utf8")),s.addLocalFile(r.resolve(N),x,"build.js"),s.writeZip(M)}),500)}}],watch:{clearScreen:!1}}}))}export{j as default};
