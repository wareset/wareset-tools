/* eslint-disable */
Object.defineProperty(exports,"__esModule",{value:!0});const e=require("fs"),r=require("path"),s=require("jimp"),t=require("adm-zip"),n=require("@rollup/plugin-json"),i=require("@rollup/plugin-inject"),a=require("@rollup/plugin-replace"),o=require("@rollup/plugin-commonjs"),c=require("@rollup/plugin-node-resolve"),l=require("rollup-plugin-polyfill-node"),u=require("rollup-plugin-livereload"),p=require("@wareset-tools/rollup-plugin-cssinjs-minify"),m=require("svgo"),d=require("terser"),f=require("sucrase"),j=require("@babel/core"),g=require("math-safe");function y(e){const r=Object.create(null);if(e)for(const s in e)if("default"!==s){const t=Object.getOwnPropertyDescriptor(e,s);Object.defineProperty(r,s,t.get?t:{enumerable:!0,get:function(){return e[s]}})}return r.default=e,Object.freeze(r)}const v=y(e),b=y(r),h=y(g);exports.default=function({sdkUrl:e="https://yandex.ru/games/sdk/v2",srcDir:r="src",appDir:g="app",zipDir:y="zip",staticDirName:x="static",injects:w={},plugins:$=[],globals:q={},indexHtmlFile:S=b.join(g,"_index.html"),scriptFileList:O=[]}={}){var k=JSON.stringify,F=!process.env.ROLLUP_WATCH,_=b.join(g,"_dev"),E=b.join(_,"scripts");v.mkdirSync(b.resolve(y),{recursive:!0}),v.mkdirSync(b.resolve(E),{recursive:!0});var R=v.readFileSync(b.resolve(S),"utf8").replace(/\s*<!--[^]*?-->|\s*\/\*[^]*?\*\/|\s*\/\/[^\n]*/g,"").replace(/\s*\n/g,"\n");return v.readdirSync(b.resolve(r),{withFileTypes:!0}).filter((e=>e.isFile()&&/^[^_\W][^]*\.tsx?$/.test(e.name))).map(((S,D)=>{var A,z=S.name,L=z.match(/^\w+/)[0],B=b.join(_,`${L}.js`),I=F?null:u({watch:B,port:35729+D}),M=R.replace("</title>",`: ${L}</title>`),N=b.resolve(y,`${L}.zip`);return v.existsSync(N)&&v.rmSync(N),v.writeFileSync(b.resolve(g,`${L}.html`),M.replace(/\s*<\/body>/,O.map((e=>{e=b.resolve(e);var r=b.basename(e);return/\.js/.test(r)?(v.cpSync(e,b.resolve(E,r)),v.existsSync(e+".map")&&v.cpSync(e+".map",b.resolve(E,r+".map")),`\n    <script src=${k(`_dev/scripts/${r}`)}><\/script>`):""})).join("")+`\n    <script src=${k(`_dev/${L}.js`)} defer><\/script>\n  </body>`)),F&&(M=M.replace(/\s*<\/head>/,`\n    \x3c!-- Game SDK --\x3e\n    <script src=${k(e)}><\/script>\n  </head>`).replace(/\s*<\/body>/,(O=O.map((e=>(e=b.resolve(e),/\.js/.test(e)?(!/\.min\.js/.test(e)&&v.existsSync(e.slice(0,-2)+"min.js")&&(e=e.slice(0,-2)+"min.js"),e):""))).filter(Boolean)).map((e=>`\n    <script src=${k(`${x}/scripts/${b.basename(e)}`)}><\/script>`)).join("")+`\n    <script src=${k(`${x}/build.js`)} defer><\/script>\n  </body>`)),{external:Object.keys(q),input:b.join(r,z),output:{globals:q,sourcemap:!1,format:"iife",name:L,file:B},plugins:[n(),a({preventAssignment:!0,values:{"process.env.DEV":k(!F),"process.env.NODE_ENV":k(F?"production":"dev")}}),c({browser:!0,extensions:[".mjs",".js",".jsx",".mts",".ts",".tsx",".json"]}),o(),l(),{name:"svg-custom",transform:(e,r)=>/\.svg$/.test(r)?(e=m.optimize(e).data,`export default ${k(encodeURIComponent(e))}`):null},{name:"img-custom",async transform(e,r){if(/\.(?:jpe?g|png|bmp|tiff|gif)$/.test(r)){var t=await s.read(r),n=await t.getBase64Async(t.getMIME());return`export default ${k(n)}`}return null}},{name:"sucrase-custom",transform(e,r){if(/\.[mc]?(?:jsx|tsx?)$/.test(r)){try{e=f.transform(e,{transforms:["jsx","typescript"],production:!0,jsxRuntime:"classic",jsxImportSource:"rease"}).code}catch(s){throw console.error("sucrase-custom"),s}return{code:e}}return null}},p(),i({REASE:["rease","*"],css:["rease","css"],"React.createElement":["rease","createElement"],"React.Fragment":["rease","RFragment"]}),(A={MATH:["math-safe","*"]},Object.keys(h).forEach((e=>{A["Math."+e]=["math-safe",e]})),i(A)),Object.keys(w).length?i(w):null,...$,I,{name:"babel-and-terser",async transform(e){if(F)try{return{code:e=(await j.transformAsync(e,{presets:[["@babel/preset-env",{corejs:3,loose:!0,bugfixes:!0,modules:!1,useBuiltIns:"entry",targets:"iOS 7"}]],plugins:["@babel/plugin-transform-runtime",["@babel/plugin-transform-block-scoping",{throwIfClosureRequired:!0}]]})).code}}catch(r){throw console.error("babel-custom"),r}},async renderChunk(e,r){if(F)try{return(await d.minify(e,{safari10:!0,mangle:!0,module:!0,toplevel:!0,compress:{drop_console:!0,keep_fnames:!1,keep_classnames:!1}})).code||(console.warn(`WARN: chunk "${r.name}" - terser return empty code`),e)}catch(s){throw console.error("terser-custom"),s}}},{name:"write-bundle",writeBundle(e){F&&e.name===L&&setTimeout((()=>{var e=new t,r=b.resolve(g,x);v.existsSync(r)&&e.addLocalFolder(r,x),O.forEach((r=>{e.addLocalFile(r,x+"/scripts")})),e.addFile("index.html",Buffer.from(M,"utf8")),e.addLocalFile(b.resolve(B),x,"build.js"),e.writeZip(N)}),500)}}],watch:{clearScreen:!1}}}))};
