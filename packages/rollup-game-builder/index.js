/* eslint-disable */
Object.defineProperty(exports,"__esModule",{value:!0});const e=require("fs"),r=require("path"),s=require("jimp"),t=require("adm-zip"),n=require("@rollup/plugin-json"),i=require("@rollup/plugin-inject"),o=require("@rollup/plugin-replace"),l=require("@rollup/plugin-commonjs"),a=require("@rollup/plugin-node-resolve"),c=require("rollup-plugin-polyfill-node"),u=require("rollup-plugin-livereload"),p=require("@wareset-tools/rollup-plugin-cssinjs-minify"),m=require("svgo"),d=require("terser"),f=require("sucrase"),g=require("@babel/core");function j(e){const r=Object.create(null);if(e)for(const s in e)if("default"!==s){const t=Object.getOwnPropertyDescriptor(e,s);Object.defineProperty(r,s,t.get?t:{enumerable:!0,get:function(){return e[s]}})}return r.default=e,Object.freeze(r)}const v=j(e),y=j(r);exports.default=function({sdkUrl:e="https://yandex.ru/games/sdk/v2",srcDir:r="src",appDir:j="app",zipDir:b="zip",staticDirName:x="static",injects:h={},plugins:w=[],globals:$={},indexHtmlFile:S=y.join(j,"_index.html"),scriptFileList:q=[]}={}){var F=JSON.stringify,O=!process.env.ROLLUP_WATCH,_=y.join(j,"_dev"),k=y.join(_,"scripts");v.mkdirSync(y.resolve(b),{recursive:!0}),v.mkdirSync(y.resolve(k),{recursive:!0});var E=v.readFileSync(y.resolve(S),"utf8").replace(/\s*<!--[^]*?-->|\s*\/\*[^]*?\*\/|\s*\/\/[^\n]*/g,"").replace(/\s*\n/g,"\n");return v.readdirSync(y.resolve(r),{withFileTypes:!0}).filter((e=>e.isFile()&&/^[^_\W][^]*\.tsx?$/.test(e.name))).map(((S,R)=>{var D=S.name,A=D.match(/^\w+/)[0],z=y.join(_,`${A}.js`),L=O?null:u({watch:z,port:35729+R}),B=E.replace("</title>",`: ${A}</title>`),I=y.resolve(b,`${A}.zip`);return v.existsSync(I)&&v.rmSync(I),v.writeFileSync(y.resolve(j,`${A}.html`),B.replace(/\s*<\/body>/,q.map((e=>{e=y.resolve(e);var r=y.basename(e);return/\.js/.test(r)?(v.cpSync(e,y.resolve(k,r)),v.existsSync(e+".map")&&v.cpSync(e+".map",y.resolve(k,r+".map")),`\n    <script src=${F(`_dev/scripts/${r}`)}><\/script>`):""})).join("")+`\n    <script src=${F(`_dev/${A}.js`)} defer><\/script>\n  </body>`)),O&&(B=B.replace(/\s*<\/head>/,"\n    \x3c!-- Game SDK --\x3e"+(e?`\n    <script src=${F(e)}><\/script>`:"")+"\n  </head>").replace(/\s*<\/body>/,(q=q.map((e=>(e=y.resolve(e),/\.js/.test(e)?(!/\.min\.js/.test(e)&&v.existsSync(e.slice(0,-2)+"min.js")&&(e=e.slice(0,-2)+"min.js"),e):""))).filter(Boolean)).map((e=>`\n    <script src=${F(`${x}/scripts/${y.basename(e)}`)}><\/script>`)).join("")+`\n    <script src=${F(`${x}/build.js`)} defer><\/script>\n  </body>`)),{external:Object.keys($),input:y.join(r,D),output:{globals:$,sourcemap:!1,format:"iife",name:A,file:z},plugins:[n(),o({preventAssignment:!0,values:{"process.env.DEV":F(!O),"process.env.NODE_ENV":F(O?"production":"dev")}}),a({browser:!0,extensions:[".mjs",".js",".jsx",".mts",".ts",".tsx",".json"]}),l(),c(),{name:"svg-custom",transform:(e,r)=>/\.svg$/.test(r)?(e=m.optimize(e).data,`export default ${F(encodeURIComponent(e))}`):null},{name:"img-custom",async transform(e,r){if(/\.(?:jpe?g|png|bmp|tiff|gif)$/.test(r)){var t=await s.read(r),n=await t.getBase64Async(t.getMIME());return`export default ${F(n)}`}return null}},{name:"sucrase-custom",transform(e,r){if(/\.[mc]?(?:jsx|tsx?)$/.test(r)){try{e=f.transform(e,{transforms:["jsx","typescript"],production:!0,jsxRuntime:"classic",jsxImportSource:"rease"}).code}catch(s){throw console.error("sucrase-custom"),s}return{code:e}}return null}},p(),i({REASE:["rease","*"],css:["rease","css"],"React.createElement":["rease","createElement"],"React.Fragment":["rease","RFragment"]}),i({MATH:["math-safe","*"]}),Object.keys(h).length?i(h):null,...w,L,{name:"babel-and-terser",async transform(e){if(O)try{return{code:e=(await g.transformAsync(e,{presets:[["@babel/preset-env",{corejs:3,loose:!0,bugfixes:!0,modules:!1,useBuiltIns:"entry",targets:"iOS 7"}]],plugins:["@babel/plugin-transform-runtime",["@babel/plugin-transform-block-scoping",{throwIfClosureRequired:!0}]]})).code}}catch(r){throw console.error("babel-custom"),r}},async renderChunk(e,r){if(O)try{return(await d.minify(e,{safari10:!0,mangle:!0,module:!0,toplevel:!0,compress:{drop_console:!0,keep_fnames:!1,keep_classnames:!1}})).code||(console.warn(`WARN: chunk "${r.name}" - terser return empty code`),e)}catch(s){throw console.error("terser-custom"),s}}},{name:"write-bundle",writeBundle(e){O&&e.name===A&&setTimeout((()=>{var e=new t,r=y.resolve(j,x);v.existsSync(r)&&e.addLocalFolder(r,x),q.forEach((r=>{e.addLocalFile(r,x+"/scripts")})),e.addFile("index.html",Buffer.from(B,"utf8")),e.addLocalFile(y.resolve(z),x,"build.js"),e.writeZip(I)}),500)}}],watch:{clearScreen:!1}}}))};
