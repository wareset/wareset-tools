/* eslint-disable */
import{Rease as i,requestAnimationFrame as e,createElement as t,RElement as r,listen as n}from"rease";function s(i,e){return i==i?i===e:e!=e}function o(i,e,t){for(var r in e)null==(n=e[r])||(n=Object.getPrototypeOf(n))!==Object.prototype&&n?s(t[r],e[r])||s(i[r],t[r]=e[r])||(i[r]=e[r]):o(i[r],e[r],t[r]||(t[r]={}));var n}function a(i){i&&(o(this.rease.pixi,i,this.cache),this.rease.update())}function h(i){i&&(i.call(this,this.pixi),this.update())}function d(i,{props:e,$props$:t,$onDraw$:r,onResize:n,onCreate:s,onRender:d,onRenderCapture:c}){e&&o(i.pixi,e,{}),t&&i.watch(t,a,{rease:i,cache:{}}),s&&s.call(i,i.pixi),n&&i.on("pixi-resize",n,i),d&&i.on("pixi-render",d,i),c&&i.on("pixi-render",c,i,!0),r&&i.watch(r,h,i)}function c(i){var s=this.iam,o=this.props;if(s.pixi=i,s.pixi._rease=s,s.onDestroy((()=>(s.pixi=void 0,i.destroy()))),!s.destroyed){var a=i.canvas,h=a.style;h.width=h.height="100%";var c=!1,p=!0,x=e=>{c=!0,s._renderOptions&&(p&&(p=!1,i.resize(a.clientWidth,a.clientHeight),s.emitDeep("pixi-resize")),s.emitDeep("pixi-render",e),i.render(s._renderOptions))};s.update=()=>{c&&(c=!1,e(x))};var u,l=s.insert(t(r,{this:a}))[0],f=()=>{p=!0,s.update()};s.onDestroy(n(a,"resize",(()=>{null!=u&&clearTimeout(u),u=setTimeout(f,17)}))),d(s,o),l.insert(o.children),c=!0,s.update()}}class PixiRenderer extends i{constructor(i){super(),this.await(i.autoDetectRenderer(i.options||{}),c,{iam:this,props:i})}update(){}}function p(){var i=this;i.assets[/Bundle$/.test(i.method)?"unloadBundle":"unload"](i.url||i.urls||i.bundleId||i.bundleIds)}function x(i){var e=this.iam,t=this.props;if(t.unload&&e.onDestroy(p,t),!e.destroyed){var r=t.children;e.insert("function"==typeof r?r.call(e,i):r)}}class PixiAssets extends i{constructor(i){super(),this.await(i.pixi[i.method](i.options||i.url||i.urls||i.bundleId||i.bundleIds||i.assets,i.onProgress||i.assets),x,{iam:this,props:i})}}class PixiScene extends i{constructor(i){super(),this.pixi=new i.pixi(i.options),this.pixi._rease=this,this.onMove(this.hookMove,this),f(this),d(this,i),this.insert(i.children),this.onDestroy(this.hookDestroy)}update(){this.PixiRenderer&&this.PixiRenderer.update()}hookMove(i,e,t){if(i&&i!==this)for(var r=this;r=r.parent;){if(r instanceof PixiScene)return void(this.PixiRenderer=r.PixiRenderer);if(r===i)break}f(this)}hookDestroy(i){u(i),i.update(),i.pixi.removeFromParent(),i.pixi.destroy()}}function u(i){var e=i.PixiRenderer;e&&(e.PixiScene===i&&(e.PixiScene=e._renderOptions=void 0),i.PixiRenderer=void 0)}var l=[PixiRenderer,PixiScene];function f(i){u(i);var e=i.findParentOrNext(l,PixiScene),t=e.parent,r=e.next,n=i.pixi;if(n.removeFromParent(),t instanceof PixiRenderer)t.PixiScene=i,t._renderOptions={container:n},i.PixiRenderer=t;else{var s=r&&r.pixi,o=s&&s.parent||t&&t.pixi;o&&(s?o.addChildAt(n,o.getChildIndex(s)):o.addChild(n),i.PixiRenderer=(t||r).PixiRenderer)}i.update()}function P(i){var e=i.PixiScene;if(e){var t=e.pixi,r=t.filters;if(r){var n=i.pixi;r===n?t.filters=[]:Array.isArray(r)&&(t.filters=r.filter((function(i){return this!==i}),n)),i.update()}i.PixiScene=void 0}}function v(i){P(i);var e=i.findParentOrNext(PixiScene,PixiFilter),t=e.parent,r=e.next,n=i.pixi,s=r&&r.pixi,o=t&&t.pixi;if(o){var a,h=o.filters;h=Array.isArray(h)?h.slice():h?[h]:[],s&&(a=h.indexOf(s))>-1?h.splice(a,0,n):h.push(n),o.filters=h,i.PixiScene=t,i.update()}}class PixiFilter extends i{constructor(i){super(),this.pixi=new i.pixi(i.options),this.pixi._rease=this,this.onMove(this.hookMove,this),v(this),d(this,i),this.onDestroy(this.hookDestroy)}update(){this.PixiScene&&this.PixiScene.update()}hookMove(i,e,t){if(i&&i!==this)for(var r=this;r=r.parent;){if(r===this.PixiScene)return;if(r===i||r instanceof PixiScene)break}v(this)}hookDestroy(i){P(i),i.pixi.destroy()}}function y(i){var e=i.findParent(PixiScene);S(i),i.PixiScene=e,_.call(i,i._mode),m(i)}function S(i){var e=i._type,t=i._handler,r=i.PixiScene;if(r&&e&&t)for(var n=r.pixi,s=e.length;s-- >0;)n.off(e[s],t,i)}function m(i){var e=i._type,t=i._handler,r=i.PixiScene;if(r&&e&&t)for(var n=r.pixi,s=e.length;s-- >0;)n[i._once?"once":"on"](e[s],t,i._context)}function _(i){(this._mode=i)&&this.PixiScene&&(this.PixiScene.pixi.eventMode=i)}function R([i,e,t,r]){S(this),this._once=t,this._type=Array.isArray(i)?i.slice():[i],this._handler=e,this._context=void 0===r?this:r,m(this)}class PixiEvent extends i{constructor({$mode$:i,$once$:e,$type$:t,$handler$:r,$context$:n}){super(),this.onMove(this.hookMove,this),y(this),i&&this.watch(i,_,this),this.watchAll([t,r,e,n],R,this),this.onDestroy(this.hookDestroy)}hookMove(i,e,t){if(i&&i!==this)for(var r=this;r=r.parent;){if(r===this.PixiScene)return;if(r===i||r instanceof PixiScene)break}y(this)}hookDestroy(i){S(i)}}export{PixiAssets as Assets,PixiEvent as Event,PixiFilter as Filter,PixiRenderer as Renderer,PixiScene as Scene};
