/* eslint-disable */
import{Rease as i,createElement as e,RElement as t,listen as s}from"rease";function r(i,e){return i==i?i===e:e!=e}function n(i,e,t){for(var s in e)(o=e[s])&&(o=Object.getPrototypeOf(o))===Object.prototype||!o?n(i[s],e[s],t[s]||(t[s]={})):r(t[s],e[s])||r(i[s],t[s]=e[s])||(i[s]=e[s]);var o}function o(i){i&&(n(this.rease.pixi,i,this.cache),this.rease.update())}function a(i){i&&(i.call(this,this.pixi),this.update())}function d(i,{props:e,$props$:t,$onDraw$:s,onCreate:r,onRender:d,onRenderCapture:h}){r&&r(i,i.pixi),d&&i.on("pixi-render",d),h&&i.on("pixi-render",h,void 0,!0),e&&n(i.pixi,e,{}),t&&i.watch(t,o,{rease:i,cache:{}}),s&&i.watch(s,a,i)}function h(i){var r=this.iam,n=this.props;if(r.pixi=i,r.onDestroy((()=>(r.pixi=void 0,i.destroy()))),!r.destroyed){var o=i.canvas,a=o.style;a.width=a.height="100%";var h=!1,c=e=>{h=!0,r._renderOptions&&(r.emitDeep("pixi-render",e),i.render(r._renderOptions))};r.update=()=>{h&&(h=!1,requestAnimationFrame(c))};var p=r.insert(e(t,{node:o}))[0];r.onDestroy(s(o,"resize",(()=>{i.resize(o.clientWidth,o.clientHeight),r.update()}))),d(r,n),p.insert(n.children),h=!0,r.update()}}class PixiRenderer extends i{constructor(i){super(),this.await(i.autoDetectRenderer(i.options||{}),h,{iam:this,props:i})}update(){}}function c(){var i=this;i.assets[/Bundle$/.test(i.method)?"unloadBundle":"unload"](i.url||i.urls||i.bundleId||i.bundleIds)}function p(i){var e=this.iam,t=this.props;t.unset&&e.onDestroy(c,t),!e.destroyed&&t.children&&e.insert(t.children.call(e,i))}class PixiAssets extends i{constructor(i){super(),this.await(i.pixi[i.method](i.options||i.url||i.urls||i.bundleId||i.bundleIds||i.assets,i.onProgress||i.assets),p,{iam:this,props:i})}}function x(i){var e=i.PixiRenderer;e&&(e.PixiScene===i?e.PixiScene=e._renderOptions=void 0:i.update(),i.PixiRenderer=void 0)}function u(i){x(i);var e=i.findParentOrNext([PixiRenderer,PixiScene],PixiScene),t=e.parent,s=e.next,r=i.pixi;if(t instanceof PixiRenderer)t.PixiScene=i,t._renderOptions={container:r},i.PixiRenderer=t;else{var n=s&&s.pixi,o=n&&n.parent||t&&t.pixi;o?(n?o.addChildAt(r,o.getChildIndex(n)):o.addChild(r),i.PixiRenderer=(t||s).PixiRenderer):r.removeFromParent()}i.update()}function l(i){x(i),i.pixi.destroy()}class PixiScene extends i{constructor(i){super(),this.pixi=new i.pixi(i.options),this.onMove(u),u(this),d(this,i),this.insert(i.children),this.onDestroy(l)}update(){this.PixiRenderer&&this.PixiRenderer.update()}}function f(i){var e=i.PixiScene;if(e){var t=e.pixi,s=t.filters;if(s){var r=i.pixi;s===r?t.filters=[]:Array.isArray(s)&&(t.filters=s.filter((function(i){return this!==i}),r)),i.update()}i.PixiScene=void 0}}function P(i){f(i);var e=i.findParentOrNext(PixiScene,PixiFilter),t=e.parent,s=e.next,r=i.pixi,n=s&&s.pixi,o=t&&t.pixi;if(o){var a,d=o.filters;d=Array.isArray(d)?d.slice():d?[d]:[],n&&(a=d.indexOf(n))>-1?d.splice(a,0,r):d.push(r),o.filters=d,i.PixiScene=t,i.update()}}function v(i){f(i),i.pixi.destroy()}class PixiFilter extends i{constructor(i){super(),this.pixi=new i.pixi(i.options),this.onMove(P),P(this),d(this,i),this.onDestroy(v)}update(){this.PixiScene&&this.PixiScene.update()}}class PixiEvent extends i{constructor({$mode$:i,$once$:e,$type$:t,$handler$:s}){super(),this.onMove(this._move,this),this._move(),i&&this.watch(i,this._watchMode,this),this.watchAll([t,s,e],this._watch,this),this.onDestroy(this._destroy,this)}_watchMode(i){(this._mode=i)&&this.PixiScene&&(this.PixiScene.pixi.eventMode=i)}_watch([i,e,t]){this._off(),this._once=t,this._type=Array.isArray(i)?i.slice():[i],this._handler=e,this._on()}_off(){var i=this._type,e=this._handler,t=this.PixiScene;if(t&&i&&e)for(var s=t.pixi,r=i.length;r-- >0;)s.off(i[r],e,this)}_on(){var i=this._type,e=this._handler,t=this.PixiScene;if(t&&i&&e)for(var s=t.pixi,r=i.length;r-- >0;)s[this._once?"once":"on"](i[r],e,this)}_move(){var i=this.findParent(PixiScene);i!==this.PixiScene&&(this._off(),this.PixiScene=i,this._on(),this._mode&&(i.pixi.eventMode=this._mode))}_destroy(){this._off()}}export{PixiAssets as Assets,PixiEvent as Event,PixiFilter as Filter,PixiRenderer as Renderer,PixiScene as Scene};
